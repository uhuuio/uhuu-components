{"version":3,"file":"uhuu-components.umd.js","sources":["../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_trimmedEndIndex.js","../node_modules/lodash/_baseTrim.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../src/uhuu/pagination-dynamic/pagination/DocumentUtils.ts","../src/uhuu/utility/PageSizeUtils.js","../src/uhuu/config/config-provider.tsx","../src/uhuu/pagination-dynamic/pagination-dynamic.tsx","../src/uhuu/pagination-dynamic/sheet-dynamic.tsx","../src/uhuu/pagination-static/pagination/CompatibilityUtils.ts","../src/uhuu/pagination-static/pagination/DocumentUtils.ts","../src/uhuu/pagination-static/pagination-static.tsx","../src/uhuu/pagination-static/sheet-static.tsx","../src/uhuu/editable/dialog-props.js","../src/uhuu/image/image-bleed.tsx","../src/uhuu/editor-shell/portal-root.tsx","../src/uhuu/editor-shell/interactive-mode-context.tsx","../src/uhuu/ui/cn.ts","../src/uhuu/ui/button.tsx","../src/uhuu/ui/dropdown-menu.tsx","../src/uhuu/image/image-overlay-utils.tsx","../src/uhuu/image/image-bleed-with-overlay.tsx","../src/uhuu/image/image-spread.tsx","../src/uhuu/image/image-with-options.tsx","../src/uhuu/image/image-block.tsx","../src/uhuu/editable/editable.tsx","../src/uhuu/editor-shell/document/page-group-utils.ts","../src/uhuu/editor-shell/document/integration-utils.ts","../src/uhuu/editor-shell/document/template-data-provider.tsx","../src/uhuu/editor-shell/resizers/section-page-resizer.tsx","../src/uhuu/ui/sheet.tsx","../src/uhuu/editor-shell/document/default-render-thumbnail.tsx","../src/uhuu/editor-shell/document/add-page-dialog.tsx","../src/uhuu/utility/drag-drop-grid.tsx","../src/uhuu/ui/badge.tsx","../src/uhuu/editor-shell/document/page-order-dialog.tsx","../src/uhuu/ui/select.tsx","../src/uhuu/ui/switch.tsx","../src/uhuu/ui/slider.tsx","../src/uhuu/ui/label.tsx","../src/uhuu/editor-shell/document/page-options-renderer.tsx","../src/uhuu/editor-shell/document/page-options-dropdown.tsx","../src/uhuu/editor-shell/document/page-group.tsx","../src/uhuu/editor-shell/document/page-canvas.tsx","../src/uhuu/editor-shell/document/use-page-groups.ts","../src/uhuu/editor-shell/document/data-binding.ts","../src/uhuu/editor-shell/document/page-group-presets.ts","../src/uhuu/ui/alert-dialog.tsx","../src/uhuu/editor-shell/document/dev-print-controls.tsx","../src/uhuu/utility/is-dev.ts","../src/uhuu/editor-shell/document/page-editor.tsx","../src/uhuu/editor-shell/document/integration-adapter.ts","../src/PagedPreview.jsx","../src/index.js"],"sourcesContent":["/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nmodule.exports = trimmedEndIndex;\n","var trimmedEndIndex = require('./_trimmedEndIndex');\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nmodule.exports = baseTrim;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var baseTrim = require('./_baseTrim'),\n    isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","declare const $uhuu: {\n  editDialog: (value: any) => void;\n};\n\nclass DocumentUtils {\n  prepareRendering(container: HTMLElement) {        \n    const { clientHeight: height, clientWidth: width } = container;\n    container.innerHTML = '';\n    if (height) container.style.minHeight = `${height}px`;\n    if (width && window !== window.parent) container.style.minWidth = `${width}px`;\n    document?.querySelectorAll(\"style[data-pagedjs-inserted-styles]\").forEach((style) => style.remove());\n    this.resetZoom();\n  }\n\n  finalizeRendering(container: HTMLElement) {    \n    if (container) {\n      container.style.minWidth = 'auto';\n      container.style.minHeight = 'auto';\n    }\n    this.attachEventListeners();\n    this.applyPagedCSS();\n    this.restoreZoom();\n  }\n\n  attachEventListeners() {        \n    document?.querySelectorAll(\"[data-uhuu]\").forEach((item) => {\n      const clickListener = function () {\n        const value = JSON.parse(this.getAttribute(\"data-uhuu\"));\n        $uhuu.editDialog(value);\n      };\n      item.removeEventListener('click', clickListener);\n      item.addEventListener('click', clickListener);\n    });\n  }\n\n  applyPagedCSS() {    \n    document?.querySelectorAll(\".page-break-after[data-paged-css]\").forEach((el) => {\n      const pagedSheet = el.closest('div.pagedjs_sheet');\n      const pagedCSS = el.getAttribute('data-paged-css');\n      if (pagedSheet && pagedCSS) {\n        pagedCSS.split(' ').filter(Boolean).forEach((cssClass) => pagedSheet.classList.add(cssClass));\n      }\n    });\n  }\n\n  getStyleUrls(styles: string, fileName: string) {\n    if (styles) {\n      const blob = new Blob([styles], { type: 'text/css' });\n      return [URL.createObjectURL(blob)];\n    }\n    return fileName ? [fileName] : [];\n  };\n\n  private originalStyles: {\n    width: string;\n    height: string; \n    transform: string;\n    transformOrigin: string;\n  };\n\n  resetZoom() {\n    if (typeof document === 'undefined') return;\n    \n    const body = document?.body;\n    if(!body.style.transform) {      \n      return;     \n    }\n    \n    this.originalStyles = {\n      width: body.style.width,\n      height: body.style.height,\n      transform: body.style.transform,\n      transformOrigin: body.style.transformOrigin || 'center center'\n    };\n\n    body.style.opacity = '0';\n    body.style.width = '100%';\n    body.style.height = '100%';\n    body.style.transform = '';\n  }\n\n  restoreZoom() {           \n    if (typeof document === 'undefined') return;\n    \n    const body = document?.body;\n    body.style.opacity = '1';\n\n    if(!this.originalStyles?.transform) return;            \n    body.style.width = this.originalStyles.width;\n    body.style.height = this.originalStyles.height;\n    body.style.transform = this.originalStyles.transform;    \n  }\n}\n\nexport default DocumentUtils;","/**\n * Standard page size calculations in millimeters\n */\nexport class PageSizeUtils {\n    static PAGE_SIZES = {\n        // A series\n        'A0': { width: 841, height: 1189 },\n        'A1': { width: 594, height: 841 },\n        'A2': { width: 420, height: 594 },\n        'A3': { width: 297, height: 420 },\n        'A4': { width: 210, height: 297 },\n        'A5': { width: 148, height: 210 },\n        'A6': { width: 105, height: 148 },\n        \n        // B series\n        'B0': { width: 1000, height: 1414 },\n        'B1': { width: 707, height: 1000 },\n        'B2': { width: 500, height: 707 },\n        'B3': { width: 353, height: 500 },\n        'B4': { width: 250, height: 353 },\n        'B5': { width: 176, height: 250 },\n        'B6': { width: 125, height: 176 },\n        \n        // C series (envelopes)\n        'C0': { width: 917, height: 1297 },\n        'C1': { width: 648, height: 917 },\n        'C2': { width: 458, height: 648 },\n        'C3': { width: 324, height: 458 },\n        'C4': { width: 229, height: 324 },\n        'C5': { width: 162, height: 229 },\n        'C6': { width: 114, height: 162 },\n        \n        // US Sizes\n        'LETTER': { width: 216, height: 279 },\n        'LEGAL': { width: 216, height: 356 },\n        'TABLOID': { width: 279, height: 432 },\n        'LEDGER': { width: 432, height: 279 }\n    };\n    /**\n     * Get all available page size format names\n     * @returns {string[]} Array of page size format names\n     */\n    static getStandardFormats() {\n        return ['Custom', 'A3', 'A4', 'A5', 'LETTER', 'LEGAL'];\n    }\n\n    /**\n     * Get dimensions for a specific page size\n     * @param {Object} options - Configuration options\n     * @param {string} options.format - Page size format (e.g., 'A4', 'LETTER')\n     * @param {string} [options.orientation='portrait'] - Page orientation ('portrait' or 'landscape')\n     * @returns {{ width: number, height: number } | null} Dimensions in millimeters\n     */\n    static getDimensions({ \n        format, \n        orientation = 'portrait'\n    }) {\n        const size = this.PAGE_SIZES[format.toUpperCase()];\n        if (!size) return null;\n\n        return orientation === 'landscape' ? \n            { \n                width: size.height, \n                height: size.width\n            } : \n            { \n                width: size.width, \n                height: size.height\n            };\n    }\n\n    /**\n     * Convert millimeters to pixels at a given DPI\n     * @param {number} mm - Value in millimeters\n     * @param {number} dpi - Dots per inch (default: 72)\n     * @returns {number} Value in pixels\n     */\n    static mmToPx(mm, dpi = 72) {\n        return (mm * dpi) / 25.4;\n    }\n\n    /**\n     * Get dimensions in pixels for a specific page size\n     * @param {Object} options - Configuration options\n     * @param {string} options.format - Page size format (e.g., 'A4', 'LETTER')\n     * @param {string} [options.orientation='portrait'] - Page orientation ('portrait' or 'landscape')\n     * @param {number} [options.dpi=72] - Dots per inch\n     * @returns {{ width: number, height: number } | null} Dimensions in pixels\n     */\n    static getDimensionsInPx({ \n        format, \n        orientation = 'portrait', \n        dpi = 72\n    }) {\n        const dimensions = this.getDimensions({ \n            format, \n            orientation\n        });\n        if (!dimensions) return null;\n\n        return {\n            width: this.mmToPx(dimensions.width, dpi),\n            height: this.mmToPx(dimensions.height, dpi)\n        };\n    }\n\n    /**\n     * Check if a format exists\n     * @param {string} format - Page size format to check\n     * @returns {boolean} Whether the format exists\n     */\n    static hasFormat(format) {\n        return format.toUpperCase() in this.PAGE_SIZES;\n    }\n\n    /**\n     * Get all available formats\n     * @returns {string[]} Array of available format names\n     */\n    static getAvailableFormats() {\n        return Object.keys(this.PAGE_SIZES);\n    }\n\n    static pageParams(paginationType, args) {\n        if (typeof document === 'undefined') return;\n        \n        const {format, orientation, width, height, bleed, showBleed, compatibility, printCssRaw, printCssUrl, preview} = args;\n        const dimensions = (!format || format.toLowerCase() === 'custom') && width && height && width > 10 && height > 10 && width < 4000 && height < 4000\n            ? { width, height } \n            : this.getDimensions({ format: format ?? 'A4', orientation });\n\n\n        if (dimensions) {\n            document.documentElement.style.setProperty('--uhuu-page-width', `${dimensions.width}mm`);\n            document.documentElement.style.setProperty('--uhuu-page-height', `${dimensions.height}mm`);        \n        }\n\n        document.documentElement.style.setProperty('--uhuu-page-bleed', `${Math.min(Math.max(bleed ?? 0, 0), 400)}mm`);\n\n        const page = { \n            paginationType,\n            format, \n            orientation, \n            bleed, \n            width: dimensions?.width, \n            height: dimensions?.height, \n            preview, \n            showBleed,\n            compatibility,\n            printCssRaw,\n            printCssUrl \n        };\n\n        return { page };  \n    }\n}\n\nexport default PageSizeUtils;","import React, { createContext } from 'react';\n\n// Create the Context\nexport const ConfigContext = createContext(null);\n\n// ConfigProvider Component\nconst ConfigProvider = ({ config, children }) => {\n  return (\n    <ConfigContext.Provider value={config}>\n      {children}\n    </ConfigContext.Provider>\n  );\n};\n\nexport default ConfigProvider;","import { useState, useRef, useEffect } from 'react';\nimport { Previewer } from 'pagedjs';\nimport debounce from 'lodash/debounce';\nimport DocumentUtils from './pagination/DocumentUtils';\nimport PageSizeUtils from '../utility/PageSizeUtils';\nimport ConfigProvider from '../config/config-provider';\nimport './pagination/pagination-dynamic.css';\nimport './../styles/uhuu-indicators.css';\n\ninterface PaginationProps {\n  children: React.ReactNode;\n  className?: string;\n  setup: any;  \n}\n\nconst Pagination = ({ children, className, setup }: PaginationProps) => {\n\n  const [rendering, setRendering] = useState(false);\n  const containerRef = useRef(null);\n  const contentRef = useRef(null);\n  const documentUtilsRef = useRef<DocumentUtils>(new DocumentUtils());\n  const hasWarnedRef = useRef(false);\n\n  const config = PageSizeUtils.pageParams(\"dynamic\", setup);\n\n  // Initialize printCssRaw with empty string if not provided\n  let printCssRaw = config?.page?.printCssRaw ?? '';\n\n  // Warn developer in dev mode if printCssRaw is not provided (only once)\n  if (!config?.page?.printCssRaw && !hasWarnedRef.current && import.meta.env.DEV) {\n    console.info(\n      'ðŸ“„ Uhuu Pagination: Auto-generating basic @page CSS with size and bleed.\\n' +\n      '   ðŸ’¡ Tip: Provide printCssRaw in setup for:\\n' +\n      '      â€¢ Page margins\\n' +\n      '      â€¢ Headers/footers with page numbers\\n' +\n      '      â€¢ Page break utilities\\n' +\n      '   Example: setup={{ format: \"A4\", bleed: 3, printCssRaw }}'\n    );\n    hasWarnedRef.current = true;\n  }\n\n  if (config?.page?.width && config?.page?.height) {\n    const pageRuleRegex = /@page\\s*{([^}]*)}/;\n    const match = printCssRaw.match(pageRuleRegex);\n\n    const sizeAndBleedStyles = `\n      size: ${config.page.width}mm ${config.page.height}mm;\n      bleed: ${config.page.bleed ?? 0}mm;`;\n\n    if (match) {\n      // Remove any existing size/bleed properties\n      const existingStyles = match[1].replace(/\\s*(size|bleed)\\s*:[^;]*;/g, '');\n      const newPageRule = `@page {${sizeAndBleedStyles}${existingStyles}}`;\n      printCssRaw = printCssRaw.replace(pageRuleRegex, newPageRule);\n    } else {\n      printCssRaw = `@page {${sizeAndBleedStyles}}\\n${printCssRaw}`;\n    }\n  }\n\n  const layoutPage = debounce(() => {\n    if (!containerRef.current || !contentRef.current) {\n      console.warn(\"Container or page content reference is missing.\");\n      return;\n    }\n\n    if(rendering) {\n      return;\n    }\n    \n    setRendering(true);    \n    documentUtilsRef.current.prepareRendering(containerRef.current);\n\n    const paged = new Previewer();\n    const styleUrls = documentUtilsRef.current.getStyleUrls(printCssRaw, config?.page?.printCssUrl ?? '');\n    \n    try {\n      paged.preview(contentRef.current?.innerHTML ?? '', styleUrls, containerRef.current).then(() => {        \n        setRendering(false);\n        documentUtilsRef.current.finalizeRendering(containerRef.current);\n      });\n    } catch (error) {\n      console.error(\"Error during Paged.js preview rendering:\", error);      \n      setRendering(false);\n    }\n  }, 500, { leading: true });\n\n  useEffect(() => {\n    layoutPage();\n  }, [children, setup]);\n\n  return (\n    <ConfigProvider config={config}>\n      <div className={[(className ?? ''), (rendering ? 'rendering' : 'rendered'), (config?.page?.showBleed ? 'uhuu-bleed-visible' : ''), (config?.page?.preview ?? '')].filter(Boolean).join(' ')} ref={containerRef}></div>\n      <div className=\"uhuu-reactive-content\" style={{display: 'none'}} ref={contentRef}>\n        {children}\n      </div>\n    </ConfigProvider>\n  );\n};\n\nexport default Pagination;","import React, { ReactNode } from \"react\";\n\ninterface SheetProps {\n  children: ReactNode;\n}\n\nconst Sheet: React.FC<SheetProps> = ({ children }) => {\n  return <>{children}</>;\n};\n\nexport default Sheet;","class Compatibility {\n\n  static handlePageBreakStyles() {\n    document?.querySelectorAll(\".page-break-after[data-paged-css]\").forEach((el) => {\n      const pagedSheet = el.closest('div.uhuu-page-sheet');\n      const pagedCSS = el.getAttribute('data-paged-css');\n      \n      if (pagedSheet && pagedCSS) {\n        const cssClasses = pagedCSS.split(' ').filter(Boolean);\n        cssClasses.forEach((cssClass) => pagedSheet.classList.add(cssClass));\n      }\n    });\n  }\n  \n  static handleUhuuDialogs() {\n    const clickListener = function(this: HTMLElement) {\n      const value = JSON.parse(this.getAttribute(\"data-uhuu\") || '{}');\n      $uhuu.editDialog(value);\n    };\n  \n    document?.querySelectorAll(\"[data-uhuu]\").forEach((el) => {\n      el.removeEventListener('click', clickListener);\n      el.addEventListener('click', clickListener);\n    });\n  }\n\n  static handle() {\n    Compatibility.handlePageBreakStyles();\n    Compatibility.handleUhuuDialogs();\n  }\n}\n\nexport default Compatibility;","class DocumentUtils {\n  static setupPageStyles(printCssUrl?: string) {\n    if (!printCssUrl || typeof document === 'undefined') return;\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = printCssUrl;\n    document.head.appendChild(link);\n    return link;\n  }\n\n  static removePageStyles(link: HTMLLinkElement) {\n    if (link && typeof document !== 'undefined') document?.head.removeChild(link);\n  }\n  \n}\n\nexport default DocumentUtils;","import React, { useEffect } from 'react';\nimport CompatibilityUtils from './pagination/CompatibilityUtils';\nimport DocumentUtils from './pagination/DocumentUtils';\nimport PageSizeUtils from '../utility/PageSizeUtils';\nimport ConfigProvider from '../config/config-provider';\nimport './pagination/print.css';\nimport './pagination/pagination-static.css';\nimport './../styles/uhuu-indicators.css';\n\ninterface PaginationProps {\n  children: React.ReactNode;\n  className?: string;\n  setup: any;\n}\n\nexport const Pagination: React.FC<PaginationProps> = ({ children, className, setup }) => {\n  const config = PageSizeUtils.pageParams(\"static\", setup);\n\n  useEffect(() => {\n    if (config?.page?.compatibility) {\n      CompatibilityUtils.handle();\n    }\n\n    const styleLink = DocumentUtils.setupPageStyles(config?.page?.printCssUrl);\n\n    return () => {\n      if (styleLink) {\n        DocumentUtils.removePageStyles(styleLink as HTMLLinkElement);\n      }\n    };\n  }, [setup, config?.page?.compatibility, config?.page?.printCssUrl]);\n\n  const combinedClassName = [className, config?.page?.preview].filter(Boolean).join(' ');\n\n  return (\n    <ConfigProvider config={config}>\n      <div className={combinedClassName}>\n        {children}\n      </div>\n    </ConfigProvider>\n  );\n};\n\nexport default Pagination;\n","import React, { ReactNode, useContext, CSSProperties, forwardRef } from \"react\";\nimport { ConfigContext } from '../config/config-provider'; // Import the ConfigContext\n\ninterface SheetProps {\n  children: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n  pageNo: number;\n  showBleed?: boolean;\n  overlay?: (args: {pageNo: number}) => ReactNode;\n  'data-page-key'?: string;\n}\n\nconst Sheet = forwardRef<HTMLDivElement, SheetProps>(({\n  children,\n  className = \"\",\n  style,\n  pageNo,\n  overlay,\n  showBleed,\n  'data-page-key': dataPageKey,\n}, ref) => {\n  const config = useContext(ConfigContext);\n  const showBleedArea = showBleed ?? config?.page?.showBleed ?? false;\n\n  return (\n    <div \n      className={`uhuu-page-sheet ${className}`} \n      style={style} \n      ref={ref}\n      data-page-key={dataPageKey}\n    >\n      {children}\n      {overlay && overlay({pageNo})}\n      {showBleedArea && <div className=\"uhuu-bleed-area\"></div>}\n    </div>\n  );\n});\n\nexport default Sheet;","export const getDialogProps = (props, config) => {\n    const dialog = props.dialog;\n\n    if (!dialog) return {};\n    \n    if(config?.page?.paginationType === 'dynamic') return {\n      'data-uhuu': JSON.stringify(dialog)\n    };\n\n    return {\n      onClick: (e) => {\n        e.stopPropagation();\n        window.$uhuu?.editDialog(dialog);\n      },\n      'data-uhuu' : ''\n    };\n  };","import { useContext, useState } from \"react\";\nimport { ConfigContext } from '../config/config-provider'; // Import the ConfigContext\nimport { getDialogProps } from '../editable/dialog-props';\nimport './image.css';\n\ninterface ImageBleedProps {  \n  src?: string;\n  backgroundColor?: string;\n  width?: number;\n  left?: number;\n  right?: number;\n  top?: number;\n  bottom?: number;\n  height?: number;\n  pageWidth?: number;\n  pageHeight?: number;\n  bleed?: number;\n  dialog?: object;\n  children?: React.ReactNode;\n  dataUhuu?: any;\n}\n\nconst ImageBleed = (props: ImageBleedProps) => {\n  const config = useContext(ConfigContext);  \n  // Get page dimensions and bleed from props or use defaults (from context if not provided)  \n  const BLEED = props.bleed ?? config?.page?.bleed ?? 0;  \n  const PAGE_CONTENT_WIDTH = (props.pageWidth ?? config?.page?.width ?? 210); \n  const PAGE_CONTENT_HEIGHT = (props.pageHeight ?? config?.page?.height ?? 297); \n\n  const {\n    src,\n    backgroundColor,\n    width: imageW,\n    height: imageH,\n    left: imageL = 0,\n    right: imageR = 0,\n    top: imageT = 0,\n    bottom: imageB = 0,        \n  } = props;\n\n\n  const [coverClass, setCoverClass] = useState(\"h-full w-full object-cover object-center\");\n\n  const unitFormat = (value) => `${value}mm`;\n\n  const calculateImageHeight = (): number => {\n    let result = imageH; \n    if(!imageH) {\n      result =  PAGE_CONTENT_HEIGHT;\n      if(!imageT) result +=  BLEED;\n      if(!imageB) result += BLEED;\n      if(imageT || imageB) result -= (imageT ?? 0) + (imageB ?? 0);\n    }\n    return result;\n  };\n\n  const calculateImageWidth = (): number => {\n\n    let result = imageW; \n    if(!imageW) {\n      result = PAGE_CONTENT_WIDTH;\n      if(!imageL) result += BLEED;\n      if(!imageR) result += BLEED;\n      if(imageL || imageR) result -= (imageL ?? 0) + (imageR ?? 0);\n    }\n    return result;\n  };\n\n\n  const imageWidth = calculateImageWidth();\n  const imageHeight = calculateImageHeight();\n  \n\n  const formatStyleValue = (value: number | undefined): string | undefined => \n    value !== undefined ? unitFormat(value) : undefined;\n\n  const createStyle = (styles: Record<string, string | undefined>) => {\n    return Object.fromEntries(\n      Object.entries(styles).filter(([_, value]) => value !== undefined)\n    );\n  };\n\n  // Replace old style object with new createStyle implementation\n  const style = createStyle({\n    backgroundColor,\n    width: formatStyleValue(imageWidth),\n    height: formatStyleValue(imageHeight),\n    left: formatStyleValue(imageL > 0 ? imageL + BLEED : imageL),\n    right: formatStyleValue(imageR > 0 ? imageR + BLEED : imageR),\n    top: formatStyleValue(imageT > 0 ? imageT + BLEED : imageT),\n    bottom: formatStyleValue(imageB > 0 ? imageB + BLEED : imageB),\n  });\n\n    \n  // calc ratio of image: if imageHeight set to 0 (means it should be \"auto\") then calc using default pageHeight and spacings\n  const ratio = imageHeight > 0 ? imageWidth / imageHeight : \n                                  imageWidth / (PAGE_CONTENT_HEIGHT - (imageT ?? 0) - (imageB ?? 0));\n  \n\n  const imageLoaded = (e) => {\n    // Compare loaded image ratio with container ratio to determine cover mode\n    const imageRatio = e.target.naturalWidth / e.target.naturalHeight; // Use naturalWidth/Height to get actual image dimensions\n\n    // If image is wider relative to container, use vertical cover mode\n    // Otherwise use horizontal cover mode\n    let imageClass = imageRatio > ratio  ? \"cover-vertical\"  : \"cover-horizontal\";    \n    setCoverClass(imageClass);\n  };\n\n  \n\n  return (\n    <div className=\"uhuu-image-container\" style={style} {...(props.dataUhuu !== undefined ? { 'data-uhuu': props.dataUhuu } : {})}>\n      <div \n        className=\"uhuu-image-inner\" \n        {...getDialogProps(props, config)}\n      >\n        <img \n          className={coverClass} \n          src={src} \n          onLoad={(e) => imageLoaded(e)} \n          key={`${src}-${imageWidth}-${imageHeight}`}\n        />\n        {props.children}\n      </div>\n    </div>\n  );\n};\n\nexport default ImageBleed;","import * as React from \"react\"\n\ninterface PortalRootContextType {\n  portalContainer: HTMLElement | null\n}\n\nconst PortalRootContext = React.createContext<PortalRootContextType>({\n  portalContainer: null,\n})\n\nexport function usePortalRoot() {\n  return React.useContext(PortalRootContext)\n}\n\ninterface PortalRootProviderProps {\n  children: React.ReactNode\n}\n\nexport function PortalRootProvider({ children }: PortalRootProviderProps) {\n  const [portalContainer, setPortalContainer] = React.useState<HTMLElement | null>(null)\n\n  React.useEffect(() => {\n    if (typeof document === 'undefined') return\n\n    // Create portal container\n    const container = document.createElement('div')\n    container.setAttribute('data-uhuu-portal', '')\n    container.style.cssText = 'position: fixed; top: 0; left: 0; z-index: 9999;'\n\n    document.body.appendChild(container)\n    setPortalContainer(container)\n\n    return () => {\n      document.body.removeChild(container)\n    }\n  }, [])\n\n  return (\n    <PortalRootContext.Provider value={{ portalContainer }}>\n      {children}\n    </PortalRootContext.Provider>\n  )\n}\n","import * as React from \"react\"\nimport { createContext, useContext, useState } from \"react\"\nimport { PortalRootProvider } from \"./portal-root\"\n\ninterface InteractiveModeContextType {\n  interactive: boolean\n  setInteractive: (value: boolean) => void\n  enableDevTools?: boolean\n}\n\nconst InteractiveModeContext = createContext<InteractiveModeContextType>({\n  interactive: true,\n  setInteractive: () => {},\n  enableDevTools: false,\n})\n\n/**\n * Hook to access interactive mode state\n * Returns true if UI should show interactive elements (default), false to hide them\n */\nexport function useInteractive() {\n  return useContext(InteractiveModeContext)\n}\n\n/**\n * Hook to check if UI elements should be hidden\n * Returns true when interactive mode is OFF\n */\nexport function useShouldHideUI(): boolean {\n  const { interactive } = useInteractive()\n  return !interactive\n}\n\ninterface InteractiveModeProviderProps {\n  children: React.ReactNode\n  defaultInteractive?: boolean\n  enableDevTools?: boolean\n}\n\n/**\n * InteractiveModeProvider - Global control for showing/hiding UI elements\n * \n * When interactive=true (default): Shows all controls (edit mode)\n * When interactive=false: Hides all UI elements (Print Mode)\n * \n * @param defaultInteractive - Initial interactive mode state (default: true)\n * @param enableDevTools - Force enable dev tools (print mode controls) even in production (default: false)\n * \n * @example\n * ```tsx\n * <InteractiveModeProvider defaultInteractive={true} enableDevTools={true}>\n *   <MyApp />\n * </InteractiveModeProvider>\n * \n * // Inside components:\n * const { interactive, setInteractive } = useInteractive()\n * <button onClick={() => setInteractive(!interactive)}>\n *   {interactive ? 'Hide UI' : 'Show UI'}\n * </button>\n * ```\n */\nexport function InteractiveModeProvider({\n  children,\n  defaultInteractive = true,\n  enableDevTools = false,\n}: InteractiveModeProviderProps) {\n  const shouldDisableInteractive = typeof window !== 'undefined' && (window as any)?.$uhuu_renderer ? true : false;\n  \n  const effectiveDefaultInteractive = shouldDisableInteractive \n    ? false \n    : defaultInteractive\n  \n  const [interactive, setInteractive] = useState(effectiveDefaultInteractive)\n\n  return (\n    <InteractiveModeContext.Provider value={{ interactive, setInteractive, enableDevTools }}>\n      {interactive ? (\n        <PortalRootProvider>\n          <div data-uhuu-interactive=\"\" style={{ display: 'contents' }}>\n            {children}\n          </div>\n        </PortalRootProvider>\n      ) : (\n        children\n      )}\n    </InteractiveModeContext.Provider>\n  )\n}\n\n\n\n\n","import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n","import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"./cn\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-gray-900 text-white hover:bg-gray-800\",\n        outline: \"border border-gray-300 bg-white hover:bg-gray-50 text-gray-900\",\n        ghost: \"hover:bg-gray-100 text-gray-900\",\n        secondary: \"bg-gray-100 text-gray-900 hover:bg-gray-200\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 px-3 text-sm\",\n        lg: \"h-11 px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, ...props }, ref) => {\n    return (\n      <button\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n\n","import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { cn } from \"./cn\"\nimport { usePortalRoot } from \"../editor-shell/portal-root\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName = DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}    \n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName = DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => {\n  const { portalContainer } = usePortalRoot();\n\n  return (\n    <DropdownMenuPrimitive.Portal container={portalContainer || undefined}>\n      <DropdownMenuPrimitive.Content\n        ref={ref}\n        sideOffset={sideOffset}\n        data-uhuu-editor\n        className={cn(\n          \"z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </DropdownMenuPrimitive.Portal>\n  );\n})\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName = DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-medium\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-gray-200\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n\n","import * as React from \"react\"\nimport { MoreHorizontal } from \"lucide-react\"\nimport type { ImageOption } from './image-with-options'\nimport { useShouldHideUI } from \"../editor-shell/interactive-mode-context\"\nimport { Button } from \"../ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"../ui/dropdown-menu\"\nimport { cn } from \"../ui/cn\"\n\ntype OptionSelectEvent = Event | React.SyntheticEvent\n\nexport const handleOptionSelect = (event: OptionSelectEvent, option: ImageOption) => {\n  event.stopPropagation()\n\n  if (option.onSelect) {\n    option.onSelect(event)\n    return\n  }\n\n  if (option.dialog && typeof window !== \"undefined\") {\n    ;(window as any).$uhuu?.editDialog?.(option.dialog)\n  }\n}\n\nexport const renderOverlay = (\n  overlaySvg: string | undefined,\n  overlayClassName: string | undefined\n): React.ReactNode => {\n  if (!overlaySvg) return null\n  \n  const trimmed = overlaySvg.trim()\n  const isInlineSvg = trimmed.startsWith(\"<\")\n\n  if (isInlineSvg) {\n    const normalizedSvg = trimmed.replace(/<svg\\b([^>]*)>/i, (match, attrs) => {\n      let nextAttrs = attrs\n      if (/\\bwidth=/.test(nextAttrs)) {\n        nextAttrs = nextAttrs.replace(/\\bwidth=(\\\"[^\\\"]*\\\"|'[^']*'|[^\\s>]+)/i, 'width=\"100%\"')\n      } else {\n        nextAttrs += ' width=\"100%\"'\n      }\n      if (/\\bheight=/.test(nextAttrs)) {\n        nextAttrs = nextAttrs.replace(/\\bheight=(\\\"[^\\\"]*\\\"|'[^']*'|[^\\s>]+)/i, 'height=\"100%\"')\n      } else {\n        nextAttrs += ' height=\"100%\"'\n      }\n      if (/\\bpreserveAspectRatio=/.test(nextAttrs)) {\n        nextAttrs = nextAttrs.replace(\n          /\\bpreserveAspectRatio=(\\\"[^\\\"]*\\\"|'[^']*'|[^\\s>]+)/i,\n          'preserveAspectRatio=\"xMidYMid slice\"'\n        )\n      } else {\n        nextAttrs += ' preserveAspectRatio=\"xMidYMid slice\"'\n      }\n      return `<svg${nextAttrs}>`\n    })\n    return (\n      <div\n        className={cn(\"pointer-events-none absolute inset-0 z-10\", overlayClassName)}\n        aria-hidden=\"true\"\n        dangerouslySetInnerHTML={{ __html: normalizedSvg }}\n      />\n    )\n  }\n\n  return (\n    <img\n      src={overlaySvg}\n      alt=\"\"\n      aria-hidden=\"true\"\n      className={cn(\n        \"pointer-events-none absolute inset-0 z-10 h-full w-full object-cover\",\n        overlayClassName\n      )}\n    />\n  )\n}\n\nexport const renderOptionsButton = (\n  options: ImageOption[],\n  showOptions: boolean\n): React.ReactNode => {\n  if (!showOptions) return null\n  \n  return (\n    <div className=\"absolute right-2 top-2 z-20\">\n      <DropdownMenu modal={false}>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            title=\"Image options\"\n            className=\"h-7 w-7 shadow-sm\"\n            onPointerDown={(event) => event.stopPropagation()}\n            onClick={(event) => event.stopPropagation()}\n          >\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent className=\"w-40 p-1.5\" align=\"end\">\n          {options.map((option) => (\n            <DropdownMenuItem\n              key={option.id}\n              onSelect={(event) => handleOptionSelect(event, option)}\n              disabled={option.disabled}\n            >\n              {option.icon && <span className=\"mr-2 inline-flex\">{option.icon}</span>}\n              <span>{option.label}</span>\n            </DropdownMenuItem>\n          ))}\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  )\n}\n\nexport const useShouldShowOptions = (\n  options: ImageOption[] = []\n): boolean => {\n  const shouldHideUI = useShouldHideUI()\n  return options.length > 0 && !shouldHideUI\n}\n","import * as React from \"react\"\nimport { useContext } from \"react\"\nimport { ConfigContext } from \"../config/config-provider\"\nimport { getDialogProps } from \"../editable/dialog-props\"\nimport ImageBleed from './image-bleed'\nimport type { ImageOption } from './image-with-options'\nimport {\n  renderOverlay,\n  renderOptionsButton,\n  useShouldShowOptions,\n} from './image-overlay-utils'\n\ninterface ImageBleedWithOverlayProps {\n  className?: string\n  style?: React.CSSProperties\n  overlaySvg?: string\n  overlayClassName?: string\n  options?: ImageOption[]\n  dialog?: Record<string, any> | null\n  dialogProps?: Record<string, any>\n  bleedProps: any\n  children?: React.ReactNode\n}\n\nconst ImageBleedWithOverlay = ({\n  className,\n  style,\n  overlaySvg,\n  overlayClassName,\n  options = [],\n  dialog,\n  dialogProps,\n  bleedProps,\n  children,\n}: ImageBleedWithOverlayProps) => {\n  const config = useContext(ConfigContext)\n  const showOptions = useShouldShowOptions(options)\n  \n  // Get dialog props for click-to-edit\n  const baseDialogProps = dialog ? getDialogProps({ dialog }, config) : {}\n  \n  // Merge base dialog props with additional dialogProps\n  const mergedDialogProps = React.useMemo(() => {\n    if (!dialogProps) return baseDialogProps\n    const merged: Record<string, any> = { ...baseDialogProps, ...dialogProps }\n    if (baseDialogProps.className || dialogProps.className) {\n      merged.className = `${baseDialogProps.className || ''} ${dialogProps.className || ''}`.trim()\n    }\n    Object.keys(baseDialogProps).forEach((key) => {\n      const baseHandler = baseDialogProps[key]\n      const extraHandler = dialogProps[key]\n      if (key.startsWith(\"on\") && typeof baseHandler === \"function\" && typeof extraHandler === \"function\") {\n        merged[key] = (event: any) => {\n          baseHandler(event)\n          extraHandler(event)\n        }\n      }\n    })\n    return merged\n  }, [baseDialogProps, dialogProps])\n\n  // Render bleed with overlay inside\n  // Pass dialog prop to ImageBleed (it will call getDialogProps internally)\n  // No relative wrapper - it breaks absolute positioning!\n  return (\n    <>\n      <ImageBleed {...bleedProps} dialog={dialog}>\n        {renderOverlay(overlaySvg, overlayClassName)}\n        {children}\n      </ImageBleed>\n      {renderOptionsButton(options, showOptions)}\n    </>\n  )\n}\n\nexport default ImageBleedWithOverlay\n","import { useState, useContext } from \"react\";\nimport { ConfigContext } from '../config/config-provider'; // Import the ConfigContext\nimport { getDialogProps } from '../editable/dialog-props';\nimport './image.css';\n\ninterface ImageSpreadProps {  \n  src?: string;\n  side?: \"start\" | \"end\";\n  backgroundColor?: string;\n  width?: number;\n  left?: number;\n  right?: number;\n  top?: number;\n  bottom?: number;\n  height?: number;\n  pageWidth?: number;\n  pageHeight?: number;\n  bleed?: number;\n  dialog?: object;\n  children?: React.ReactNode;\n  dataUhuu?: any;\n}\n\n// Constants\nexport default function ImageSpread(props: ImageSpreadProps) {\n\n  const config = useContext(ConfigContext);  \n  // Get page dimensions and bleed from props or use defaults (from context if not provided)\n  const BLEED = props.bleed ?? config?.page?.bleed ?? 0;  \n  const PAGE_CONTENT_WIDTH = (props.pageWidth ?? config?.page?.width ?? 210);\n  const PAGE_CONTENT_HEIGHT = (props.pageHeight ?? config?.page?.height ?? 297);\n  \n  const {\n    src,\n    side,\n    backgroundColor,\n    width: imageW,\n    height: imageH,\n    left: imageL = 0,\n    right: imageR = 0,\n    top: imageT = 0,\n    bottom: imageB = 0,        \n  } = props;\n\n  const [coverClass, setCoverClass] = useState(\"h-full w-full object-cover object-center\");\n\n\n  const unitFormat = (val: number): string => {\n    return `${val}mm`;\n  };\n\n  const calculateImageWidth = (): number => {\n    let result = imageW; \n    if(!imageW) {\n      result = 2 * PAGE_CONTENT_WIDTH;\n      if(!imageL) result += 2 * BLEED;\n      if(!imageR) result += 2 * BLEED;\n      if(imageL || imageR) result -= (imageL ?? 0) + (imageR ?? 0);\n    }\n    return result;\n  };\n\n  const calculateImageHeight = (): number => {\n    let result = imageH; \n    if(!imageH) {\n      result = PAGE_CONTENT_HEIGHT;\n      // Add top bleed if top is 0 (will be positioned with top: -BLEED)\n      if(!imageT) result += BLEED;\n      // Add bottom bleed if bottom is 0 (will be positioned with bottom: -BLEED)\n      // When using bottom positioning, we add bleed to height so element extends below\n      if(!imageB) result += BLEED;\n      if(imageT || imageB) result -= (imageT ?? 0) + (imageB ?? 0);\n    }\n    return result;\n  };\n\n  // Calculate dimensions  \n  const imageWidth = calculateImageWidth();\n  const imageHeight = calculateImageHeight();  \n\n\n  const formatStyleValue = (value: number | undefined): string | undefined => \n    value !== undefined ? unitFormat(value) : undefined;\n\n  const createStyle = (styles: Record<string, string | undefined>) => {\n    return Object.fromEntries(\n      Object.entries(styles).filter(([_, value]) => value !== undefined)\n    );\n  };\n\n  // Calculate positioning values\n  // Note: We only use 'left' in CSS; width calculation handles right side\n  const imageLeft = imageL > 0 ? imageL + BLEED : (-1 * BLEED);\n  const imageRight = imageR > 0 ? imageR + BLEED : (-1 * BLEED); // Calculated but not used in CSS (width handles it)\n  const imageTop = imageT > 0 ? imageT + BLEED : (-1 * BLEED);\n  // Bottom: when imageB is 0, use -BLEED to extend into bleed area (matching top behavior)\n  const imageBottom = imageB > 0 ? imageB + BLEED : (-1 * BLEED);\n  const rightPageOffset = -1 * PAGE_CONTENT_WIDTH + imageLeft; // Offset of right page\n  \n  // Only set explicit height when BOTH top and bottom have explicit values (both > 0)\n  // Otherwise, let CSS calculate height from top and bottom positioning\n  // This avoids conflicts when one side uses bleed positioning (-BLEED)\n  const useExplicitHeight = imageT > 0 && imageB > 0;\n  \n  const leftStyle = createStyle({\n    backgroundColor,\n    width: formatStyleValue(imageWidth),\n    ...(useExplicitHeight ? { height: formatStyleValue(imageHeight) } : {}),\n    left: formatStyleValue(imageLeft),\n    top: formatStyleValue(imageTop),\n    bottom: formatStyleValue(imageBottom)\n  });\n\n  const rightStyle = createStyle({\n    width: formatStyleValue(imageWidth),\n    ...(useExplicitHeight ? { height: formatStyleValue(imageHeight) } : {}),\n    left: formatStyleValue(rightPageOffset),\n    top: formatStyleValue(imageTop),\n    bottom: formatStyleValue(imageBottom)\n  });\n\n  // calc ratio of image: if imageHeight set to 0 (means it should be \"auto\") then calc using default pageHeight and spacings\n  const ratio =\n    imageHeight != 0\n      ? imageWidth / imageHeight\n      : imageWidth / (PAGE_CONTENT_HEIGHT - (imageT ?? 0) - (imageB ?? 0));\n\n  const imageLoaded = (e) => {\n    // Compare loaded image ratio with container ratio to determine cover mode\n    const imageRatio = e.target.naturalWidth / e.target.naturalHeight; // Use naturalWidth/Height to get actual image dimensions\n    \n    // If image is wider relative to container, use vertical cover mode\n    // Otherwise use horizontal cover mode\n    let imageClass = imageRatio > ratio  ? \"cover-vertical\"  : \"cover-horizontal\";    \n    setCoverClass(imageClass);\n  };\n\n\n  return <div className={`uhuu-image-container`} style={side == \"end\" ? rightStyle : leftStyle} {...(props.dataUhuu !== undefined ? { 'data-uhuu': props.dataUhuu } : {})}>\n        <div className=\"uhuu-image-inner\" {...getDialogProps(props, config)}>\n          {props.children || (\n            <img \n              className={coverClass} \n              src={src} \n              onLoad={(e) => imageLoaded(e)}\n              key={`${src}-${imageWidth}-${imageHeight}`} // Force reload when height or width change\n            />\n          )}\n        </div>\n      </div>\n}\n","import * as React from \"react\"\nimport { useContext } from \"react\"\nimport { ConfigContext } from \"../config/config-provider\"\nimport { getDialogProps } from \"../editable/dialog-props\"\nimport ImageSpread from \"./image-spread\"\nimport ImageBleed from \"./image-bleed\"\nimport { cn } from \"../ui/cn\"\nimport {\n  renderOverlay,\n  renderOptionsButton,\n  useShouldShowOptions,\n} from './image-overlay-utils'\n\ntype OptionSelectEvent = Event | React.SyntheticEvent\n\nexport type ImageOption = {\n  id: string\n  label: string\n  icon?: React.ReactNode\n  dialog?: Record<string, any> | null\n  onSelect?: (event: OptionSelectEvent) => void\n  disabled?: boolean\n}\n\ntype ImageRenderProps = React.ImgHTMLAttributes<HTMLImageElement>\n\ninterface ImageWithOptionsProps {\n  src?: string\n  alt?: string\n  className?: string\n  imageClassName?: string\n  style?: React.CSSProperties\n  imageStyle?: React.CSSProperties\n  overlaySvg?: string\n  overlayClassName?: string\n  options?: ImageOption[]\n  dialog?: Record<string, any> | null\n  dialogProps?: Record<string, any>\n  placeholder?: React.ReactNode\n  children?: React.ReactNode\n  imageProps?: React.ImgHTMLAttributes<HTMLImageElement>\n  renderImage?: (props: ImageRenderProps) => React.ReactNode\n}\n\nconst ImageWithOptions = ({\n  src,\n  alt = \"\",\n  className,\n  imageClassName,\n  style,\n  imageStyle,\n  overlaySvg,\n  overlayClassName,\n  options = [],\n  dialog,\n  dialogProps,\n  placeholder,\n  children,\n  imageProps,\n  renderImage,\n}: ImageWithOptionsProps) => {\n  const config = useContext(ConfigContext)\n  const baseDialogProps = dialog ? getDialogProps({ dialog }, config) : {}\n  const showOptions = useShouldShowOptions(options)\n\n  const mergedDialogProps = React.useMemo(() => {\n    if (!dialogProps) return baseDialogProps\n    const merged: Record<string, any> = { ...baseDialogProps, ...dialogProps }\n    if (baseDialogProps.className || dialogProps.className) {\n      merged.className = cn(baseDialogProps.className, dialogProps.className)\n    }\n    Object.keys(baseDialogProps).forEach((key) => {\n      const baseHandler = baseDialogProps[key]\n      const extraHandler = dialogProps[key]\n      if (key.startsWith(\"on\") && typeof baseHandler === \"function\" && typeof extraHandler === \"function\") {\n        merged[key] = (event: any) => {\n          baseHandler(event)\n          extraHandler(event)\n        }\n      }\n    })\n    return merged\n  }, [baseDialogProps, dialogProps])\n\n  const renderImageContent = () => {\n    const imagePropsClassName = imageProps?.className\n    const imagePropsStyle = imageProps?.style\n    const finalSrc = imageProps?.src ?? src\n    const finalAlt = imageProps?.alt ?? alt\n    const mergedImageProps: React.ImgHTMLAttributes<HTMLImageElement> = {\n      ...imageProps,\n      src: finalSrc,\n      alt: finalAlt,\n      className: cn(\"h-full w-full object-cover\", imageClassName, imagePropsClassName),\n      style: { ...imageStyle, ...imagePropsStyle },\n    }\n\n    if (renderImage) {\n      return renderImage(mergedImageProps)\n    }\n\n    if (finalSrc) {\n      return <img {...mergedImageProps} />\n    }\n\n    return placeholder ?? null\n  }\n\n  const hasDataUhuu = mergedDialogProps['data-uhuu'];\n\n  // Check if the children contains ImageSpread or ImageBleed    \n  const hasImageSpreadOrBleed = React.Children.toArray(children).some((child: any) => {\n    if (!React.isValidElement(child)) return false;\n    return (child.type === ImageSpread || child.type === ImageBleed);\n  });\n\n  // If contains: delete the data-uhuu prop, pass the data-uhuu prop to the children\n  if (hasImageSpreadOrBleed) delete mergedDialogProps['data-uhuu'];\n\n  // Pass the data-uhuu prop to the children\n  const childrenWithProps = React.Children.map(children, (child) => {\n    if (React.isValidElement(child)) {\n      return React.cloneElement(child, { 'dataUhuu': hasDataUhuu });\n    }\n    return child;\n  });\n\n  return (\n    <div className={cn(\"relative\", className)} style={style}>\n      <div className=\"relative h-full w-full\" {...mergedDialogProps}>\n        {renderImageContent()}\n        {childrenWithProps}\n        {renderOverlay(overlaySvg, overlayClassName)}\n      </div>\n      {renderOptionsButton(options, showOptions)}\n    </div>\n  )\n}\n\nexport default ImageWithOptions\n","import * as React from \"react\"\nimport { useMemo } from \"react\"\nimport ImageBleed from './image-bleed'\nimport ImageBleedWithOverlay from './image-bleed-with-overlay'\nimport ImageSpread from './image-spread'\nimport ImageWithOptions from './image-with-options'\nimport type { ImageOption } from './image-with-options'\n\ntype ImageBlockMode = \"bleed\" | \"spread\" | \"auto\"\n\ntype ImageRenderProps = React.ImgHTMLAttributes<HTMLImageElement>\n\n// Annotation data structure\ntype AnnotationValue = {\n  annotationSvg?: string\n  annotations?: unknown[]\n}\n\n// Simplified annotation config\ninterface ImageBlockAnnotation {\n  path: string                        // where annotation data is stored\n  value?: AnnotationValue             // preloaded data (optional)\n  [key: string]: any                  // any extra config (visualGallery, etc.)\n}\n\n// Dialog config with type\ninterface ImageBlockDialog {\n  path: string                        // where data is stored\n  type: 'image' | 'satellite'         // dialog type\n  [key: string]: any                  // any extra config (ratio, lat, lng, zoom, etc.)\n}\n\ninterface ImageBlockProps {\n  // Image source\n  src?: string\n  alt?: string // Optional - not required for PDF rendering\n  \n  // Styling - className/style for container, imageClassName/imageStyle for <img>\n  className?: string\n  imageClassName?: string\n  style?: React.CSSProperties\n  imageStyle?: React.CSSProperties\n  backgroundColor?: string\n  \n  // Print mode - only needed for full-bleed print images\n  mode?: ImageBlockMode\n  side?: \"start\" | \"end\" // For spread mode (left/right page)\n  \n  // Bleed dimensions (only used in bleed/spread modes)\n  width?: number\n  height?: number\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  pageWidth?: number\n  pageHeight?: number\n  bleed?: number\n  \n  // Simplified dialog config (auto-generates edit dialog with type)\n  dialog?: ImageBlockDialog\n  \n  // Simplified annotation config (auto-generates overlay + annotate option)\n  annotation?: ImageBlockAnnotation\n  \n  // Manual interactive features (for advanced use cases)\n  overlaySvg?: string\n  overlayClassName?: string\n  options?: ImageOption[]\n  dialogProps?: Record<string, any>\n  placeholder?: React.ReactNode\n  children?: React.ReactNode\n  imageProps?: React.ImgHTMLAttributes<HTMLImageElement>\n  renderImage?: (props: ImageRenderProps) => React.ReactNode\n}\n\nconst ImageBlock = (props: ImageBlockProps) => {\n  // Auto-generate overlay and options from annotation/dialog config\n  const { computedOverlaySvg, computedOptions, computedDirectDialog } = useMemo(() => {\n    const { annotation, dialog, overlaySvg, options, src } = props\n    \n    // If no simplified props, use manual props as-is\n    if (!annotation && !dialog) {\n      return {\n        computedOverlaySvg: overlaySvg,\n        computedOptions: options,\n        computedDirectDialog: undefined,\n      }\n    }\n    \n    // Extract annotation data\n    const annotationValue = annotation?.value || {}\n    \n    // Auto-generate overlay from annotation\n    const autoOverlaySvg = overlaySvg ?? annotationValue.annotationSvg ?? ''\n    \n    // Build options array\n    const autoOptions: ImageOption[] = []\n    \n    // Only add options if annotation is enabled\n    // (dialog alone doesn't show options dropdown)\n    if (annotation) {\n      // Add \"Edit image\" option if dialog config is provided\n      if (dialog) {\n        const dialogConfig: any = {\n          ...dialog, // Spread everything (path, type, ratio, etc.)\n        }\n        \n        // For satellite dialogs, wrap lat/lng/zoom in config.config\n        if (dialog.type === 'satellite') {\n          const { path, type, ...satelliteParams } = dialog\n          dialogConfig.config = {\n            ...satelliteParams,\n            path: 'image',\n          }\n          dialogConfig.path = path\n          dialogConfig.type = type\n        } else if (dialog.type === 'image') {\n          // For image dialogs, add required fields that buildPageDialog adds\n          if (!dialogConfig.imagePath) {\n            dialogConfig.imagePath = 'url'\n          }\n        }\n        \n        autoOptions.push({\n          id: 'edit',\n          label: 'Edit image',\n          dialog: dialogConfig,\n        })\n      }\n      \n      // Add \"Annotate\" option\n      const annotations = Array.isArray(annotationValue.annotations) \n        ? annotationValue.annotations \n        : []\n      \n      const { path, value, annotations: _, ...annotationConfig } = annotation\n      \n      const annotateDialogConfig: any = {\n        path: annotation.path,\n        type: 'annotation',\n        image: src,\n        annotations,\n        ...annotationConfig, // Spread extra config (visualGallery, etc.)\n      }\n      \n      autoOptions.push({\n        id: 'annotate',\n        label: 'Annotate',\n        dialog: annotateDialogConfig,\n      })\n    }\n    \n    // Merge auto-generated options with manual options\n    const finalOptions = options ? [...autoOptions, ...options] : autoOptions\n    \n    // If dialog exists, always create directDialog for click-to-edit\n    // This allows clicking the image to open edit dialog, even when dropdown exists\n    let directDialog = undefined\n    if (dialog) {\n      const dialogConfig: any = {\n        ...dialog, // Spread everything (path, type, ratio, etc.)\n      }\n      \n      // For satellite dialogs, wrap lat/lng/zoom in config.config\n      if (dialog.type === 'satellite') {\n        const { path, type, ...satelliteParams } = dialog\n        dialogConfig.config = {\n          ...satelliteParams,\n          path: 'image',\n        }\n        dialogConfig.path = path\n        dialogConfig.type = type\n      } else if (dialog.type === 'image') {\n        // For image dialogs, add required fields that buildPageDialog adds\n        if (!dialogConfig.imagePath) {\n          dialogConfig.imagePath = 'url'\n        }\n      }\n      \n      directDialog = dialogConfig\n    }\n    \n    return {\n      computedOverlaySvg: autoOverlaySvg,\n      computedOptions: finalOptions.length > 0 ? finalOptions : undefined,\n      computedDirectDialog: directDialog,\n    }\n  }, [props.annotation, props.dialog, props.overlaySvg, props.options, props.src])\n  \n  // Determine mode: auto (default), bleed (for print), or spread (for print with sides)\n  const mode: ImageBlockMode = useMemo(() => {\n    if (props.mode) return props.mode\n    if (props.side !== undefined) return \"spread\"\n    \n    // Auto-detect: if bleed dimensions are provided, use bleed mode\n    const hasBleedDimensions = props.width !== undefined || props.height !== undefined || \n                               props.left !== undefined || props.right !== undefined ||\n                               props.top !== undefined || props.bottom !== undefined\n    \n    return hasBleedDimensions ? \"bleed\" : \"auto\"\n  }, [props.mode, props.side, props.width, props.height, props.left, props.right, props.top, props.bottom])\n  \n  // Check if we need ImageWithOptions wrapper\n  const needsImageWithOptions = \n    mode === \"auto\" || // Auto mode always uses ImageWithOptions\n    (computedOptions && computedOptions.length > 0) || \n    computedOverlaySvg || \n    computedDirectDialog || // Need wrapper for click-to-edit\n    props.renderImage !== undefined ||\n    props.placeholder !== undefined ||\n    props.children !== undefined\n  \n  // Extract props\n  const {\n    mode: _mode,\n    side,\n    src,\n    alt,\n    className,\n    imageClassName,\n    style,\n    imageStyle,\n    backgroundColor,\n    width,\n    height,\n    left,\n    right,\n    top,\n    bottom,\n    pageWidth,\n    pageHeight,\n    bleed,\n    overlayClassName,\n    dialogProps,\n    placeholder,\n    children,\n    imageProps,\n    renderImage,\n  } = props\n  \n  // Base component props (for bleed/spread modes)\n  const baseProps = {\n    src,\n    backgroundColor,\n    width,\n    height,\n    left,\n    right,\n    top,\n    bottom,\n    pageWidth,\n    pageHeight,\n    bleed,\n  }\n  \n  // Auto mode: Simple image with wrapper if needed\n  if (mode === \"auto\") {\n    return (\n      <ImageWithOptions\n        src={src}\n        alt={alt}\n        className={className}\n        style={style}\n        imageClassName={imageClassName}\n        imageStyle={imageStyle}\n        overlaySvg={computedOverlaySvg}\n        overlayClassName={overlayClassName}\n        options={computedOptions}\n        dialog={computedDirectDialog}\n        dialogProps={dialogProps}\n        placeholder={placeholder}\n        children={children}\n        imageProps={imageProps}\n        renderImage={renderImage}\n      />\n    )\n  }\n  \n  // Spread mode: for print with left/right pages\n  if (mode === \"spread\") {\n    const spreadComponent = (\n      <ImageSpread\n        {...baseProps}\n        side={side}\n      />\n    )\n    \n    if (needsImageWithOptions) {\n      return (\n        <ImageWithOptions\n          className={className}\n          style={style}\n          overlaySvg={computedOverlaySvg}\n          overlayClassName={overlayClassName}\n          options={computedOptions}\n          dialog={computedDirectDialog}\n          dialogProps={dialogProps}\n        >\n          {spreadComponent}\n          {children}\n        </ImageWithOptions>\n      )\n    }\n    \n    return spreadComponent\n  }\n  \n  // Bleed mode: for print with bleed calculations\n  // For bleed mode with overlay/options, or with direct dialog, use ImageBleedWithOverlay\n  if (needsImageWithOptions && (computedOverlaySvg || computedOptions?.length || computedDirectDialog)) {\n    return (\n      <ImageBleedWithOverlay\n        className={className}\n        style={style}\n        overlaySvg={computedOverlaySvg}\n        overlayClassName={overlayClassName}\n        options={computedOptions}\n        dialog={computedDirectDialog}\n        dialogProps={dialogProps}\n        bleedProps={baseProps}\n      >\n        {children}\n      </ImageBleedWithOverlay>\n    )\n  }\n  \n  // Simple bleed without overlay/options\n  return (\n    <ImageBleed {...baseProps} />\n  )\n}\n\nexport default ImageBlock\nexport type { ImageOption }\n","import { useContext, useState } from \"react\";\nimport { ConfigContext } from '../config/config-provider'; // Import the ConfigContext\nimport { getDialogProps } from './dialog-props';\nimport './../styles/uhuu-indicators.css';\n\n\ninterface EditableProps {    \n  className?: string;\n  dialog?: object;\n  children?: React.ReactNode;\n}\n\nconst Editable = (props: EditableProps) => {\n  const config = useContext(ConfigContext);  \n  // Get page dimensions and bleed from props or use defaults (from context if not provided)  \n  \n  return (    \n      <div \n        className={props.className} \n        {...getDialogProps(props, config)}\n      >\n        {props.children}\n      </div>    \n  );\n};\n\nexport default Editable;","/**\n * Page Group Utilities\n * \n * Locked schema with explicit types and kind discriminator.\n * All helpers and reducers use these types for consistency.\n */\n\nimport type { ComponentType } from 'react';\nimport type { PageDataBinding } from './data-binding';\n\nexport type IntegrationRequirement = 'required' | 'optional' | 'none';\n\nexport type IntegrationConfig = {\n  mode?: IntegrationRequirement;\n};\n\nexport type PageComponentProps = {\n  integration?: any;\n  payload?: any;\n  pageId?: string;\n  templateId?: string;\n  pageNum?: number;\n  componentKey?: string;\n  page?: StandalonePage;\n  pagePayload?: any;\n  parentGroup?: PageGroup;\n  dataBinding?: PageDataBinding;\n};\n\nexport type PageComponent = ComponentType<PageComponentProps>;\n\nexport type StandalonePage = {\n  kind: 'page';\n  id: string;                    // Instance ID (unique)\n  componentKey?: string;         // Template key for component resolution\n  dataKey?: string;           // Optional payload data key â€” pages with the same dataKey share a payload slot across layout variants\n  templateId?: string;          // Reference to template (for repeatable pages)\n  label?: string;\n  className?: string;           // CSS classes for page-sheet container (e.g., background colors for bleed)\n  repeatable?: boolean;         // Template metadata: whether it can be added again\n  maxInstances?: number | null; // Template metadata: max allowed instances\n  integration?: IntegrationRequirement | IntegrationConfig;\n  pageNum?: number; // Derived, not stored in state\n  component?: PageComponent; // Optional component for this page\n  [key: string]: any; // Allow additional props\n};\n\nexport type PageGroup = {\n  kind: 'group';\n  id: string;                    // Instance ID (unique)\n  templateId?: string;          // Reference to template blueprint\n  repeatable?: boolean;         // Can this be added multiple times?\n  maxInstances?: number | null; // Max instances allowed (null = unlimited)\n  integration?: IntegrationRequirement | IntegrationConfig;\n  label?: string;\n  pages: Omit<StandalonePage, 'pageNum' | 'kind'>[]; // Internal pages (no pageNum, no kind, but can have renderer)\n  pageNum?: never; // Groups don't have pageNum\n  [key: string]: any; // Allow integration metadata and custom fields\n};\n\nexport type PageItem = StandalonePage | PageGroup;\n\n// Payload persistence helpers\nexport const DEFAULT_PAGE_EDITOR_STATE_KEY = 'uhuu_page_editor';\n\nexport type PageEditorState = {\n  key: string;\n  items: PageItem[];\n  totalPages: number;\n  updatedAt: string;\n};\n\n// Page filtering types for conditional rendering\nexport type RenderMode = 'all' | 'cover' | 'text' | 'custom';\n\nexport type PageRange = {\n  start: number; // 1-based index, supports negative indices (-1 = last page, -2 = second to last)\n  end: number;   // Inclusive\n};\n\nexport type PageFilterConfig = {\n  mode?: RenderMode;\n  ranges?: PageRange[]; // Used with 'custom' mode\n  coverPageCount?: number; // Number of pages at start/end for 'cover' mode (default: 2)\n};\n\n// Type guards (using kind discriminator - much safer than checking for pages property)\nexport function isPageGroup(item: PageItem): item is PageGroup {\n  return item.kind === 'group';\n}\n\n/**\n * Flatten items to get all pages with derived pageNum\n * Internal function used by getTotalPageCount\n */\nfunction flattenPages(items: PageItem[]): Array<StandalonePage & { pageNum: number }> {\n  const result: Array<StandalonePage & { pageNum: number }> = [];\n  let pageNum = 1;\n  \n  for (const item of items) {\n    if (isPageGroup(item)) {\n      // Group: add all pages from the group\n      for (const page of item.pages) {\n        result.push({ \n          ...page, \n          kind: 'page' as const,\n          pageNum: pageNum++ \n        } as StandalonePage & { pageNum: number });\n      }\n    } else {\n      // Standalone page\n      result.push({ \n        ...item, \n        pageNum: pageNum++ \n      });\n    }\n  }\n  \n  return result;\n}\n\n/**\n * Calculate and assign pageNum to all pages (central source of truth)\n * Returns items with pageNum derived\n */\nexport function updatePageNumbers(items: PageItem[]): Array<PageItem & { pageNum?: number }> {\n  const result: Array<PageItem & { pageNum?: number }> = [];\n  let pageNum = 1;\n  \n  for (const item of items) {\n    if (isPageGroup(item)) {\n      // Group: update pages within the group\n      const updatedPages = item.pages.map(page => ({\n        ...page,\n        kind: 'page' as const,\n        pageNum: pageNum++,\n      }));\n      result.push({\n        ...item,\n        pages: updatedPages\n      });\n    } else {\n      // Standalone page\n      result.push({\n        ...item,\n        pageNum: pageNum++\n      });\n    }\n  }\n  \n  return result;\n}\n\n/**\n * Count all pages including those in groups\n */\nexport function getTotalPageCount(items: PageItem[]): number {\n  return flattenPages(items).length;\n}\n\n// Reorder utilities\nexport type ReorderItem = {\n  kind: 'page' | 'group';\n  id: string;\n  label?: string;\n  pageComponent?: PageComponent; // Component for standalone pages\n  pageComponentKey?: string; // Component key for standalone pages\n  firstPageComponent?: PageComponent; // Component for first page in groups\n  firstPageComponentKey?: string; // Component key for first page in groups\n  [key: string]: any;\n}\n\n/**\n * Transform items for reorder dialog (groups appear as single units)\n */\nexport function transformItemsForReorder(items: PageItem[]): ReorderItem[] {\n  return items.map(item => {\n    const strictPosition = (item as any).strictPosition;\n    if (isPageGroup(item)) {\n      // For groups, create a representation with first page info\n      const firstPage = item.pages[0];\n      const firstPageComponentKey = firstPage?.componentKey ?? firstPage?.id;\n      return {\n        kind: 'group' as const,\n        id: item.id,\n        groupId: item.id,\n        firstPageId: firstPage?.id,\n        firstPageComponentKey,\n        firstPageComponent: firstPage?.component, // Pass component from first page\n        pageCount: item.pages.length,\n        label: item.label || `${item.id} (${item.pages.length} pages)`,\n        strictPosition // Preserve strictPosition\n      };\n    } else {\n      // Standalone page\n      const pageComponentKey = item.componentKey ?? item.id;\n      return {\n        kind: 'page' as const,\n        id: item.id,\n        label: item.label,\n        pageId: item.id,\n        pageComponentKey,\n        pageLabel: item.label,\n        pageNum: item.pageNum,\n        pageComponent: item.component, // Pass component from page\n        strictPosition // Preserve strictPosition\n      };\n    }\n  });\n}\n\n/**\n * Restore group structure after reorder\n */\nexport function restoreItemsFromReorder(reorderedItems: ReorderItem[], originalItems: PageItem[]): PageItem[] {\n  // Create a map of original items by ID\n  const originalItemsMap = new Map<string, PageItem>();\n  originalItems.forEach(item => {\n    originalItemsMap.set(item.id, item);\n  });\n  \n  // Reconstruct items array in the new order\n  const restored: PageItem[] = [];\n  for (const reorderedItem of reorderedItems) {\n    const original = originalItemsMap.get(reorderedItem.id);\n    if (original) {\n      restored.push(original);\n    }\n  }\n  \n  return restored;\n}\n\n/**\n * Normalize items to ensure they carry a `kind` discriminator.\n * Safely converts legacy shapes that lack `kind` into the locked schema.\n */\nexport function normalizePageItems(items: Array<PageItem | Omit<PageItem, 'kind'> & { pages?: any[] }>): PageItem[] {\n  return items.map((item) => {\n    if ('kind' in item && (item as any).kind) {\n      return item as PageItem;\n    }\n\n    const maybeGroup = (item as any).pages && Array.isArray((item as any).pages);\n    if (maybeGroup) {\n      return {\n        kind: 'group' as const,\n        ...(item as any),\n        pages: ((item as any).pages ?? []).map((page: any) => {\n          const { kind: _ignored, ...rest } = page || {};\n          return {\n            kind: 'page' as const,\n            ...rest,\n          };\n        }),\n      };\n    }\n\n    const { kind: _ignored, ...rest } = item as any;\n    return {\n      kind: 'page' as const,\n      ...rest,\n    };\n  });\n}\n\n/**\n * Build a persistable state object for embedding into payloads.\n * Page numbers are derived and therefore omitted from persisted state.\n */\nexport function buildPageEditorState(\n  items: PageItem[],\n  key: string = DEFAULT_PAGE_EDITOR_STATE_KEY\n): PageEditorState {\n  const normalized = normalizePageItems(items);\n  return {\n    key,\n    items: normalized,\n    totalPages: getTotalPageCount(normalized),\n    updatedAt: new Date().toISOString(),\n  };\n}\n\n/**\n * Read persisted state from a payload object.\n * Returns normalized items or null when not present.\n */\nexport function readPageEditorState(\n  payload: any,\n  key: string = DEFAULT_PAGE_EDITOR_STATE_KEY\n): PageEditorState | null {\n  const maybeState = payload?.[key];\n  if (!maybeState?.items) return null;\n  const normalizedItems = normalizePageItems(maybeState.items as PageItem[]);\n  return {\n    key,\n    items: normalizedItems,\n    totalPages: getTotalPageCount(normalizedItems),\n    updatedAt: maybeState.updatedAt || new Date().toISOString(),\n  };\n}\n\n/**\n * Helper to produce a new payload object with the page editor state embedded.\n * Does not mutate the provided payload object.\n */\nexport function mergePageEditorStateIntoPayload(\n  payload: any,\n  items: PageItem[],\n  key: string = DEFAULT_PAGE_EDITOR_STATE_KEY\n) {\n  const state = buildPageEditorState(items, key);\n  return { ...(payload ?? {}), [key]: state };\n}\n\n/**\n * Generate a unique ID for instances\n */\nexport function generateUID(): string {\n  return Math.random()\n    .toString(36)\n    .slice(2, 11);\n}\n\n/**\n * Instantiate a standalone page from a template\n */\nexport function instantiatePage(\n  templateId: string,\n  componentKey: string,\n  overrides?: { \n    label?: string; \n    repeatable?: boolean;\n    maxInstances?: number | null;\n    integration?: IntegrationRequirement | IntegrationConfig;\n    [key: string]: any;\n  }\n): StandalonePage {\n  const instanceId = overrides?.repeatable ? generateUID() : templateId;\n\n  return {\n    kind: 'page',\n    id: instanceId,\n    componentKey,\n    templateId,\n    label: overrides?.label,\n    repeatable: overrides?.repeatable,\n    maxInstances: overrides?.maxInstances,\n    ...overrides,\n  };\n}\n\nexport type ComponentKeyEntry = string | { key: string; dataKey?: string };\n\n/**\n * Instantiate a group from a template.\n *\n * `componentKeys` accepts either plain strings or `{ key, dataKey }` objects.\n * When `dataKey` is provided the page's data is stored under that key instead\n * of the component key â€” pages across different layout variants that share the same\n * `dataKey` will read and write the same data slot, preserving data on layout switch.\n */\nexport function instantiateGroup(\n  templateId: string,\n  componentKeys: ComponentKeyEntry[],\n  overrides?: {\n    label?: string;\n    repeatable?: boolean;\n    maxInstances?: number | null;\n    integration?: IntegrationRequirement | IntegrationConfig;\n    [key: string]: any;\n  }\n): PageGroup {\n  const instanceId = overrides?.repeatable ? generateUID() : templateId;\n\n  return {\n    kind: 'group',\n    id: instanceId,\n    templateId,\n    label: overrides?.label,\n    repeatable: overrides?.repeatable ?? false,\n    maxInstances: overrides?.maxInstances ?? null,\n    pages: componentKeys.map((entry, idx) => {\n      const key = typeof entry === 'string' ? entry : entry.key;\n      const dataKey = typeof entry === 'string' ? undefined : entry.dataKey;\n      return {\n        id: `${instanceId}__${dataKey ?? key}__${idx}`,\n        componentKey: key,\n        templateId: key,\n        ...(dataKey ? { dataKey } : {}),\n      };\n    }),\n    ...overrides,\n  };\n}\n\n/**\n * Resolve a page index (supports negative indices)\n * @param index - Page index (1-based, negative from end)\n * @param totalPages - Total number of pages\n * @returns Resolved 1-based page number\n */\nfunction resolvePageIndex(index: number, totalPages: number): number {\n  if (index < 0) {\n    // Negative index: -1 = last page, -2 = second to last\n    return totalPages + index + 1;\n  }\n  return index;\n}\n\n/**\n * Check if a page number is in any of the specified ranges\n * @param pageNum - 1-based page number\n * @param ranges - Array of page ranges\n * @param totalPages - Total number of pages\n */\nfunction isPageInRanges(pageNum: number, ranges: PageRange[], totalPages: number): boolean {\n  for (const range of ranges) {\n    const start = resolvePageIndex(range.start, totalPages);\n    const end = resolvePageIndex(range.end, totalPages);\n    \n    if (pageNum >= start && pageNum <= end) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get page ranges based on render mode\n * @param mode - Render mode\n * @param totalPages - Total number of pages\n * @param coverPageCount - Number of pages at start/end for cover mode\n */\nfunction getRangesForMode(mode: RenderMode, totalPages: number, coverPageCount: number = 2): PageRange[] {\n  switch (mode) {\n    case 'all':\n      return [{ start: 1, end: totalPages }];\n    \n    case 'cover':\n      // First N pages and last N pages\n      return [\n        { start: 1, end: coverPageCount },\n        { start: -coverPageCount, end: -1 }\n      ];\n    \n    case 'text':\n      // Everything except first N and last N pages\n      if (totalPages <= coverPageCount * 2) {\n        // Not enough pages for text mode\n        return [];\n      }\n      return [{ start: coverPageCount + 1, end: -(coverPageCount + 1) }];\n    \n    case 'custom':\n    default:\n      return [];\n  }\n}\n\n/**\n * Filter items based on page filter configuration\n * @param items - Page items to filter\n * @param filterConfig - Filter configuration\n * @returns Filtered items maintaining structure (groups with filtered pages)\n */\nexport function filterPageItems(items: PageItem[], filterConfig?: PageFilterConfig): PageItem[] {\n  // No filter or 'all' mode: return all items\n  if (!filterConfig || filterConfig.mode === 'all') {\n    return items;\n  }\n\n  const totalPages = getTotalPageCount(items);\n  const mode = filterConfig.mode ?? 'all';\n  const coverPageCount = filterConfig.coverPageCount ?? 2;\n  \n  // Get ranges to include\n  const ranges = mode === 'custom' && filterConfig.ranges \n    ? filterConfig.ranges \n    : getRangesForMode(mode, totalPages, coverPageCount);\n\n  if (ranges.length === 0) {\n    return [];\n  }\n\n  // Filter items based on their existing page numbers\n  const filtered: PageItem[] = [];\n\n  for (const item of items) {\n    if (isPageGroup(item)) {\n      // Filter pages within the group based on their page numbers\n      const filteredPages = item.pages.filter((page) => {\n        return page.pageNum && isPageInRanges(page.pageNum, ranges, totalPages);\n      });\n\n      // Only include group if it has pages after filtering\n      if (filteredPages.length > 0) {\n        filtered.push({\n          ...item,\n          pages: filteredPages\n        });\n      }\n    } else {\n      // Standalone page - check if it should be included\n      if (item.pageNum && isPageInRanges(item.pageNum, ranges, totalPages)) {\n        filtered.push(item);\n      }\n    }\n  }\n\n  return filtered;\n}\n","/**\n * Integration Data Utilities\n * \n * Essential utilities for working with integration data in multi-instance templates.\n */\n\nimport type { PageItem } from './page-group-utils';\nimport { isPageGroup } from './page-group-utils';\n\n/**\n * Get integration data for a specific page/group instance\n */\nfunction getIntegrationData(payload: any, instanceId: string): any {\n  if (!payload?.integrations) return undefined;\n  return payload.integrations[instanceId];\n}\n\nexport function resolveIntegrationInstanceId(\n  page: { id: string },\n  parentGroup?: PageItem\n): string | null {\n  if (parentGroup && isPageGroup(parentGroup)) {\n    return parentGroup.id;\n  }\n  return page?.id ?? null;\n}\n\nexport function resolveIntegrationBinding(\n  payload: any,\n  page: { id: string },\n  parentGroup?: PageItem\n): { instanceId: string | null; integration?: any } {\n  const instanceId = resolveIntegrationInstanceId(page, parentGroup);\n  if (!instanceId) return { instanceId: null, integration: undefined };\n  return {\n    instanceId,\n    integration: getIntegrationData(payload, instanceId),\n  };\n}\n\n/**\n * Resolve integration data for a page component\n * For group pages, prefer parent group's integration data\n */\nexport function resolveIntegrationForPage(\n  payload: any,\n  page: { id: string },\n  parentGroup?: PageItem\n): any {\n  const binding = resolveIntegrationBinding(payload, page, parentGroup);\n  return binding.integration;\n}\n\nexport function buildIntegrationPath(\n  instanceId?: string | null,\n  fieldPath?: string\n) {\n  if (!instanceId) return null;\n  const base = `integrations.${instanceId}`;\n  if (!fieldPath) return base;\n  return `${base}.${fieldPath}`;\n}\n\n/**\n * Parse a dialog path to determine if it targets integration data\n * Returns the instance ID if the path targets integrations, null otherwise\n */\nexport function parseIntegrationPath(path: string): {\n  instanceId: string | null;\n  fieldPath: string;\n  isIntegrationPath: boolean;\n} {\n  if (!path) {\n    return { instanceId: null, fieldPath: path, isIntegrationPath: false };\n  }\n  \n  // Check if path starts with \"integrations.\"\n  const integrationPrefix = 'integrations.';\n  if (path.startsWith(integrationPrefix)) {\n    const afterPrefix = path.slice(integrationPrefix.length);\n    const dotIndex = afterPrefix.indexOf('.');\n    \n    if (dotIndex > 0) {\n      // Path like \"integrations.group_1__123.field.subfield\"\n      const instanceId = afterPrefix.slice(0, dotIndex);\n      const fieldPath = afterPrefix.slice(dotIndex + 1);\n      return { instanceId, fieldPath, isIntegrationPath: true };\n    } else {\n      // Path like \"integrations.group_1__123\" (targets entire integration)\n      const instanceId = afterPrefix;\n      return { instanceId, fieldPath: '', isIntegrationPath: true };\n    }\n  }\n  \n  return { instanceId: null, fieldPath: path, isIntegrationPath: false };\n}\n\n/**\n * Set a nested value in an object using dot notation path\n */\nfunction setNestedValue(obj: any, path: string, value: any): any {\n  if (!path) return value;\n  \n  const keys = path.split('.');\n  const result = { ...obj };\n  let current: any = result;\n  \n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i];\n    if (!(key in current) || typeof current[key] !== 'object' || current[key] === null) {\n      current[key] = {};\n    } else {\n      current[key] = { ...current[key] };\n    }\n    current = current[key];\n  }\n  \n  const lastKey = keys[keys.length - 1];\n  current[lastKey] = value;\n  \n  return result;\n}\n\n/**\n * Update integration data in payload using a path-based update\n * Handles nested field updates (e.g., \"integrations.id.overrides.heroImage.url\")\n */\nexport function updateIntegrationByPath(\n  payload: any,\n  path: string,\n  value: any\n): any {\n  const parsed = parseIntegrationPath(path);\n  \n  if (!parsed.isIntegrationPath || !parsed.instanceId) {\n    // Not an integration path, return payload as-is\n    return payload;\n  }\n  \n  const { instanceId, fieldPath } = parsed;\n  const currentIntegration = getIntegrationData(payload, instanceId) || {};\n  \n  // Update nested field using dot notation\n  const updatedIntegration = setNestedValue(\n    currentIntegration,\n    fieldPath,\n    value\n  );\n  \n  return {\n    ...payload,\n    integrations: {\n      ...(payload?.integrations || {}),\n      [instanceId]: updatedIntegration,\n    },\n  };\n}\n","import * as React from 'react';\nimport type { PageOption } from './page-editor';\nimport { mergePageEditorStateIntoPayload, PageItem, DEFAULT_PAGE_EDITOR_STATE_KEY } from './page-group-utils';\nimport { updateIntegrationByPath } from './integration-utils';\n\ntype PagePayloadTarget = string | { id?: string; templateId?: string; componentKey?: string } | PageItem | null | undefined;\n\nexport function getPagePayload(payload: any, target: PagePayloadTarget) {\n  if (!payload || !target) return undefined;\n  \n  const targetId = typeof target === 'string' ? target : target?.id;\n  const templateId = typeof target === 'string' ? undefined : (target as any)?.templateId ?? (target as any)?.componentKey;\n  const fallbackId = typeof target === 'string' ? undefined : (target as any)?.componentKey;\n  const candidateKeys = Array.from(\n    new Set(\n      [targetId, templateId, fallbackId].filter(Boolean) as string[]\n    )\n  );\n\n  for (const key of candidateKeys) {\n    if (payload?.pages?.[key] !== undefined) return payload.pages[key];\n  }\n\n  // Allow group-level payloads\n  for (const key of candidateKeys) {\n    if (payload?.groups?.[key] !== undefined) return payload.groups[key];\n  }\n\n  // Legacy fallback: top-level keys keyed by id/templateId\n  for (const key of candidateKeys) {\n    if ((payload as any)[key] !== undefined) return (payload as any)[key];\n  }\n\n  return undefined;\n}\n\ntype TemplateDataContextValue = {\n  payload: any;\n  setPayload: (next: any | ((prev: any) => any)) => void;\n  setPageOptionValue: (pageOrGroupId: string, key: string, value: any) => void;\n  setIntegrationPayload: (instanceId: string, next: any | ((prev: any) => any)) => void;\n  setIntegrationPayloadValue: (instanceId: string, key: string, value: any) => void;\n  removeIntegrationPayload: (instanceId: string) => void;\n  updateIntegrationByDialogPath: (path: string, value: any) => void;\n  mergePageEditorState: (items: PageItem[], key?: string) => void;\n  getPagePayload: (target: PagePayloadTarget) => any;\n};\n\nexport const TemplateDataContext = React.createContext<TemplateDataContextValue | null>(null);\n\n/**\n * Get the list of reserved keys that the page editor manages.\n * These keys are isolated from external payload updates.\n */\nfunction getReservedKeys(stateKey: string = DEFAULT_PAGE_EDITOR_STATE_KEY): string[] {\n  return [stateKey];\n}\n\n/**\n * Merge external payload while preserving reserved keys managed by page editor.\n * External payload is the source of truth for all keys except reserved ones.\n */\nfunction mergeExternalPayload(\n  currentPayload: any,\n  externalPayload: any,\n  reservedKeys: string[]\n): any {\n  if (!externalPayload) return currentPayload;\n  if (!currentPayload) return externalPayload;\n\n  // Start with external payload (source of truth for non-reserved keys)\n  const merged = { ...externalPayload };\n  \n  // Overlay reserved keys from current payload (page editor owns these)\n  reservedKeys.forEach(key => {\n    if (currentPayload[key] !== undefined) {\n      merged[key] = currentPayload[key];\n    }\n  });\n\n  return merged;\n}\n\nexport function TemplateDataProvider({\n  payload,\n  onPayloadChange,\n  children,\n  stateKey = DEFAULT_PAGE_EDITOR_STATE_KEY,\n}: {\n  payload?: any;\n  onPayloadChange?: (nextPayload: any) => void;\n  children: React.ReactNode;\n  stateKey?: string;\n}) {\n  const [currentPayload, setCurrentPayload] = React.useState(payload ?? {});\n  const lastExternalPayloadRef = React.useRef<any>(null);\n  const isInternalUpdateRef = React.useRef(false);\n  const lastInternalPayloadRef = React.useRef<any>(null);\n  const lastInternalTimestampRef = React.useRef<number>(0);\n  const isInitialMountRef = React.useRef(true);\n\n  // Serialize payload for comparison (simple deep equality check)\n  const serializePayload = React.useCallback((p: any) => {\n    try {\n      return JSON.stringify(p);\n    } catch {\n      return String(p);\n    }\n  }, []);\n\n  // Get reserved keys for this provider instance\n  const reservedKeys = React.useMemo(() => getReservedKeys(stateKey), [stateKey]);\n\n  // Helper to create payload without reserved keys for comparison\n  const payloadWithoutReservedKeys = React.useCallback((p: any, keys: string[]) => {\n    if (!p) return null;\n    const filtered = { ...p };\n    keys.forEach(key => {\n      delete filtered[key];\n    });\n    return filtered;\n  }, []);\n\n  // When external payload changes, merge it while preserving reserved keys\n  React.useEffect(() => {\n    // Handle initial mount - set initial payload\n    if (isInitialMountRef.current) {\n      isInitialMountRef.current = false;\n      if (payload) {\n        console.log('[TemplateDataProvider] Initial mount - setting payload:', payload);\n        lastExternalPayloadRef.current = payload;\n        setCurrentPayload(payload);\n      }\n      return;\n    }\n\n    // Skip if this is an internal update (from setPayload)\n    if (isInternalUpdateRef.current) {\n      isInternalUpdateRef.current = false;\n      console.log('[TemplateDataProvider] Skipping internal update');\n      // Store the payload we just set internally to detect round-trips\n      lastInternalPayloadRef.current = payload;\n      lastInternalTimestampRef.current = Date.now();\n      // Update lastExternalPayloadRef to prevent immediate re-merge\n      lastExternalPayloadRef.current = payload;\n      return;\n    }\n\n    // Skip if payload hasn't actually changed (same object reference)\n    if (payload === lastExternalPayloadRef.current) {\n      console.log('[TemplateDataProvider] Skipping - same object reference');\n      return;\n    }\n\n    // Check if this is a round-trip by comparing non-reserved keys only\n    // Only check for round-trips within a short time window (500ms) to avoid blocking legitimate updates\n    const timeSinceLastInternal = Date.now() - lastInternalTimestampRef.current;\n    const isRecentInternalUpdate = timeSinceLastInternal < 500;\n    \n    if (isRecentInternalUpdate && lastInternalPayloadRef.current !== null) {\n      const currentWithoutReserved = payloadWithoutReservedKeys(payload, reservedKeys);\n      const lastInternalWithoutReserved = payloadWithoutReservedKeys(lastInternalPayloadRef.current, reservedKeys);\n      \n      const currentSerialized = currentWithoutReserved ? serializePayload(currentWithoutReserved) : null;\n      const lastInternalSerialized = lastInternalWithoutReserved ? serializePayload(lastInternalWithoutReserved) : null;\n      \n      if (currentSerialized && currentSerialized === lastInternalSerialized) {\n        // This is likely a round-trip - skip it but update the ref\n        console.log('[TemplateDataProvider] Skipping round-trip');\n        lastInternalPayloadRef.current = null; // Clear after one check\n        lastExternalPayloadRef.current = payload;\n        return;\n      }\n    }\n\n    // This is a genuine external update from $uhuu.listen or other external source - merge it\n    console.log('[TemplateDataProvider] External payload update detected, merging...', payload);\n    lastExternalPayloadRef.current = payload;\n    setCurrentPayload((prev) => {\n      if (!payload) return prev;\n      const merged = mergeExternalPayload(prev, payload, reservedKeys);\n      console.log('[TemplateDataProvider] Merged payload:', merged);\n      return merged;\n    });\n  }, [payload, reservedKeys, serializePayload, payloadWithoutReservedKeys]);\n\n  const notifyHost = React.useCallback(\n    (next: any) => {\n      onPayloadChange?.(next);\n      if (typeof window !== 'undefined' && (window as any).$uhuu?.initPayload) {\n        (window as any).$uhuu.initPayload(next);\n      }\n    },\n    [onPayloadChange]\n  );\n\n  /**\n   * Handle payload updates, including integration path updates from dialogs\n   * When external payload updates come in with integration paths, route them correctly\n   */\n  const setPayload = React.useCallback(\n    (next: any | ((prev: any) => any)) => {\n      isInternalUpdateRef.current = true;\n      setCurrentPayload((prev) => {\n        const resolved = typeof next === 'function' ? (next as (prev: any) => any)(prev) : next;\n        \n        // Check if this update contains integration path updates from dialogs\n        // The SDK/document editor may send updates with paths like \"integrations.id.field\"\n        // We need to ensure these are properly structured\n        let finalPayload = resolved;\n        \n        // If the payload has a _dialogUpdate flag or similar, process integration paths\n        // This handles cases where dialogs update integration data via path-based updates\n        if (resolved && typeof resolved === 'object') {\n          // Check for any top-level keys that might be integration paths (from dialog updates)\n          // The document editor might send updates that need to be routed to integrations\n          const integrationKeys = Object.keys(resolved).filter(key => \n            key.startsWith('integrations.') || key === 'integrations'\n          );\n          \n          if (integrationKeys.length > 0 && resolved.integrations) {\n            // Integration data is already properly structured, use as-is\n            finalPayload = resolved;\n          }\n        }\n        \n        // Store the resolved payload to detect round-trips\n        lastInternalPayloadRef.current = finalPayload;\n        lastInternalTimestampRef.current = Date.now();\n        notifyHost(finalPayload);\n        return finalPayload;\n      });\n    },\n    [notifyHost]\n  );\n\n  const setPageOptionValue = React.useCallback(\n    (pageOrGroupId: string, key: string, value: any) => {\n      setPayload((prev: any) => ({\n        ...(prev ?? {}),\n        pages: {\n          ...(prev?.pages ?? {}),\n          [pageOrGroupId]: {\n            ...(prev?.pages?.[pageOrGroupId] ?? {}),\n            [key]: value,\n          },\n        },\n      }));\n    },\n    [setPayload]\n  );\n\n  const setIntegrationPayload = React.useCallback(\n    (instanceId: string, next: any | ((prev: any) => any)) => {\n      setPayload((prev: any) => {\n        const prevIntegrations = prev?.integrations ?? {};\n        const current = prevIntegrations[instanceId];\n        const resolved = typeof next === 'function' ? (next as (prev: any) => any)(current) : next;\n        return {\n          ...(prev ?? {}),\n          integrations: {\n            ...prevIntegrations,\n            [instanceId]: resolved,\n          },\n        };\n      });\n    },\n    [setPayload]\n  );\n\n  const setIntegrationPayloadValue = React.useCallback(\n    (instanceId: string, key: string, value: any) => {\n      setIntegrationPayload(instanceId, (prevIntegration: any) => ({\n        ...(prevIntegration ?? {}),\n        [key]: value,\n      }));\n    },\n    [setIntegrationPayload]\n  );\n\n  const removeIntegrationPayload = React.useCallback(\n    (instanceId: string) => {\n      setPayload((prev: any) => {\n        if (!prev?.integrations || !prev.integrations[instanceId]) {\n          return prev;\n        }\n        const { [instanceId]: removed, ...remainingIntegrations } = prev.integrations;\n        return {\n          ...prev,\n          integrations: Object.keys(remainingIntegrations).length > 0 ? remainingIntegrations : undefined,\n        };\n      });\n    },\n    [setPayload]\n  );\n\n  /**\n   * Update integration data using a path-based update (for dialog compatibility)\n   * Handles paths like \"integrations.instanceId.field.subfield\"\n   */\n  const updateIntegrationByDialogPath = React.useCallback(\n    (path: string, value: any) => {\n      setPayload((prev: any) => updateIntegrationByPath(prev, path, value));\n    },\n    [setPayload]\n  );\n\n  const mergePageEditorState = React.useCallback(\n    (items: PageItem[], key?: string) => {\n      const effectiveKey = key ?? stateKey;\n      setPayload((prev: any) => mergePageEditorStateIntoPayload(prev, items, effectiveKey));\n    },\n    [setPayload, stateKey]\n  );\n\n  const resolvePagePayload = React.useCallback(\n    (target: PagePayloadTarget) => getPagePayload(currentPayload, target),\n    [currentPayload]\n  );\n\n  const value = React.useMemo(\n    () => ({\n      payload: currentPayload,\n      setPayload,\n      setPageOptionValue,\n      setIntegrationPayload,\n      setIntegrationPayloadValue,\n      removeIntegrationPayload,\n      updateIntegrationByDialogPath,\n      mergePageEditorState,\n      getPagePayload: resolvePagePayload,\n    }),\n    [\n      currentPayload,\n      setPayload,\n      setPageOptionValue,\n      setIntegrationPayload,\n      setIntegrationPayloadValue,\n      removeIntegrationPayload,\n      updateIntegrationByDialogPath,\n      mergePageEditorState,\n      resolvePagePayload,\n    ]\n  );\n\n  return <TemplateDataContext.Provider value={value}>{children}</TemplateDataContext.Provider>;\n}\n\nexport function useTemplateData() {\n  const ctx = React.useContext(TemplateDataContext);\n  if (!ctx) {\n    throw new Error('useTemplateData must be used within a TemplateDataProvider');\n  }\n  return ctx;\n}\n\n// JSON-friendly option builder: definitions â†’ PageOption[] bound to payload.pages\nexport type PayloadOptionDefinition = Omit<PageOption, 'getValue' | 'onChange' | 'applyPatch'> & {\n  defaultValue?: any;\n  field?: string;\n};\n\nfunction toDefault(def: PayloadOptionDefinition) {\n  if (def.defaultValue !== undefined) return def.defaultValue;\n  if (def.type === 'toggle') return false;\n  if (def.type === 'slider' || def.type === 'counter') return 0;\n  return '';\n}\n\nfunction parseValue(def: PayloadOptionDefinition, raw: string | number | boolean) {\n  if (def.type === 'toggle') return raw === true || raw === 'true';\n  if (def.type === 'slider' || def.type === 'counter') return Number(raw);\n  return raw;\n}\n\nexport function buildPayloadPageOption(\n  def: PayloadOptionDefinition,\n  payload: any,\n  setPageOptionValue: (pageOrGroupId: string, key: string, value: any) => void\n): PageOption {\n  const field = def.field ?? def.id;\n  const base = def as Omit<PageOption, 'getValue' | 'onChange' | 'applyPatch'>;\n  return {\n    ...base,\n    getValue: (item: PageItem) => {\n      const stored = payload?.pages?.[item.id]?.[field];\n      if (stored === undefined) return toDefault(def);\n      if (def.type === 'toggle') return !!stored;\n      return stored;\n    },\n    onChange: (pageOrGroupId: string, value: string) => {\n      setPageOptionValue(pageOrGroupId, field, parseValue(def, value));\n    },\n  } as PageOption;\n}\n\nexport function buildPayloadPageOptions(\n  definitions: PayloadOptionDefinition[],\n  payload: any,\n  setPageOptionValue: (pageOrGroupId: string, key: string, value: any) => void\n): PageOption[] {\n  return definitions.map((def) =>\n    buildPayloadPageOption(def, payload, setPageOptionValue)\n  );\n}\n\nexport function usePayloadPageOptions(definitions: PayloadOptionDefinition[]): PageOption[] {\n  const { payload, setPageOptionValue } = useTemplateData();\n\n  return React.useMemo(\n    () => buildPayloadPageOptions(definitions, payload, setPageOptionValue),\n    [definitions, payload, setPageOptionValue]\n  );\n}\n","import * as React from \"react\"\nimport { useState, useRef, useEffect, createContext, useContext } from \"react\"\nimport { Button } from \"../../ui/button\"\nimport { ZoomIn, ZoomOut, RotateCcw, Plus, ChevronDown, UnfoldVertical, UnfoldHorizontal, Maximize } from \"lucide-react\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"../../ui/dropdown-menu\"\nimport { useShouldHideUI } from \"../interactive-mode-context\"\nimport \"./section-page-resizer.css\"\n\n// Context for sharing zoom state across all sections\ninterface ZoomContextType {\n  zoom: number\n  scaleValue: number\n  hideUI: boolean\n}\n\nconst ZoomContext = createContext<ZoomContextType>({ zoom: 100, scaleValue: 1, hideUI: false })\n\ninterface SectionPageResizerProps {\n  children: React.ReactNode\n  className?: string\n  defaultZoom?: number\n  minZoom?: number\n  maxZoom?: number\n  onAddPage?: () => void\n  menuItems?: React.ReactNode\n  hideUI?: boolean\n  preview?: PreviewMode\n}\n\nexport type PreviewMode = \"single_page\" | \"two_pages\"\n\ninterface TwoPageSectionProps {\n  children: React.ReactNode\n  /** \"spread\" = two pages side by side, \"left\" = single page on left, \"right\" = single page on right */\n  layout?: \"spread\" | \"left\" | \"right\"\n}\n\nexport function TwoPageSection({ children, layout = \"spread\" }: TwoPageSectionProps) {\n  const { scaleValue } = useContext(ZoomContext)\n  const pairRef = useRef<HTMLDivElement>(null)\n\n  // Update pair width based on scaled content dimensions\n  useEffect(() => {\n    if (!pairRef.current) return\n\n    const updatePairWidth = () => {\n      const sections = pairRef.current?.querySelectorAll('[data-section-content]')\n      if (!sections?.length) return\n\n      // Sum natural widths of all pages in this pair\n      const totalNaturalWidth = Array.from(sections).reduce((sum, section) => {\n        const width = Number.parseInt(section.getAttribute('data-natural-width') || '0')\n        return sum + width\n      }, 0)\n\n      if (totalNaturalWidth > 0) {\n        const scaledWidth = totalNaturalWidth * scaleValue\n        pairRef.current?.style.setProperty('--uhuu-group-pair-width', `${scaledWidth}px`)\n      }\n    }\n\n    updatePairWidth()\n\n    const resizeObserver = new ResizeObserver(updatePairWidth)\n    const sections = pairRef.current.querySelectorAll('[data-section-content]')\n    sections.forEach((section) => resizeObserver.observe(section))\n\n    return () => resizeObserver.disconnect()\n  }, [children, scaleValue])\n\n  return (\n    <div\n      ref={pairRef}\n      className={`two-pages-pair two-pages-pair--${layout}`}\n    >\n      {children}\n    </div>\n  )\n}\n\ninterface SectionProps {\n  children: React.ReactNode\n  title: string\n  className?: string\n  controls?: React.ReactNode\n  origin?: \"left\" | \"right\" | \"center\"\n}\n\ntype FitMode = \"none\" | \"width\" | \"height\" | \"both\"\n\n// Individual Section Component\nexport function Section({ children, title, className = \"\", controls, origin = \"center\" }: SectionProps) {\n  const { scaleValue, hideUI } = useContext(ZoomContext)\n  const contentRef = useRef<HTMLDivElement>(null)\n  const [contentHeight, setContentHeight] = useState<number>(0)\n  const [contentWidth, setContentWidth] = useState<number>(0)\n\n  // Calculate and update content dimensions\n  useEffect(() => {\n    if (contentRef.current) {\n      const updateDimensions = () => {\n        const element = contentRef.current\n        if (element) {\n          const originalTransform = element.style.transform\n          element.style.transform = \"scale(1)\"\n\n          const naturalHeight = element.scrollHeight\n          const naturalWidth = element.scrollWidth\n\n          element.style.transform = originalTransform\n\n          setContentHeight(naturalHeight)\n          setContentWidth(naturalWidth)\n        }\n      }\n\n      updateDimensions()\n\n      const resizeObserver = new ResizeObserver(updateDimensions)\n      resizeObserver.observe(contentRef.current)\n\n      return () => {\n        resizeObserver.disconnect()\n      }\n    }\n  }, [children])\n\n  const scaledHeight = contentHeight * scaleValue\n  const scaledWidth = Math.max(contentWidth * scaleValue, 150)\n  \n  // Align content based on transform origin (left/right for spreads, center for single pages)\n  const alignmentMap = {\n    left: { justify: \"justify-start\", origin: \"top left\" },\n    right: { justify: \"justify-end\", origin: \"top right\" },\n    center: { justify: \"justify-center\", origin: \"top center\" },\n  }\n  const { justify: contentAlignClass, origin: transformOrigin } = alignmentMap[origin]\n\n  // If hiding UI, render children directly without controls or scaling\n  if (hideUI) {\n    return <div className={className}>{children}</div>\n  }\n\n  return (\n    <div \n      className={`group/section ${className}`}\n      style={{\n        width: `${scaledWidth}px`,\n        minWidth: \"150px\",\n      }}\n    >\n      {/* Section Header */}\n      <div>\n        {controls ?? (\n          <div className=\"px-4 py-2 border-b border-gray-200\">\n            <div className=\"text-sm font-medium text-gray-700\">{title} Controls</div>\n          </div>\n        )}\n      </div>\n\n      {/* Section Content - Scaled with dynamic height */}\n      <div\n        className=\"pt-1\"\n        style={{\n          height: scaledHeight > 0 ? `${scaledHeight + 32}px` : \"auto\",\n          minHeight: \"100px\",\n        }}\n      >\n        <div className={`flex items-start ${contentAlignClass}`}>\n          <div\n            ref={contentRef}\n            data-section-content\n            data-natural-width={contentWidth}\n            data-natural-height={contentHeight}\n            style={{\n              transform: `scale(${scaleValue})`,\n              transformOrigin,\n            }}\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Main Container with Controls\nexport default function SectionPageResizer({\n  children,\n  className = \"\",\n  defaultZoom = 100,\n  minZoom = 25,\n  maxZoom = 200,\n  onAddPage,\n  menuItems,\n  hideUI: hideUIProp,\n  preview = \"single_page\",\n}: SectionPageResizerProps) {\n  const shouldHideUI = useShouldHideUI()\n  const hideUI = hideUIProp ?? shouldHideUI\n  \n  const [zoom, setZoom] = useState(defaultZoom)\n  const [fitMode, setFitMode] = useState<FitMode>(\"none\")\n  const containerRef = useRef<HTMLDivElement>(null)\n  const contentRef = useRef<HTMLDivElement>(null)\n  const [autoFitInitialized, setAutoFitInitialized] = useState(false)\n  const [lastContainerWidth, setLastContainerWidth] = useState<number>(0)\n  const [isInitializing, setIsInitializing] = useState(true)\n\n  // Calculate fit-to-container zoom levels\n  const calculateFitZoom = (mode: FitMode) => {\n    if (!containerRef.current || !contentRef.current) return zoom\n\n    const container = containerRef.current.getBoundingClientRect()\n\n    const firstSection = contentRef.current.querySelector(\"[data-section-content]\")\n    if (!firstSection) return zoom\n\n    let contentWidth = Number.parseInt(firstSection.getAttribute(\"data-natural-width\") || \"0\")\n    const contentHeight = Number.parseInt(firstSection.getAttribute(\"data-natural-height\") || \"0\")\n\n    if (contentWidth === 0 || contentHeight === 0) return zoom\n\n    // For two-page preview, account for 2x page width when calculating fit to width\n    if (preview === \"two_pages\") {\n      contentWidth = contentWidth * 2\n    }\n\n    const availableWidth = container.width - 32\n    // Use screen height for better \"fit to height\" calculation, accounting for bottom controls\n    const availableHeight = screen.height - 120\n\n    const scaleX = (availableWidth / contentWidth) * 100\n    const scaleY = (availableHeight / contentHeight) * 100\n\n    switch (mode) {\n      case \"width\":\n        return Math.min(Math.max(scaleX, minZoom), maxZoom)\n      case \"height\":\n        return Math.min(Math.max(scaleY, minZoom), maxZoom)\n      case \"both\":\n        return Math.min(Math.max(Math.min(scaleX, scaleY), minZoom), maxZoom)\n      default:\n        return zoom\n    }\n  }\n\n  // Handle fit mode changes\n  const handleFitMode = (mode: FitMode) => {\n    setFitMode(mode)\n    if (mode !== \"none\") {\n      const newZoom = calculateFitZoom(mode)\n      setZoom(newZoom)\n    }\n  }\n\n  // Zoom in/out buttons with 25% steps\n  const zoomIn = () => {\n    const newZoom = Math.min(zoom + 25, maxZoom)\n    setZoom(newZoom)\n    setFitMode(\"none\")\n  }\n\n  const zoomOut = () => {\n    const newZoom = Math.max(zoom - 25, minZoom)\n    setZoom(newZoom)\n    setFitMode(\"none\")\n  }\n\n  // Reset zoom\n  const resetZoom = () => {\n    setZoom(defaultZoom)\n    setFitMode(\"none\")\n  }\n\n  // Handle initialization and window resize\n  useEffect(() => {\n    const handleInitialization = () => {\n      if (!containerRef.current || !contentRef.current) return\n\n      const container = containerRef.current.getBoundingClientRect()\n      const currentContainerWidth = container.width\n\n      if (!autoFitInitialized) {\n        const firstSection = contentRef.current.querySelector(\"[data-section-content]\")\n        if (firstSection) {\n          const sectionWidth = Number.parseInt(firstSection.getAttribute(\"data-natural-width\") || \"0\")\n          if (sectionWidth > 0) {\n            if (sectionWidth > currentContainerWidth - 48) {\n              const newZoom = calculateFitZoom(\"both\")\n              setFitMode(\"both\")\n              setZoom(newZoom)\n            }\n            setAutoFitInitialized(true)\n            setLastContainerWidth(currentContainerWidth)\n            setIsInitializing(false)\n            return\n          }\n        }\n        if (isInitializing) {\n          setTimeout(handleInitialization, 50)\n          return\n        }\n      }\n\n      setIsInitializing(false)\n    }\n\n    const handleResize = () => {\n      if (!containerRef.current || isInitializing) return\n\n      const container = containerRef.current.getBoundingClientRect()\n      const currentContainerWidth = container.width\n\n      if (Math.abs(currentContainerWidth - lastContainerWidth) > 10) {\n        if (fitMode !== \"none\") {\n          const newZoom = calculateFitZoom(fitMode)\n          setZoom(newZoom)\n        }\n        setLastContainerWidth(currentContainerWidth)\n      }\n    }\n\n    handleInitialization()\n\n    window.addEventListener(\"resize\", handleResize)\n    return () => {\n      window.removeEventListener(\"resize\", handleResize)\n    }\n  }, [fitMode, minZoom, maxZoom, autoFitInitialized, lastContainerWidth, isInitializing])\n\n  const scaleValue = zoom / 100\n\n  // If hiding UI, render children directly without any wrapper or controls\n  if (hideUI) {\n    return (\n      <ZoomContext.Provider value={{ zoom: 100, scaleValue: 1, hideUI: true }}>\n        <div className={className}>{children}</div>\n      </ZoomContext.Provider>\n    )\n  }\n\n  return (\n    <ZoomContext.Provider value={{ zoom, scaleValue, hideUI: false }}>\n      <div ref={containerRef} className={`flex flex-col min-h-0 ${className}`}>\n        {/* Global Controls - Unscaled */}\n        <div data-uhuu-editor className=\"fixed right-4 bottom-4 z-50 flex items-center gap-1.5 px-2.5 py-1.5 bg-white/90 backdrop-blur-md border border-gray-200/60 rounded-lg shadow-sm\">\n          {menuItems}\n          <div className=\"h-4 w-px bg-gray-200 mx-0.5\" />\n          <DropdownMenu modal={false}>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" title=\"Zoom\" className=\"text-xs font-medium text-gray-700 hover:bg-gray-100/80 h-7 px-2.5\">\n                {Math.round(zoom)}%\n                <ChevronDown className=\"w-3 h-3 ml-1 opacity-60\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent className=\"w-52 p-1.5\" align=\"end\">\n              <DropdownMenuItem\n                onClick={() => handleFitMode(\"width\")}\n                className={`cursor-pointer flex items-center ${fitMode === \"width\" ? \"bg-gray-100\" : \"\"}`}\n              >\n                <UnfoldHorizontal className=\"w-4 h-4 mr-2\" />\n                <span>Fit to Width</span>\n              </DropdownMenuItem>\n              <DropdownMenuItem\n                onClick={() => handleFitMode(\"height\")}\n                className={`cursor-pointer flex items-center ${fitMode === \"height\" ? \"bg-gray-100\" : \"\"}`}\n              >\n                <UnfoldVertical className=\"w-4 h-4 mr-2\" />\n                <span>Fit to Height</span>\n              </DropdownMenuItem>\n              <DropdownMenuItem\n                onClick={() => handleFitMode(\"both\")}\n                className={`cursor-pointer flex items-center ${fitMode === \"both\" ? \"bg-gray-100\" : \"\"}`}\n              >\n                <Maximize className=\"w-4 h-4 mr-2\" />\n                <span>Fit to Page</span>\n              </DropdownMenuItem>\n              <DropdownMenuSeparator className=\"my-1.5\" />\n              \n              {/* Zoom Controls - Compact inline layout */}\n              <div className=\"flex items-center justify-center gap-2 px-3 py-2.5\" onClick={(e) => e.stopPropagation()}>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    zoomOut()\n                  }}\n                  disabled={zoom <= minZoom}\n                  className=\"h-8 w-8 p-0 hover:bg-gray-100 disabled:opacity-40\"\n                  title=\"Zoom out (25%)\"\n                >\n                  <ZoomOut className=\"w-4 h-4\" />\n                </Button>\n                \n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={Math.round(zoom)}\n                    onChange={(e) => {\n                      const value = Number.parseInt(e.target.value)\n                      if (!isNaN(value)) {\n                        const clampedValue = Math.min(Math.max(value, minZoom), maxZoom)\n                        setZoom(clampedValue)\n                        setFitMode(\"none\")\n                      }\n                    }}\n                    onFocus={(e) => e.target.select()}\n                    className=\"w-20 pr-6 text-center text-sm text-gray-700 bg-white border border-gray-300 rounded px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all\"\n                    min={minZoom}\n                    max={maxZoom}\n                  />\n                  <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400 pointer-events-none\">%</span>\n                </div>\n                \n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    zoomIn()\n                  }}\n                  disabled={zoom >= maxZoom}\n                  className=\"h-8 w-8 p-0 hover:bg-gray-100 disabled:opacity-40\"\n                  title=\"Zoom in (25%)\"\n                >\n                  <ZoomIn className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n\n        {/* Content Container */}\n        <div ref={contentRef}>\n          <div className={preview === \"two_pages\" ? \"group_two_pages\" : \"flex flex-col items-center\"}>{children}</div>\n        </div>\n\n        <div className=\"flex justify-center pb-16\">\n          <Button size=\"sm\" variant=\"outline\" onClick={() => (onAddPage ? onAddPage() : null)}>\n            <Plus />\n          </Button>\n        </div>\n      </div>\n    </ZoomContext.Provider>\n  )\n}\n","import * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { XIcon } from \"lucide-react\"\nimport { cn } from \"./cn\"\nimport { usePortalRoot } from \"../editor-shell/portal-root\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content> {\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => {\n  const { portalContainer } = usePortalRoot();\n\n  return (\n    <SheetPortal container={portalContainer || undefined}>\n      <SheetOverlay />\n      <SheetPrimitive.Content\n        ref={ref}\n        className={cn(\n          \"fixed z-50 gap-4 bg-white p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n          side === \"top\" &&\n            \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n          side === \"bottom\" &&\n            \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n          side === \"left\" &&\n            \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n          side === \"right\" &&\n            \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100\">\n          <XIcon className=\"h-4 w-4\" />\n          <span className=\"sr-only\">Close</span>\n        </SheetPrimitive.Close>\n      </SheetPrimitive.Content>\n    </SheetPortal>\n  );\n})\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-medium text-gray-900\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-gray-500\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n\n","import * as React from 'react';\nimport { Lock } from 'lucide-react';\nimport { ReorderItem } from './page-group-utils';\nimport type { PageComponent } from './page-group-utils';\nimport { getPagePayload } from './template-data-provider';\nimport { resolveIntegrationForPage } from './integration-utils';\n\ninterface DefaultRenderThumbnailOptions {\n  // PageComponent registry: map of pageId to React component\n  pageComponents: { [pageId: string]: PageComponent };\n  \n  // Payload to pass to PageComponents\n  payload?: any;\n  \n  // Page setup dimensions (same as Pagination setup prop) - in millimeters\n  setup?: { width: number; height: number };\n  \n  // Optional: Custom thumbnail dimensions (height auto-derives from page aspect if omitted)\n  thumbnailWidth?: number;\n  thumbnailHeight?: number;\n}\n\n/**\n * Creates a default renderThumbnail function that renders actual PageComponents\n * instead of reference images. This ensures thumbnails accurately represent\n * the rendered page content.\n * \n * @internal - This is an internal utility, not part of the public API\n */\nexport function createDefaultRenderThumbnail(\n  options: DefaultRenderThumbnailOptions\n): (item: ReorderItem, index: number, isDragging?: boolean) => React.ReactNode {\n  const { \n    pageComponents, \n    payload, \n    setup = { width: 210, height: 297 }, // Default A4 size in mm\n    thumbnailWidth = 200, \n    thumbnailHeight, \n  } = options;\n  \n  const pageWidthMm = setup.width || 210;\n  const pageHeightMm = setup.height || 297;\n  const pageAspectRatio = pageWidthMm / pageHeightMm;\n\n  // Derive thumbnail height from page aspect ratio if not provided\n  const finalThumbnailWidth = thumbnailWidth;\n  const finalThumbnailHeight = thumbnailHeight ?? Math.round(finalThumbnailWidth / pageAspectRatio);\n\n  // Convert mm to pixels at 96dpi (1mm = 3.779527559px) for accurate scaling\n  const pageWidthPx = pageWidthMm * 3.779527559;\n  const pageHeightPx = pageHeightMm * 3.779527559;\n\n  \n  return (item: ReorderItem, index: number, isDragging?: boolean) => {\n    const strictPosition = (item as any).strictPosition;\n    const isLocked = strictPosition === 'start' || strictPosition === 'end';\n    \n    if (item.kind === 'group') {\n      // Group thumbnail: show first page with group indicator\n      const firstPageId = item.firstPageId as string | undefined;\n      const firstPageComponentKey = item.firstPageComponentKey ?? firstPageId;\n      const firstPagePayload = getPagePayload(payload, { id: firstPageId, componentKey: firstPageComponentKey });\n      // Use component from item if available, otherwise fall back to pageComponents registry\n      const FirstPageComponent = item.firstPageComponent || (firstPageComponentKey ? pageComponents[firstPageComponentKey] : null);\n      \n      // Resolve integration data for group (group pages use the group's integration)\n      // For groups, instanceId is the group ID, so we can directly access it\n      const integration = payload?.integrations?.[item.id];      \n      \n      return (\n        <div \n          className={`relative bg-white border transition-all ${\n            isDragging \n              ? 'border-blue-400 shadow-2xl scale-105' \n              : isLocked\n              ? 'border-gray-300 bg-gray-50'\n              : 'border-gray-200 hover:border-gray-300 hover:shadow-lg'\n          }`}\n          style={{ width: `${finalThumbnailWidth}px`, height: `${finalThumbnailHeight}px` }}\n          title={item.id}\n        >\n          {/* Render actual PageComponent */}\n          {FirstPageComponent ? (\n            <div \n              className=\"w-full h-full flex items-center justify-center bg-gray-50 overflow-hidden relative pointer-events-none\"\n            >\n              <div \n                className=\"absolute w-full h-full flex items-center justify-center pointer-events-none\"\n                style={{\n                  transform: `scale(${Math.min(finalThumbnailWidth / pageWidthPx, finalThumbnailHeight / pageHeightPx)})`,\n                  transformOrigin: 'center',\n                }}\n              >\n                <div className=\"!shrink-0\" style={{ width: `${pageWidthPx}px`, height: `${pageHeightPx}px`, backgroundColor: 'white', pointerEvents: 'none' }}>\n                  <FirstPageComponent\n                    payload={payload}\n                    pageId={firstPageId}\n                    templateId={firstPageComponentKey}\n                    pagePayload={firstPagePayload}\n                    componentKey={firstPageComponentKey}\n                    integration={integration}\n                  />\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center bg-gray-50 pointer-events-none\">\n              <div className=\"text-center p-4\">\n                <div className=\"text-sm font-medium text-gray-700\">Group {item.id}</div>\n                <div className=\"text-xs text-gray-500 mt-1\">{firstPageId || 'No preview'}</div>\n              </div>\n            </div>\n          )}\n          \n          {/* Group indicator badge */}\n          <div className=\"absolute top-2 right-2 px-2 py-1 bg-blue-600/80 backdrop-blur-sm text-white text-xs font-medium rounded shadow-lg pointer-events-none\">\n            Group ({item.pageCount} pages)\n          </div>\n          \n          {/* Lock indicator for strict position */}\n          {isLocked && (\n            <div className=\"absolute top-2 left-2 px-2 py-1 bg-gray-600/80 backdrop-blur-sm text-white text-xs font-medium rounded shadow-lg pointer-events-none flex items-center gap-1\">\n              <Lock className=\"size-3\" />\n              <span>{strictPosition === 'start' ? 'Start' : 'End'}</span>\n            </div>\n          )}\n          \n          {/* Group info overlay */}\n          <div className=\"absolute bottom-0 left-0 right-0 bg-black/40 backdrop-blur-sm p-3 pointer-events-none\">\n            <div className=\"flex items-center justify-between gap-2 text-white\">\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"text-sm font-medium truncate\">\n                  {item.label || item.id}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Drag indicator */}\n          {isDragging && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-blue-500/10 pointer-events-none\">\n              <div className=\"text-blue-600 font-medium text-sm bg-white/90 px-3 py-1 rounded-full shadow-lg\">\n                Dragging Group...\n              </div>\n            </div>\n          )}\n        </div>\n      );\n    } else {\n      // Standalone page thumbnail\n      const pageId = item.pageId as string | undefined;\n      const pageComponentKey = item.pageComponentKey ?? pageId;\n      const pagePayload = getPagePayload(payload, { id: pageId, componentKey: pageComponentKey });\n      // Use component from item if available, otherwise fall back to pageComponents registry\n      const PageComponent = item.pageComponent || (pageComponentKey ? pageComponents[pageComponentKey] : null);\n      \n      // Resolve integration data for standalone page\n      const integration = pageId ? resolveIntegrationForPage(payload, { id: pageId }) : undefined;\n      return (\n        <div \n          className={`relative bg-white border transition-all ${\n            isDragging \n              ? 'border-blue-400 shadow-2xl scale-105' \n              : isLocked\n              ? 'border-gray-300 bg-gray-50'\n              : 'border-gray-200 hover:border-gray-300 hover:shadow-lg'\n          }`}\n          style={{ width: `${finalThumbnailWidth}px`, height: `${finalThumbnailHeight}px` }}\n          title={item.pageId}\n        >\n          {/* Render actual PageComponent */}\n          {PageComponent ? (\n            <div \n              className=\"w-full h-full flex items-center justify-center bg-gray-50 overflow-hidden relative pointer-events-none\"\n            >\n              <div \n                className=\"flex items-center justify-center pointer-events-none\"\n                style={{\n                  transform: `scale(${Math.min(finalThumbnailWidth / pageWidthPx, finalThumbnailHeight / pageHeightPx)})`,\n                  transformOrigin: 'center',\n                }}\n              >\n                <div className=\"!shrink-0\" style={{ width: `${pageWidthPx}px`, height: `${pageHeightPx}px`, backgroundColor: 'white', pointerEvents: 'none' }}>\n                  <PageComponent \n                    payload={payload}\n                    pageId={pageId}\n                    templateId={pageComponentKey}\n                    pagePayload={pagePayload}\n                    componentKey={pageComponentKey}\n                    integration={integration}\n                  />\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center bg-gray-50 pointer-events-none\">\n              <div className=\"text-center p-4\">\n                <div className=\"text-sm font-medium text-gray-700\">Page {item.pageNum}</div>\n                <div className=\"text-xs text-gray-500 mt-1\">{pageId || 'No preview'}</div>\n              </div>\n            </div>\n          )}\n          \n          {/* Lock indicator for strict position */}\n          {isLocked && (\n            <div className=\"absolute top-2 left-2 px-2 py-1 bg-gray-600/80 backdrop-blur-sm text-white text-xs font-medium rounded shadow-lg pointer-events-none flex items-center gap-1\">\n              <Lock className=\"size-3\" />\n              <span>{strictPosition === 'start' ? 'Start' : 'End'}</span>\n            </div>\n          )}\n          \n          {/* Page info overlay */}\n          <div className=\"absolute bottom-0 left-0 right-0 bg-black/40 backdrop-blur-sm p-3 pointer-events-none\">\n            <div className=\"flex items-center justify-between gap-2 text-white\">\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"text-sm font-medium truncate\">\n                  {item.pageLabel || `Page ${item.pageNum}`}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Drag indicator */}\n          {isDragging && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-blue-500/10 pointer-events-none\">\n              <div className=\"text-blue-600 font-medium text-sm bg-white/90 px-3 py-1 rounded-full shadow-lg\">\n                Dragging...\n              </div>\n            </div>\n          )}\n        </div>\n      );\n    }\n  };\n}\n","import { Plus, Search } from 'lucide-react';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from '../../ui/sheet';\nimport { AvailableItem, AvailableGroupItem, AvailablePageItem } from './use-page-groups';\nimport type { PageComponent, ReorderItem } from './page-group-utils';\nimport { createDefaultRenderThumbnail } from './default-render-thumbnail';\nimport * as React from 'react';\n\ninterface AddPageDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  availableItems: AvailableItem[];\n  onSelectItem: (item: AvailableItem) => Promise<void> | void;\n  pageComponents?: { [pageId: string]: PageComponent };\n  payload?: any;\n  setup?: { width: number; height: number };\n  gridColsClass?: string;\n  // MVP: No customization props, just works\n}\n\nexport function AddPageDialog({\n  open,\n  onOpenChange,\n  availableItems,\n  onSelectItem,\n  pageComponents,\n  payload,\n  setup = { width: 210, height: 297 },\n  gridColsClass = \"page-order-grid-cols\"\n}: AddPageDialogProps) {\n  const [searchQuery, setSearchQuery] = React.useState('');\n\n  const filteredItems = React.useMemo(() => {\n    if (!searchQuery.trim()) return availableItems;\n    const q = searchQuery.toLowerCase();\n    return availableItems.filter(item =>\n      (item.label || '').toLowerCase().includes(q) ||\n      item.id.toLowerCase().includes(q)\n    );\n  }, [availableItems, searchQuery]);\n\n  const handleSelect = (item: AvailableItem) => {\n    onOpenChange(false);\n    void onSelectItem(item);\n  };\n\n  const pageWidthMm = setup.width || 210;\n  const pageHeightMm = setup.height || 297;\n  const pageAspectRatio = pageWidthMm / pageHeightMm;\n  const thumbnailWidth = 200;\n  const thumbnailHeight = Math.round(thumbnailWidth / pageAspectRatio);\n\n  const defaultRenderThumbnail = React.useMemo(() => {\n    if (!pageComponents) return null;\n    return createDefaultRenderThumbnail({\n      pageComponents,\n      payload,\n      setup,\n      thumbnailWidth,\n      thumbnailHeight,\n    });\n  }, [pageComponents, payload, setup, thumbnailWidth, thumbnailHeight]);\n\n  // Helper to evaluate pageComponentKeys (static array or function)\n  const evaluatePageComponentKeys = (\n    keys: string[] | ((context: { payload: any; item?: any; parent?: any }) => string[]) | undefined,\n    context: { payload: any; item?: any; parent?: any }\n  ): string[] => {\n    if (!keys) return [];\n    if (Array.isArray(keys)) return keys;\n    \n    // Evaluate function with error handling\n    try {\n      const result = keys(context);\n      \n      // Validate result is an array\n      if (!Array.isArray(result)) {\n        console.error('[uhuu-components] pageComponentKeys function must return an array, got:', typeof result);\n        return [];\n      }\n      \n      // Filter to ensure all items are strings\n      const filtered = result.filter(key => typeof key === 'string');\n      if (filtered.length !== result.length) {\n        console.warn('[uhuu-components] pageComponentKeys returned non-string values, filtering them out');\n      }\n      \n      return filtered;\n    } catch (err) {\n      console.error('[uhuu-components] Error evaluating pageComponentKeys function:', err);\n      return [];\n    }\n  };\n\n  const toReorderItem = (item: AvailableItem, index: number): ReorderItem => {\n    if (item.kind === 'group') {\n      const group = item as AvailableGroupItem;\n      const context = { payload, item: undefined, parent: undefined };\n      const componentKeys = evaluatePageComponentKeys(group.pageComponentKeys, context);\n      const firstPageComponentKey = componentKeys[0];\n      return {\n        kind: 'group',\n        id: item.id,\n        label: item.label,\n        pageCount: componentKeys.length,\n        firstPageId: firstPageComponentKey,\n        firstPageComponentKey,\n      } as ReorderItem;\n    }\n\n    const pageItem = item as AvailablePageItem;\n    const componentKey = pageItem.componentKey ?? pageItem.id;\n    return {\n      kind: 'page',\n      id: pageItem.id,\n      pageId: pageItem.id,\n      pageComponentKey: componentKey,\n      pageLabel: pageItem.label,\n      pageNum: index + 1,\n    } as ReorderItem;\n  };\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent side=\"bottom\" className=\"h-[90vh] p-0 gap-0 w-full max-w-none bg-gray-50\" data-uhuu-editor>\n        <SheetHeader className=\"border-b border-gray-200 p-4 bg-white\">\n          <div className=\"flex items-end gap-3\">\n            <div className=\"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center shrink-0 mb-0.5\">\n              <Plus className=\"w-4 h-4\" />\n            </div>\n            <div className=\"flex-1\">\n              <SheetTitle className=\"text-base font-medium text-gray-900 leading-tight\">\n                Add Page or Group\n              </SheetTitle>\n              <SheetDescription className=\"text-xs text-gray-400 mt-0.5\">\n                Select a page or group to add to your document.\n              </SheetDescription>\n            </div>\n            <div className=\"flex items-center gap-1.5 text-gray-400 mb-0.5 mr-8\">\n              <Search className=\"w-3.5 h-3.5 shrink-0\" />\n              <input\n                type=\"text\"\n                placeholder=\"Filterâ€¦\"\n                value={searchQuery}\n                onChange={e => setSearchQuery(e.target.value)}\n                tabIndex={-1}\n                className=\"w-24 bg-transparent border-0 focus:outline-none text-sm text-gray-600 placeholder:text-gray-400 focus:w-40 transition-all duration-150\"\n              />\n            </div>\n          </div>\n        </SheetHeader>\n\n        <div className=\"flex-1 overflow-hidden\">\n          <div className=\"h-full max-h-[calc(90vh-100px)] overflow-auto p-6\">\n            {filteredItems.length === 0 ? (\n              <div className=\"text-center py-16\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Plus className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <div className=\"text-lg font-medium text-gray-900 mb-2\">No items available</div>\n                <p className=\"text-gray-500 mb-4\">{searchQuery.trim() ? 'No pages or groups match your search.' : 'All pages and groups have been added.'}</p>\n              </div>\n            ) : (\n              <div className={gridColsClass}>\n                {filteredItems.map((item, index) => {\n                  const isGroup = item.kind === 'group';\n                  const id = item.id;\n                  const label = isGroup\n                    ? (item.label || `Group ${index + 1}`)\n                    : (item.label || `Page ${item.id}`);\n                  const context = { payload, item: undefined, parent: undefined };\n                  const pageCount = isGroup \n                    ? evaluatePageComponentKeys((item as AvailableGroupItem).pageComponentKeys, context).length\n                    : 1;\n                  const hasDefaultThumbnail = !!defaultRenderThumbnail;\n                  return (\n                    <div\n                      key={id}\n                      onClick={() => handleSelect(item)}\n                      className={[\n                        \"relative w-full h-[280px] cursor-pointer transition-all group\",\n                        !hasDefaultThumbnail && \"bg-white border-2 border-gray-200\",\n                        // compact + default, always base + addition if not default\n                      ].filter(Boolean).join(' ')}\n                    >\n                      {/* Thumbnail area */}\n                      <div className=\"w-full h-full relative bg-gray-100 hover:bg-white\">\n                        {(item as any).thumbnail ? (\n                          <img\n                            src={(item as any).thumbnail}\n                            className=\"w-full h-full object-contain pointer-events-none object-top border border-gray-200 p-4\"\n                            alt={label}\n                          />\n                        ) : defaultRenderThumbnail ? (\n                          <div className=\"absolute inset-0 flex items-center pointer-events-none\">\n                            {defaultRenderThumbnail(toReorderItem(item, index), index, false)}\n                          </div>\n                        ) : (\n                          <>\n                            {isGroup ? (\n                              <div className=\"p-4\">\n                                <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3\">\n                                  <Plus className=\"w-8 h-8 text-blue-600\" />\n                                </div>\n                                <div className=\"text-sm font-medium text-gray-700\">{label}</div>\n                                <div className=\"text-xs text-gray-500 mt-1\">\n                                  {pageCount} {pageCount === 1 ? 'page' : 'pages'}\n                                </div>\n                              </div>\n                            ) : (\n                              <div className=\"p-4\">\n                                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3\">\n                                  <Plus className=\"w-8 h-8 text-gray-400\" />\n                                </div>\n                                <div className=\"text-sm font-medium text-gray-700\">{label}</div>\n                                <div className=\"text-xs text-gray-500 mt-1\">{id}</div>\n                              </div>\n                            )}\n                          </>\n                        )}\n                      </div>\n\n                      {(!defaultRenderThumbnail || item?.thumbnail) && (\n                        <>        \n                         <div className=\"absolute top-2 right-2 px-2 py-1 bg-blue-600/80 backdrop-blur-sm text-white text-xs font-medium rounded shadow-lg pointer-events-none\">\n                              Group ({pageCount} {pageCount === 1 ? 'page' : 'pages'})\n                            </div>\n\n                          {/* Item info overlay - positioned at bottom to match reorder dialog */}\n                          <div className=\"absolute bottom-0 left-0 right-0 bg-black/40 backdrop-blur-sm p-3 pointer-events-none\" data-item-id={id}>\n                            <div className=\"flex items-center justify-between gap-2 text-white\">\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"text-sm font-medium truncate\">{label}</div>                                \n                              </div>                             \n                            </div>\n                          </div>\n                        </>\n                      )}\n\n                      {/* Small hover indicator */}\n                      <div className=\"absolute top-3 left-3 w-8 h-8 bg-black rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10\">\n                        <Plus className=\"w-4 h-4 text-white\" />\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","import * as React from \"react\"\nimport { useState, useEffect } from \"react\"\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  type DragEndEvent,\n  type DragStartEvent,\n  DragOverlay,\n} from \"@dnd-kit/core\"\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  rectSortingStrategy,\n} from \"@dnd-kit/sortable\"\nimport { useSortable } from \"@dnd-kit/sortable\"\nimport { CSS } from \"@dnd-kit/utilities\"\n\ninterface SortableItemProps<T> {\n  item: T\n  index: number\n  renderItem: (item: T, index: number, isDragging?: boolean) => React.ReactNode\n  renderDragIndicator?: (item: T, index: number) => React.ReactNode\n  keyExtractor: (item: T) => string\n  disabled?: boolean\n}\n\nfunction SortableItem<T>({\n  item,\n  index,\n  renderItem,\n  renderDragIndicator,\n  keyExtractor,\n  disabled = false,\n}: SortableItemProps<T>) {\n  const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({\n    id: keyExtractor(item),\n    disabled,\n  })\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n  }\n\n  return (\n    <div ref={setNodeRef} style={style} className={`relative group/drag-item ${isDragging ? \"opacity-50\" : \"\"} ${disabled ? \"opacity-60\" : \"\"}`}>\n      {/* Main item content */}\n      {renderItem(item, index, isDragging)}\n\n      {/* Drag indicator overlay */}\n      {!disabled && (\n        renderDragIndicator ? (\n          <div {...attributes} {...listeners}>\n            {renderDragIndicator(item, index)}\n          </div>\n        ) : (\n          /* If no drag indicator, make entire item draggable */\n          <div\n            {...attributes}\n            {...listeners}\n            className=\"absolute inset-0 cursor-grab active:cursor-grabbing outline-none touch-none\"\n          />\n        )\n      )}\n    </div>\n  )\n}\n\nfunction DragOverlayItem<T>({\n  item,\n  index,\n  renderItem,\n}: {\n  item: T\n  index: number\n  renderItem: (item: T, index: number, isDragging?: boolean) => React.ReactNode\n}) {\n  return <div className=\"rotate-2\">{renderItem(item, index, true)}</div>\n}\n\nexport interface DragDropGridProps<T> {\n  items: T[]\n  onChange: (reorderedItems: T[]) => void\n  renderItem: (item: T, index: number, isDragging?: boolean) => React.ReactNode\n  renderDragIndicator?: (item: T, index: number) => React.ReactNode\n  keyExtractor: (item: T) => string\n  gridColsClass?: string\n  className?: string\n  renderToolbar?: () => React.ReactNode\n  renderEmptyState?: () => React.ReactNode\n  showDebugInfo?: boolean\n  renderDragOverlay?: (item: T, index: number) => React.ReactNode\n  isItemDisabled?: (item: T) => boolean\n  canDropAt?: (draggedItem: T, targetIndex: number, items: T[]) => boolean\n}\n\nexport default function DragDropGrid<T>({\n  items: initialItems,\n  onChange,\n  renderItem,\n  renderDragIndicator,\n  keyExtractor,\n  gridColsClass = \"page-drag-drop-grid-cols\",\n  className = \"\",\n  renderToolbar,\n  renderEmptyState,\n  showDebugInfo = false,\n  renderDragOverlay,\n  isItemDisabled,\n  canDropAt,\n}: DragDropGridProps<T>) {\n  const [items, setItems] = useState<T[]>(initialItems)\n\n  // Sync with parent state when initialItems changes\n  useEffect(() => {\n    setItems(initialItems)\n  }, [initialItems])\n\n  const [activeId, setActiveId] = useState<string | null>(null)\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  )\n\n  const handleDragStart = (event: DragStartEvent) => {\n    const draggedItem = items.find((item) => keyExtractor(item) === event.active.id)\n    // Prevent dragging disabled items\n    if (draggedItem && isItemDisabled && isItemDisabled(draggedItem)) {\n      return\n    }\n    setActiveId(event.active.id as string)\n  }\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event\n\n    if (!over || active.id === over.id) {\n      setActiveId(null)\n      return\n    }\n\n    const draggedItem = items.find((item) => keyExtractor(item) === active.id)\n    const oldIndex = items.findIndex((item) => keyExtractor(item) === active.id)\n    const newIndex = items.findIndex((item) => keyExtractor(item) === over.id)\n\n    // Prevent dragging disabled items\n    if (draggedItem && isItemDisabled && isItemDisabled(draggedItem)) {\n      setActiveId(null)\n      return\n    }\n\n    // Check if drop is allowed at target position\n    if (canDropAt && !canDropAt(draggedItem!, newIndex, items)) {\n      setActiveId(null)\n      return\n    }\n\n    if (oldIndex !== -1 && newIndex !== -1) {\n      const newItems = arrayMove(items, oldIndex, newIndex)\n      setItems(newItems)\n      onChange(newItems)\n    }\n\n    setActiveId(null)\n  }\n\n  const activeItem = items.find((item) => keyExtractor(item) === activeId)\n  const activeIndex = activeItem ? items.findIndex((item) => keyExtractor(item) === activeId) : -1\n\n  return (\n    <div className={`w-full ${className}`}>\n      {renderToolbar && <div className=\"mb-6\">{renderToolbar()}</div>}\n\n      {items.length === 0 && renderEmptyState ? (\n        renderEmptyState()\n      ) : (\n        <div className=\"mb-6\">\n          <DndContext\n            sensors={sensors}\n            collisionDetection={closestCenter}\n            onDragStart={handleDragStart}\n            onDragEnd={handleDragEnd}\n          >\n            <SortableContext items={items.map(keyExtractor)} strategy={rectSortingStrategy}>\n              <div className={gridColsClass}>\n                {items.map((item, index) => (\n                  <SortableItem\n                    key={keyExtractor(item)}\n                    item={item}\n                    index={index}\n                    renderItem={renderItem}\n                    renderDragIndicator={renderDragIndicator}\n                    keyExtractor={keyExtractor}\n                    disabled={isItemDisabled ? isItemDisabled(item) : false}\n                  />\n                ))}\n              </div>\n            </SortableContext>\n            <DragOverlay>\n              {activeItem ? (\n                renderDragOverlay ? (\n                  <div className=\"rotate-2 shadow-lg\">{renderDragOverlay(activeItem, activeIndex)}</div>\n                ) : (\n                  <DragOverlayItem item={activeItem} index={activeIndex} renderItem={renderItem} />\n                )\n              ) : null}\n            </DragOverlay>\n          </DndContext>\n        </div>\n      )}\n\n      {/* Debug info */}\n      {showDebugInfo && (\n        <div className=\"fixed top-4 left-4 bg-white rounded-lg border shadow-lg p-3 text-sm max-w-xs\">\n          <div className=\"font-medium mb-1\">Debug Info</div>\n          <div className=\"text-gray-600 text-xs\">\n            Items: {items.length} | Active: {activeId || \"none\"}\n          </div>\n          <div className=\"text-xs text-gray-500 mt-1 break-all\">\n            Order: {items.map((item, i) => `${i + 1}:${keyExtractor(item).slice(0, 3)}`).join(\" â†’ \")}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n","import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"./cn\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default: \"border-transparent bg-gray-900 text-white\",\n        secondary: \"border-transparent bg-gray-100 text-gray-900\",\n        outline: \"border-gray-300 text-gray-900 bg-white\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n\n","import * as React from \"react\"\nimport { GripVertical, ArrowUpDown, Lock } from \"lucide-react\"\nimport DragDropGrid from \"../../utility/drag-drop-grid\"\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription, SheetFooter } from \"../../ui/sheet\"\nimport { Badge } from \"../../ui/badge\"\nimport { Button } from \"../../ui/button\"\nimport { createDefaultRenderThumbnail } from \"./default-render-thumbnail\"\nimport type { PageComponent } from \"./page-group-utils\"\n\nexport interface PageItem {\n  id: string\n  [key: string]: any\n}\n\nexport interface PageOrderDialogProps<T extends PageItem> {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  pages: T[]\n  onReorder: (newOrder: T[]) => void\n  renderThumbnail?: (page: T, index: number, isDragging?: boolean) => React.ReactNode\n  \n  // NEW: For automatic thumbnail rendering\n  pageComponents?: { [pageId: string]: PageComponent }\n  payload?: any\n  \n  // Page setup dimensions (same as Pagination setup prop) - in millimeters\n  setup?: { width: number; height: number }\n  \n  title?: string\n  description?: string\n  gridColsClass?: string\n}\n\n// Default page thumbnail component with simple preview\nfunction DefaultPageThumbnail<T extends PageItem>({\n  page,\n  index,\n  isDragging,\n}: {\n  page: T\n  index: number\n  isDragging?: boolean\n}) {\n  const thumbnailWidth = 200\n  const thumbnailHeight = 280\n  const strictPosition = (page as any).strictPosition\n  const isLocked = strictPosition === 'start' || strictPosition === 'end'\n\n  return (\n    <div\n      className={`flex items-center justify-center border relative rounded-lg bg-white overflow-hidden transition-all ${\n        isDragging\n          ? \"opacity-50 border-gray-400 shadow-xl scale-105\"\n          : isLocked\n          ? \"border-gray-300 bg-gray-50\"\n          : \"border-gray-200 group-hover/drag-item:border-gray-300 group-hover/drag-item:shadow-md\"\n      }`}\n    >      \n      <div\n        className=\"flex items-center justify-center\"\n        style={{\n          width: `${thumbnailWidth}px`,\n          height: `${thumbnailHeight}px`,\n        }}\n      >\n        {/* Default content rendering */}\n        {page.content || (\n          <div className=\"text-center p-4\">\n            <div className=\"text-sm font-medium text-gray-700\">{page.label || `Page ${index + 1}`}</div>\n            <div className=\"text-xs text-gray-400 mt-1 font-mono\">{page.id}</div>\n          </div>\n        )}\n      </div>\n\n      {/* Page number badge */}\n      <div className=\"absolute top-2 left-2 z-20\">\n        <Badge variant=\"secondary\" className={`text-xs min-w-[24px] h-6 font-medium bg-white/95 backdrop-blur-sm flex items-center justify-center shadow-sm border border-gray-200 ${isLocked ? 'opacity-75' : ''}`}>\n          {isLocked ? (\n            <Lock className=\"size-3 text-gray-500\" />\n          ) : (\n            <>\n              <span className=\"group-hover/drag-item:hidden\">{index + 1}</span>\n              <GripVertical className=\"size-4 text-gray-400 hidden group-hover/drag-item:block\" />\n            </>\n          )}\n        </Badge>\n      </div>\n    </div>\n  )\n}\n\nexport function PageOrderDialog<T extends PageItem>({\n  open,\n  onOpenChange,\n  pages,\n  onReorder,\n  renderThumbnail,\n  pageComponents,\n  payload,\n  setup,\n  title = \"Reorder Pages\",\n  description = \"Drag and drop pages to change their order.\",\n  gridColsClass = \"page-order-grid-cols\",\n}: PageOrderDialogProps<T>) {\n  // Track local order changes - only apply on save\n  const [localPages, setLocalPages] = React.useState<T[]>(pages)\n  const [hasChanges, setHasChanges] = React.useState(false)\n\n  // Sync local state when pages prop changes (but only if dialog is closed or no local changes)\n  React.useEffect(() => {\n    if (!open) {\n      setLocalPages(pages)\n      setHasChanges(false)\n    } else if (!hasChanges) {\n      setLocalPages(pages)\n    }\n  }, [pages, open, hasChanges])\n\n  const handleLocalReorder = (newOrder: T[]) => {\n    setLocalPages(newOrder)\n    setHasChanges(true)\n  }\n\n  const handleSave = () => {\n    onReorder(localPages)\n    setHasChanges(false)\n    onOpenChange(false)\n  }\n\n  const handleCancel = () => {\n    setLocalPages(pages)\n    setHasChanges(false)\n    onOpenChange(false)\n  }\n\n  // Auto-create default renderThumbnail if pageComponents provided and no valid custom renderThumbnail\n  const defaultRenderThumbnail = React.useMemo(() => {    \n    // Only auto-create if renderThumbnail is not provided or is not a function\n    if ((!renderThumbnail || typeof renderThumbnail !== 'function') && pageComponents) {\n      return createDefaultRenderThumbnail({ pageComponents, payload, setup })\n    }\n    return null\n  }, [renderThumbnail, pageComponents, payload, setup])\n  \n  const renderPageThumbnail = (page: T, index: number, isDragging?: boolean) => {\n    // Priority: 1. Custom renderThumbnail (if it's a function), 2. Auto-created defaultRenderThumbnail, 3. DefaultPageThumbnail\n    if (renderThumbnail && typeof renderThumbnail === 'function') {\n      return renderThumbnail(page, index, isDragging)\n    }\n    if (defaultRenderThumbnail) {\n      return defaultRenderThumbnail(page as any, index, isDragging)\n    }\n    return <DefaultPageThumbnail page={page} index={index} isDragging={isDragging} />\n  }\n\n  const renderEmptyState = () => (\n    <div className=\"text-center py-20\">\n      <div className=\"w-12 h-12 bg-gray-50 rounded-lg flex items-center justify-center mx-auto mb-3\">\n        <ArrowUpDown className=\"w-6 h-6 text-gray-400\" />\n      </div>\n      <div className=\"text-base font-medium text-gray-900 mb-1\">No pages found</div>\n      <p className=\"text-sm text-gray-500\">Add some pages to get started with reordering.</p>\n    </div>\n  )\n\n  const keyExtractor = (page: T) => page.id\n\n  // Check if an item has strictPosition and should be disabled from dragging\n  const isItemDisabled = React.useCallback((page: T) => {\n    const strictPosition = (page as any).strictPosition;\n    return strictPosition === 'start' || strictPosition === 'end';\n  }, []);\n\n  // Check if an item can be dropped at a specific position\n  const canDropAt = React.useCallback((draggedItem: T, targetIndex: number, items: T[]) => {\n    const draggedPosition = (draggedItem as any).strictPosition;\n    \n    // Items with strictPosition cannot be dragged (should be caught by isItemDisabled, but double-check)\n    if (draggedPosition === 'start' || draggedPosition === 'end') {\n      return false;\n    }\n\n    // Find the boundaries of start, middle, and end sections\n    let startEndIndex = -1;\n    let endStartIndex = items.length;\n    \n    for (let i = 0; i < items.length; i++) {\n      const position = (items[i] as any).strictPosition;\n      if (position === 'start') {\n        startEndIndex = i;\n      } else if (position === 'end' && endStartIndex === items.length) {\n        endStartIndex = i;\n        // Don't break - continue to find all end items\n      }\n    }\n\n    // Regular items can only be dropped in the middle section\n    // (after all start items and before all end items)\n    if (targetIndex <= startEndIndex) {\n      return false;\n    }\n\n    if (targetIndex >= endStartIndex) {\n      return false;\n    }\n\n    return true;\n  }, []);\n\n  return (\n    <Sheet open={open} onOpenChange={(newOpen) => {\n      // Only allow closing via explicit cancel/save buttons\n      if (!newOpen) {\n        handleCancel()\n      }\n    }}>\n      <SheetContent \n        side=\"bottom\" \n        className=\"h-[90vh] p-0 gap-0 w-full max-w-none flex flex-col [&>button]:hidden\"\n        onPointerDownOutside={(e) => {\n          // Prevent closing when clicking outside - use cancel/save buttons instead\n          e.preventDefault()\n        }}\n        onEscapeKeyDown={(e) => {\n          // Prevent escape from closing - use cancel button instead\n          e.preventDefault()\n        }}\n        data-uhuu-editor\n      >\n        <SheetHeader className=\"border-b border-gray-200 p-4\">\n          <div className=\"flex items-end gap-3\">\n            <div className=\"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center shrink-0 mb-0.5\">\n              <ArrowUpDown className=\"w-4 h-4\" />\n            </div>\n            <div className=\"flex-1\">\n              <SheetTitle className=\"text-base font-medium text-gray-900 leading-tight\">{title}</SheetTitle>\n              <SheetDescription className=\"text-xs text-gray-400 mt-0.5\">{description}</SheetDescription>\n            </div>\n            <Badge variant=\"outline\" className=\"text-xs mb-0.5 mr-8\">\n              {localPages.length} {localPages.length === 1 ? \"page\" : \"pages\"}\n            </Badge>\n          </div>\n        </SheetHeader>\n\n        <div className=\"flex-1 overflow-hidden flex flex-col\">\n          <div className=\"flex-1 overflow-auto p-6 bg-gray-50\">\n            <DragDropGrid\n              items={localPages}\n              onChange={handleLocalReorder}\n              renderItem={renderPageThumbnail}\n              keyExtractor={keyExtractor}\n              renderEmptyState={renderEmptyState}\n              gridColsClass={gridColsClass}\n              className=\"pb-4\"\n              isItemDisabled={isItemDisabled}\n              canDropAt={canDropAt}\n            />\n          </div>\n        </div>\n\n        <SheetFooter className=\"border-t border-gray-200 px-4 py-3 gap-3\">\n          <Button\n            variant=\"outline\"\n            onClick={handleCancel}\n          >\n            Cancel\n          </Button>\n          <Button\n            variant=\"default\"\n            onClick={handleSave}\n            disabled={!hasChanges}\n          >\n            Save Changes\n          </Button>\n        </SheetFooter>\n      </SheetContent>\n    </Sheet>\n  )\n}\n","import * as React from \"react\"\nimport { cn } from \"./cn\"\n\nexport interface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {}\n\nconst Select = React.forwardRef<HTMLSelectElement, SelectProps>(\n  ({ className, children, ...props }, ref) => {\n    return (\n      <select\n        className={cn(\n          \"flex h-8 w-full rounded-md border border-gray-200 bg-white px-2.5 py-1 text-sm text-gray-900 outline-none transition-colors focus:border-gray-400 focus:ring-2 focus:ring-gray-200 focus:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      >\n        {children}\n      </select>\n    )\n  }\n)\nSelect.displayName = \"Select\"\n\nexport { Select }\n\n\n","import * as React from 'react'\nimport * as SwitchPrimitive from '@radix-ui/react-switch'\nimport { cn } from './cn'\n\nexport interface SwitchProps extends React.ComponentProps<typeof SwitchPrimitive.Root> {}\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitive.Root>,\n  SwitchProps\n>(({ className, ...props }, ref) => {\n  return (\n    <SwitchPrimitive.Root\n      ref={ref}\n      className={cn(\n        'peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent bg-gray-200 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200',\n        className\n      )}\n      {...props}\n    >\n      <SwitchPrimitive.Thumb\n        className={cn(\n          'pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0'\n        )}\n      />\n    </SwitchPrimitive.Root>\n  )\n})\nSwitch.displayName = SwitchPrimitive.Root.displayName\n\nexport { Switch }\n","import * as React from 'react'\nimport * as SliderPrimitive from '@radix-ui/react-slider'\nimport { cn } from './cn'\n\nexport interface SliderProps extends React.ComponentProps<typeof SliderPrimitive.Root> {}\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  SliderProps\n>(({ className, ...props }, ref) => {\n  return (\n    <SliderPrimitive.Root\n      ref={ref}\n      className={cn(\n        'relative flex w-full touch-none select-none items-center data-[disabled]:opacity-50',\n        className\n      )}\n      {...props}\n    >\n      <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-gray-200\">\n        <SliderPrimitive.Range className=\"absolute h-full bg-gray-900\" />\n      </SliderPrimitive.Track>\n      <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border-2 border-gray-900 bg-white shadow transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n    </SliderPrimitive.Root>\n  )\n})\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","import * as React from 'react'\nimport * as LabelPrimitive from '@radix-ui/react-label'\nimport { cn } from './cn'\n\nexport interface LabelProps extends React.ComponentProps<typeof LabelPrimitive.Root> {}\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  LabelProps\n>(({ className, ...props }, ref) => {\n  return (\n    <LabelPrimitive.Root\n      ref={ref}\n      className={cn(\n        'text-sm font-medium leading-none text-gray-700 peer-disabled:cursor-not-allowed peer-disabled:opacity-70',\n        className\n      )}\n      {...props}\n    />\n  )\n})\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","import { Check, Minus, Plus } from 'lucide-react';\nimport { Select } from '../../ui/select';\nimport { Switch } from '../../ui/switch';\nimport { Slider } from '../../ui/slider';\nimport { Label } from '../../ui/label';\nimport { Button } from '../../ui/button';\nimport { PageOption } from './page-editor';\nimport { PageItem } from './page-group-utils';\n\ntype PageOptionsRendererProps = {\n  pageOptions: PageOption[];\n  targetItem: PageItem;\n  onChange: (pageOption: PageOption, targetItem: PageItem, value: string) => void;\n};\n\nexport function PageOptionsRenderer({\n  pageOptions,\n  targetItem,\n  onChange,\n}: PageOptionsRendererProps) {\n  const matchesTarget = (option: PageOption, item: PageItem) => {\n    if (!option.appliesTo) return true;\n    const targets = Array.isArray(option.appliesTo) ? option.appliesTo : [option.appliesTo];\n    return targets.some(target => {\n      if (typeof target === 'function') return target(item);\n      // Match by instance ID, template ID, or component key\n      return target === item.id || target === item.templateId || (item as any).componentKey === target;\n    });\n  };\n\n  // Filter out options that don't apply to this page (getValue returns empty string or false for non-applicable options)\n  const applicableOptions = pageOptions.filter(option => {\n    if (!matchesTarget(option, targetItem)) return false;\n    const value = option.getValue(targetItem);\n    if (option.type === 'select' || option.type === 'color-series') {\n      return value !== ''; // Only show if value is not empty\n    }\n    if (option.type === 'toggle') {\n      // Always show toggles, they can be false\n      return true;\n    }\n    // For slider and counter, always show\n    return true;\n  });\n\n  const renderOption = (option: PageOption) => {\n    const currentValue = option.getValue(targetItem);\n\n    switch (option.type) {\n      case 'select': {\n        return (\n          <div key={option.id} className=\"space-y-1.5\">\n            <Label htmlFor={option.id} className=\"text-xs font-medium text-gray-500\">\n              {option.label}\n            </Label>\n            <Select\n              id={option.id}\n              value={String(currentValue)}\n              onChange={(e) => onChange(option, targetItem, e.target.value)}\n              className=\"w-full text-sm\"\n            >\n              {option.options.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </Select>\n          </div>\n        );\n      }\n\n      case 'toggle': {\n        const boolValue = typeof currentValue === 'boolean' ? currentValue : currentValue === 'true';\n        return (\n          <div key={option.id} className=\"flex items-center justify-between py-1.5\">\n            <Label htmlFor={option.id} className=\"text-xs font-medium text-gray-500\">\n              {option.label}\n            </Label>\n            <Switch\n              id={option.id}\n              checked={boolValue}\n              onCheckedChange={(checked) => onChange(option, targetItem, String(checked))}\n            />\n          </div>\n        );\n      }\n\n      case 'slider': {\n        const numValue = typeof currentValue === 'number' ? currentValue : Number(currentValue) || option.min;\n        return (\n          <div key={option.id} className=\"space-y-1.5\">\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor={option.id} className=\"text-xs font-medium text-gray-500\">\n                {option.label}\n              </Label>\n              <span className=\"text-xs font-mono tabular-nums text-gray-700\">{numValue}</span>\n            </div>\n            <Slider\n              id={option.id}\n              min={option.min}\n              max={option.max}\n              step={option.step}\n              value={[numValue]}\n              onValueChange={(values) => onChange(option, targetItem, String(values[0]))}\n            />\n          </div>\n        );\n      }\n\n      case 'counter': {\n        const numValue = typeof currentValue === 'number' ? currentValue : Number(currentValue) || option.min;\n        return (\n          <div key={option.id} className=\"space-y-1.5\">\n            <Label className=\"text-xs font-medium text-gray-500\">{option.label}</Label>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"h-8 w-8 shrink-0 p-0\"\n                onClick={() => {\n                  const newValue = Math.max(option.min, numValue - option.step);\n                  onChange(option, targetItem, String(newValue));\n                }}\n                disabled={numValue <= option.min}\n                type=\"button\"\n              >\n                <Minus className=\"h-3.5 w-3.5\" />\n              </Button>\n              <div className=\"flex-1 text-center px-3 py-1.5 bg-gray-50 rounded-md border border-gray-200\">\n                <span className=\"text-sm font-mono tabular-nums font-medium text-gray-900\">{numValue}</span>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"h-8 w-8 shrink-0 p-0\"\n                onClick={() => {\n                  const newValue = Math.min(option.max, numValue + option.step);\n                  onChange(option, targetItem, String(newValue));\n                }}\n                disabled={numValue >= option.max}\n                type=\"button\"\n              >\n                <Plus className=\"h-3.5 w-3.5\" />\n              </Button>\n            </div>\n          </div>\n        );\n      }\n\n      case 'color-series': {\n        const stringValue = String(currentValue);\n        return (\n          <div key={option.id} className=\"space-y-1.5\">\n            <Label className=\"text-xs font-medium text-gray-500\">{option.label}</Label>\n            <div className=\"flex flex-wrap gap-1.5\">\n              {option.options.map((color) => {\n                const isSelected = stringValue === color.value;\n                return (\n                  <button\n                    key={color.value}\n                    onClick={() => onChange(option, targetItem, color.value)}\n                    className={`h-7 w-7 rounded-md border-2 transition-all flex items-center justify-center ${\n                      isSelected\n                        ? 'border-gray-900 scale-110'\n                        : 'border-gray-200 hover:border-gray-400 hover:scale-105'\n                    }`}\n                    style={{ backgroundColor: color.hex || color.value }}\n                    type=\"button\"\n                    title={`${color.label}${color.hex ? ` (${color.hex})` : ''}`}\n                  >\n                    {isSelected && (\n                      <Check className=\"h-4 w-4 text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]\" strokeWidth={3} />\n                    )}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n        );\n      }\n\n      default:\n        console.warn(`Unknown option type: ${(option as any).type}`);\n        return null;\n    }\n  };\n\n  return <div className=\"space-y-3\">{applicableOptions.map((option) => renderOption(option))}</div>;\n}\n","import * as React from 'react';\nimport { MoreHorizontal, Trash2 } from 'lucide-react';\nimport { Button } from '../../ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from '../../ui/dropdown-menu';\nimport { PageOption } from './page-editor';\nimport { PageItem } from './page-group-utils';\nimport { PageOptionsRenderer } from './page-options-renderer';\n\nexport interface PageOptionsDropdownProps {\n  pageOptions: PageOption[];\n  targetItem: PageItem | undefined;\n  onChange: (pageOption: PageOption, targetItem: PageItem, value: string) => void;\n  onRemove?: (targetId: string) => void;\n  showRemove?: boolean;\n  title?: string;\n  removeLabel?: string;\n  triggerClassName?: string;\n}\n\nexport function PageOptionsDropdown({\n  pageOptions,\n  targetItem,\n  onChange,\n  onRemove,\n  showRemove = false,\n  title = 'Options',\n  removeLabel = 'Remove',\n  triggerClassName,\n}: PageOptionsDropdownProps) {\n  if (!targetItem) return null;\n\n  return (\n    <DropdownMenu modal={false}>\n      <DropdownMenuTrigger asChild className={triggerClassName || 'page-options-trigger'}>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 w-7\"\n          title={title}\n        >\n          <MoreHorizontal className=\"w-4 h-4\" />\n          <span className=\"sr-only\">{title}</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent className=\"min-w-48 p-3\" align=\"center\">\n        <PageOptionsRenderer\n          pageOptions={pageOptions}\n          targetItem={targetItem}\n          onChange={onChange}\n        />\n        {showRemove && onRemove && (\n          <>\n            {pageOptions.length > 0 && <DropdownMenuSeparator className=\"my-2\" />}\n            <DropdownMenuItem\n              onClick={() => onRemove(targetItem.id)}\n              className=\"text-red-600 focus:text-red-700 focus:bg-red-50\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              <span>{removeLabel}</span>\n            </DropdownMenuItem>\n          </>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\n","import * as React from 'react';\nimport { Section } from '../resizers/section-page-resizer';\nimport { PageGroup as PageGroupType, StandalonePage, PageItem } from './page-group-utils';\nimport { Badge } from '../../ui/badge';\nimport { PageOption } from './page-editor';\nimport { PageOptionsDropdown } from './page-options-dropdown';\n\ninterface PageGroupProps {\n  group: PageGroupType;\n  pagesWithPageNum: Array<StandalonePage & { pageNum: number }>;\n  onRemove: (groupId: string) => void;\n  totalItems: number;\n  renderPage: (page: StandalonePage & { pageNum: number }) => React.ReactNode;\n  pageOptions: PageOption[];\n  onPageOptionChange: (pageOption: PageOption, target: PageItem, value: string) => void;\n  onLabelChange?: (groupId: string, label: string) => void;\n  // MVP: Minimal props, no advanced customization\n}\n\nexport function PageGroup({\n  group,\n  pagesWithPageNum,\n  onRemove,\n  totalItems,\n  renderPage,\n  pageOptions,\n  onPageOptionChange,\n  onLabelChange,\n}: PageGroupProps) {\n  const handleLabelClick = () => {\n    if (!onLabelChange) return;\n    const currentLabel = group.label || group.id;\n    const entered = window.prompt('Rename group:', currentLabel);\n    if (entered !== null) {\n      const trimmed = entered.trim();\n      onLabelChange(group.id, trimmed || '');\n    }\n  };\n  return (\n    <>\n      {pagesWithPageNum.map((page, indexInGroup) => {\n        const isFirstPage = indexInGroup === 0;\n        \n        return (\n          <Section\n            key={page.id}\n            title={`Sheet ${page.pageNum}`}\n            controls={\n              isFirstPage ? (\n                // Group-level controls only on first page\n                <div data-uhuu-editor className=\"pl-0 py-1.5 flex justify-between items-center\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"page-number\">\n                      {page.pageNum}\n                    </span>\n                    {page.label && (\n                      <span className=\"text-xs text-gray-500\">\n                        {page.label}\n                      </span>\n                    )}\n                    <Badge \n                      variant=\"outline\" \n                      className=\"text-xs font-normal text-gray-600 border-gray-200 bg-transparent cursor-pointer hover:bg-gray-50 transition-colors\"\n                      onClick={handleLabelClick}\n                      title=\"Click to rename\"\n                      data-group-id={group.id}\n                    >\n                      {group.label || group.id}\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center\">\n                    <PageOptionsDropdown\n                      pageOptions={pageOptions}\n                      targetItem={group}\n                      onChange={onPageOptionChange}\n                      onRemove={onRemove}\n                      showRemove={totalItems > 1}\n                      title=\"Group options\"\n                      removeLabel=\"Remove Group\"\n                    />\n                  </div>\n                </div>\n              ) : (\n                // No controls for pages within group (group internal pages are not directly editable)\n                <div className=\"pl-0 pr-3 py-1.5 flex justify-between items-center\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"page-number\">\n                      {page.pageNum}\n                    </span>\n                    {page.label && (\n                      <span className=\"text-xs text-gray-500\">\n                        {page.label}\n                      </span>\n                    )}\n                    <span className=\"text-xs text-gray-400\">Â·</span>\n                  </div>\n                </div>\n              )\n            }\n          >\n            {renderPage(page)}\n          </Section>\n        );\n      })}\n    </>\n  );\n}\n","import * as React from 'react';\nimport Pagination from '../../pagination-static/pagination-static';\nimport Sheet from '../../pagination-static/sheet-static';\nimport type { PageComponent, PageGroup, PageItem, StandalonePage } from './page-group-utils';\nimport type { PageDataBinding } from './data-binding';\n\ninterface PageCanvasProps {\n  pageId: string;\n  templateId?: string;\n  componentKey?: string;\n  component?: PageComponent;\n  payload?: any;\n  pagePayload?: any;\n  integration?: any;\n  page?: StandalonePage;\n  parentGroup?: PageItem;\n  setup?: { width: number; height: number; [key: string]: any };\n  reference?: React.ReactNode;\n  overlay?: React.ReactNode | ((args: { pageNo: number; pageId: string }) => React.ReactNode);\n  className?: string;\n  pageNo?: number;\n  dataBinding?: PageDataBinding;\n}\n\n/**\n * Small helper that renders a single page with Pagination + Sheet\n * and optional reference/overlay. Keeps templates from duplicating\n * the same scaffold for every page render.\n */\nexport function PageCanvas({\n  pageId,\n  templateId,\n  componentKey,\n  component: PageComponent,\n  payload,\n  pagePayload,\n  integration,\n  page,\n  parentGroup,\n  setup,\n  reference,\n  overlay,\n  className,\n  pageNo = 0,\n  dataBinding,\n}: PageCanvasProps) {\n  const renderOverlay = typeof overlay === 'function'\n    ? (pageNo: number) => overlay({ pageNo, pageId })\n    : () => overlay;\n\n  // Build automatic class for page key targeting\n  const pageKey = componentKey || templateId || pageId;\n  const pageKeyClass = pageKey ? `uhuu-page--${pageKey}` : '';\n  const combinedClassName = [pageKeyClass, className].filter(Boolean).join(' ');\n\n  return (\n    <Pagination setup={setup}>\n      <Sheet \n        className={combinedClassName} \n        pageNo={pageNo} \n        overlay={({ pageNo }) => renderOverlay(pageNo)}\n        data-page-key={pageKey}\n      >\n        {reference}\n        {PageComponent ? (\n          <PageComponent\n            payload={payload}\n            pagePayload={pagePayload}\n            integration={integration}\n            pageId={pageId}\n            templateId={templateId ?? componentKey ?? pageId}\n            pageNum={pageNo}\n            page={page}\n            parentGroup={parentGroup as PageGroup}\n            componentKey={componentKey}\n            dataBinding={dataBinding}\n          />\n        ) : null}\n      </Sheet>\n    </Pagination>\n  );\n}\n\nexport default PageCanvas;\n","import { useState, useMemo, useCallback, useContext, useEffect, useRef } from 'react';\nimport {\n  PageItem,\n  StandalonePage,\n  PageComponent,\n  IntegrationRequirement,\n  IntegrationConfig,\n  isPageGroup,\n  updatePageNumbers,\n  getTotalPageCount,\n  transformItemsForReorder,\n  restoreItemsFromReorder,\n  ReorderItem,\n  PageEditorState,\n  DEFAULT_PAGE_EDITOR_STATE_KEY,\n  buildPageEditorState,\n  instantiateGroup,\n  instantiatePage,\n  PageFilterConfig,\n  filterPageItems,\n} from './page-group-utils';\nimport { createDefaultRenderThumbnail } from './default-render-thumbnail';\nimport { TemplateDataContext } from './template-data-provider';\n\nexport type AvailablePageItem = {\n  kind: 'page';\n  id: string;                    // Template ID\n  templateId?: string;          // Reference to template\n  componentKey?: string;         // Component key for resolution\n  label?: string;\n  component?: PageComponent;\n  meta?: Record<string, any>;\n  repeatable?: boolean;\n  maxInstances?: number | null;\n  integration?: IntegrationRequirement | IntegrationConfig;\n  [key: string]: any;\n};\n\nexport type AvailableGroupItem = {\n  kind: 'group';\n  id: string;                    // Template ID\n  templateId?: string;          // Reference to template\n  repeatable?: boolean;          // Can be added multiple times\n  maxInstances?: number | null;  // Max instances allowed\n  pageComponentKeys?: string[] | ((context: { payload: any; item?: any; parent?: any }) => string[]);  // Component keys (not instance IDs) - can be static array or function\n  label?: string;\n  integration?: IntegrationRequirement | IntegrationConfig;\n  meta?: Record<string, any>;\n  [key: string]: any;\n};\n\nexport type AvailableItem = AvailablePageItem | AvailableGroupItem;\n\ntype PageItemWithNumbers = PageItem & {\n  pageNum?: number;\n  pages?: Array<StandalonePage & { pageNum: number }>;\n};\n\ninterface UsePageGroupsOptions {\n  // Initial state - what pages/groups come when template first loads\n  initialItems: PageItem[];\n  \n  // Available items that can be added (simple: array of page IDs or group configs)\n  availableItems?: AvailableItem[];\n  \n  // Callbacks (optional for MVP)\n  onItemsChange?: (items: PageItem[], state: PageEditorState) => void;\n  onStateChange?: (state: PageEditorState) => void;\n  \n  // NEW: For automatic thumbnail rendering\n  pageComponents?: { [pageId: string]: PageComponent };\n  payload?: any;\n  \n  // Page setup dimensions (same as Pagination setup prop) - in millimeters\n  setup?: { width: number; height: number };\n\n  // Payload state key (for persistence helpers)\n  stateKey?: string;\n\n  // Hook for resolving a draft item before it is committed (integration fetch, async defaults, etc.)\n  resolveNewItem?: (draft: PageItem) => Promise<PageItem | null | void> | PageItem | null | void;\n\n  notifyError?: (message: string) => void;\n  \n  // Page filter for conditional rendering\n  pageFilter?: PageFilterConfig;\n}\n\ninterface UsePageGroupsReturn {\n  // State\n  items: PageItem[];\n  itemsWithPageNum: PageItemWithNumbers[];\n  totalPageCount: number;\n  \n  // Available items (filtered - excludes already used)\n  availableItemsToAdd: AvailableItem[];\n  \n  // CRUD operations (MVP - minimal surface)\n  addItem: (item: AvailableItem) => Promise<void>;\n  removeItem: (itemId: string) => void;\n  updateItemFields: (itemId: string, patch: Partial<PageItem>) => void;\n  reorderItems: (newOrder: PageItem[]) => void;\n  \n  // Add page dialog state\n  addDialogOpen: boolean;\n  setAddDialogOpen: (open: boolean) => void;\n  openAddDialog: () => void;\n  \n  // Render helper (simple - just pages)\n  renderItems: (\n    renderPage: (\n      page: StandalonePage & { pageNum: number },\n      parentItem?: PageItem\n    ) => React.ReactNode\n  ) => React.ReactNode[];\n  \n  // Reorder helpers (for PageOrderDialog)\n  itemsForReorder: ReorderItem[];\n  handleReorder: (reorderedItems: ReorderItem[]) => void;\n  \n  // Default renderThumbnail (if pageComponents provided)\n  defaultRenderThumbnail?: (item: ReorderItem, index: number, isDragging?: boolean) => React.ReactNode;\n}\n\nexport function usePageGroups(options: UsePageGroupsOptions): UsePageGroupsReturn {\n  const {\n    initialItems,\n    availableItems = [],\n    onItemsChange,\n    onStateChange,\n    pageComponents,\n    payload,\n    setup,\n    stateKey = DEFAULT_PAGE_EDITOR_STATE_KEY,\n    resolveNewItem,\n    notifyError,\n    pageFilter,\n  } = options;\n  \n  const [items, setItems] = useState<PageItem[]>(initialItems);\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  \n  // Track the last initialItems value to detect real changes\n  const prevInitialItemsRef = useRef(initialItems);\n  \n  // Sync items when initialItems changes (for dynamic pageComponentKeys)\n  // Only update if the content actually changed, not just the reference\n  useEffect(() => {\n    // Compare by serialization (simple but effective for this use case)\n    // Use try-catch to handle potential circular references\n    try {\n      const prev = JSON.stringify(prevInitialItemsRef.current);\n      const current = JSON.stringify(initialItems);\n      \n      if (prev !== current) {\n        prevInitialItemsRef.current = initialItems;\n        setItems(initialItems);\n      }\n    } catch (err) {\n      // If stringify fails (e.g., circular refs), fall back to reference comparison\n      if (prevInitialItemsRef.current !== initialItems) {\n        prevInitialItemsRef.current = initialItems;\n        setItems(initialItems);\n      }\n    }\n  }, [initialItems]);\n  \n  // Get TemplateDataProvider context (optional - returns null if not available)\n  const templateDataContext = useContext(TemplateDataContext);\n  \n  // Update items and notify parent\n  const updateItems = useCallback((newItems: PageItem[]) => {\n    setItems(newItems);\n    const state = buildPageEditorState(newItems, stateKey);\n    \n    // If TemplateDataProvider is available, use it as single source of truth for payload updates\n    // This ensures all payload modifications (including reordering) go through the provider\n    if (templateDataContext?.mergePageEditorState) {\n      templateDataContext.mergePageEditorState(newItems, stateKey);\n    }\n    \n    onStateChange?.(state);\n    onItemsChange?.(newItems, state);\n  }, [onItemsChange, onStateChange, stateKey, templateDataContext]);\n  \n  // Count instances by templateId\n  const instanceCountsByTemplate = useMemo(() => {\n    const counts = new Map<string, number>();\n    items.forEach(item => {\n      const templateId = item.templateId ?? item.id;\n      counts.set(templateId, (counts.get(templateId) ?? 0) + 1);\n      if (isPageGroup(item)) {\n        item.pages?.forEach((page) => {\n          const pageTemplateId = (page as any).templateId ?? page.id;\n          counts.set(pageTemplateId, (counts.get(pageTemplateId) ?? 0) + 1);\n        });\n      }\n    });\n    return counts;\n  }, [items]);\n  \n  // Filter available items based on repeatability and maxInstances\n  const availableItemsToAdd = useMemo(() => {\n    return availableItems.filter(item => {\n      // Handle page items\n      if ((item as AvailablePageItem).kind === 'page') {\n        const pageItem = item as AvailablePageItem;\n        const templateId = pageItem.templateId ?? pageItem.id;\n        const count = instanceCountsByTemplate.get(templateId) ?? 0;\n        const isRepeatable = pageItem.repeatable ?? false;\n        const maxInstances = pageItem.maxInstances ?? null;\n\n        if (!isRepeatable && count > 0) {\n          return false;\n        }\n\n        if (maxInstances !== null && count >= maxInstances) {\n          return false;\n        }\n\n        return true;\n      }\n\n      // Handle group items\n      const groupItem = item as AvailableGroupItem;\n      const templateId = groupItem.templateId ?? groupItem.id;\n      const count = instanceCountsByTemplate.get(templateId) ?? 0;\n      const isRepeatable = groupItem.repeatable ?? false;\n      const maxInstances = groupItem.maxInstances ?? null;\n\n      // If not repeatable and already has an instance, hide it\n      if (!isRepeatable && count > 0) {\n        return false;\n      }\n\n      // If repeatable, check maxInstances limit\n      if (isRepeatable && maxInstances !== null && count >= maxInstances) {\n        return false;\n      }\n\n      return true;\n    });\n  }, [availableItems, instanceCountsByTemplate]);\n  \n  // Calculate total page count\n  const totalPageCount = useMemo(() => getTotalPageCount(items), [items]);\n  \n  // Add item (page or group) - creates instance from template\n  const addItem = useCallback(async (item: AvailableItem) => {\n    const resolveIntegrationMode = (\n      integration?: IntegrationRequirement | IntegrationConfig\n    ): IntegrationRequirement => {\n      if (!integration) return 'none';\n      if (typeof integration === 'string') return integration;\n      return integration.mode ?? 'optional';\n    };\n\n    // Helper to evaluate pageComponentKeys (static array or function)\n    const evaluatePageComponentKeys = (\n      keys: string[] | ((context: { payload: any; item?: any; parent?: any }) => string[]) | undefined,\n      context: { payload: any; item?: any; parent?: any }\n    ): string[] => {\n      if (!keys) return [];\n      if (Array.isArray(keys)) return keys;\n      \n      // Evaluate function with error handling\n      try {\n        const result = keys(context);\n        \n        // Validate result is an array\n        if (!Array.isArray(result)) {\n          console.error('[uhuu-components] pageComponentKeys function must return an array, got:', typeof result);\n          return [];\n        }\n        \n        // Filter to ensure all items are strings\n        const filtered = result.filter(key => typeof key === 'string');\n        if (filtered.length !== result.length) {\n          console.warn('[uhuu-components] pageComponentKeys returned non-string values, filtering them out');\n        }\n        \n        return filtered;\n      } catch (err) {\n        console.error('[uhuu-components] Error evaluating pageComponentKeys function:', err);\n        return [];\n      }\n    };\n\n    const createDraftFromAvailable = (available: AvailableItem): PageItem => {\n      // Handle page items\n      if ((available as AvailablePageItem).kind === 'page') {\n        const pageItem = available as AvailablePageItem;\n        const templateId = pageItem.templateId ?? pageItem.id;\n        const componentKey = pageItem.componentKey ?? pageItem.id;\n        return instantiatePage(templateId, componentKey, {\n          label: pageItem.label,\n          className: pageItem.className,\n          repeatable: pageItem.repeatable,\n          maxInstances: pageItem.maxInstances,\n          integration: pageItem.integration,\n          strictPosition: pageItem.strictPosition,\n        });\n      }\n\n      // Handle group items\n      const groupConfig = available as AvailableGroupItem;\n      const templateId = groupConfig.templateId ?? groupConfig.id;\n      \n      // Evaluate pageComponentKeys with context\n      const context = {\n        payload,\n        item: undefined, // Will be set after construction\n        parent: undefined,\n      };\n      const componentKeys = evaluatePageComponentKeys(groupConfig.pageComponentKeys, context);\n\n      return instantiateGroup(templateId, componentKeys, {\n        label: groupConfig.label,\n        repeatable: groupConfig.repeatable ?? false,\n        maxInstances: groupConfig.maxInstances ?? null,\n        integration: groupConfig.integration,\n      });\n    };\n\n    const draft = createDraftFromAvailable(item);\n    const debugIntegration = typeof window !== 'undefined'\n      && (window as any).$uhuu?.debug;\n    let integrationData: any = undefined;\n\n    let resolved: PageItem | null | void = draft;\n    if (resolveNewItem) {\n      resolved = await resolveNewItem(draft);\n    } else {\n      const integrationMode = resolveIntegrationMode((draft as any).integration);\n      let shouldAbort = false;\n\n      if (debugIntegration) {\n        console.debug('[usePageGroups] integration check', {\n          id: draft.id,\n          kind: (draft as any).kind,\n          integration: (draft as any).integration,\n          mode: integrationMode,\n        });\n      }\n\n      if (integrationMode !== 'none' && typeof window !== 'undefined') {\n        const requestIntegration = (window as any).$uhuu?.requestIntegration?.bind((window as any).$uhuu);\n        if (requestIntegration) {\n          if (debugIntegration) {\n            console.debug('[usePageGroups] requestIntegration start', { id: draft.id, mode: integrationMode });\n          }\n          integrationData = await requestIntegration({ item: draft, mode: integrationMode });\n          if (debugIntegration) {\n            console.debug('[usePageGroups] requestIntegration done', { id: draft.id, hasData: integrationData != null });\n          }\n          if (integrationData == null && integrationMode === 'required') {\n            shouldAbort = true;\n          }\n        } else if (integrationMode === 'required') {\n          console.warn('[usePageGroups] Integration data required but $uhuu.requestIntegration is not available.');\n          shouldAbort = true;\n        }\n      }\n\n      if (shouldAbort) return;\n\n    }\n\n    if (resolved === null) return;\n    const finalItem = (resolved ?? draft) as PageItem;\n    \n    // Store integration data using the instance ID\n    // For groups, this is the group ID; for pages, it's the page ID\n    if (integrationData !== undefined && templateDataContext?.setIntegrationPayload) {\n      const instanceId = finalItem.id;\n      if (debugIntegration) {\n        console.debug('[usePageGroups] storing integration data', {\n          instanceId,\n          hasData: integrationData != null,\n          dataKeys: integrationData ? Object.keys(integrationData) : [],\n        });\n      }\n      templateDataContext.setIntegrationPayload(instanceId, integrationData);\n    }\n    \n    // Insert item in correct position based on strictPosition flags\n    const insertItemInPosition = (newItems: PageItem[], itemToInsert: PageItem): PageItem[] => {\n      const itemPosition = (itemToInsert as any).strictPosition;\n      \n      // If the new item has a strictPosition flag, insert it accordingly\n      if (itemPosition === 'start') {\n        return [itemToInsert, ...newItems];\n      } else if (itemPosition === 'end') {\n        return [...newItems, itemToInsert];\n      }\n      \n      // Otherwise, find the insertion point:\n      // - After all items with strictPosition: 'start'\n      // - Before all items with strictPosition: 'end'\n      const startItems: PageItem[] = [];\n      const middleItems: PageItem[] = [];\n      const endItems: PageItem[] = [];\n      \n      newItems.forEach(item => {\n        const position = (item as any).strictPosition;\n        if (position === 'start') {\n          startItems.push(item);\n        } else if (position === 'end') {\n          endItems.push(item);\n        } else {\n          middleItems.push(item);\n        }\n      });\n      \n      // Insert new item in the middle section\n      return [...startItems, ...middleItems, itemToInsert, ...endItems];\n    };\n    \n    updateItems(insertItemInPosition(items, finalItem));\n  }, [items, updateItems, resolveNewItem, templateDataContext]);\n  \n  // Remove item or page from group\n  const removeItem = useCallback((itemId: string) => {\n    const showError = (message: string) => {\n      if (notifyError) {\n        notifyError(message);\n      } else {\n        alert(message);\n      }\n    };\n\n    // First, try to find an item with this ID (standalone page or group)\n    const targetItem = items.find(i => i.id === itemId);\n    \n    // If found as a direct item (group or standalone page), remove it entirely\n    if (targetItem) {\n      const totalCount = getTotalPageCount(items);\n      if (totalCount <= 1) {\n        showError('Cannot remove the last page. At least one page is required.');\n        return;\n      }\n      \n      // Remove integration data if it exists for this instance\n      if (templateDataContext?.removeIntegrationPayload) {\n        const instanceId = targetItem.id;\n        const hasIntegrationData = templateDataContext.payload?.integrations?.[instanceId] !== undefined;\n        if (hasIntegrationData) {\n          templateDataContext.removeIntegrationPayload(instanceId);\n        }\n      }\n      updateItems(items.filter(item => item.id !== itemId));\n      return;\n    }\n    \n    // If not found as direct item, it might be a page ID within a group\n    for (const item of items) {\n      if (isPageGroup(item) && item.pages.some(p => p.id === itemId)) {\n        const totalCount = getTotalPageCount(items);\n        if (totalCount <= 1) {\n          showError('Cannot remove the last page. At least one page is required.');\n          return;\n        }\n        \n        if (item.pages.length === 1) {\n          // Last page in group - remove the entire group\n          // Remove integration data if it exists for this group instance\n          if (templateDataContext?.removeIntegrationPayload) {\n            const instanceId = item.id;\n            const hasIntegrationData = templateDataContext.payload?.integrations?.[instanceId] !== undefined;\n            if (hasIntegrationData) {\n              templateDataContext.removeIntegrationPayload(instanceId);\n            }\n          }\n          updateItems(items.filter(i => i.id !== item.id));\n        } else {\n          // Multiple pages in group - remove just this page from the group\n          // Note: We don't remove integration data here because the group still exists\n          // and other pages in the group may still use the integration data\n          updateItems(items.map(i => {\n            if (i.id === item.id && isPageGroup(i)) {\n              return {\n                ...i,\n                pages: i.pages.filter(p => p.id !== itemId),\n              };\n            }\n            return i;\n          }));\n        }\n        return;\n      }\n    }\n  }, [items, notifyError, updateItems, templateDataContext]);\n  \n  const updateItemFields = useCallback((itemId: string, patch: Partial<PageItem>) => {\n    updateItems(items.map(item => {\n      if (item.id === itemId) {\n        if (isPageGroup(item)) {\n          return {\n            ...item,\n            ...patch,\n          };\n        }\n        return { ...item, ...patch };\n      }\n      return item;\n    }));\n  }, [items, updateItems]);\n  \n  // Reorder items\n  const reorderItems = useCallback((newOrder: PageItem[]) => {\n    updateItems(newOrder);\n  }, [updateItems]);\n  \n  // Items with derived pageNum for rendering\n  // Apply page filtering if configured\n  const itemsWithPageNum = useMemo(() => {\n    const itemsWithNumbers = updatePageNumbers(items) as PageItemWithNumbers[];\n    \n    // Apply page filter if configured (preserves original page numbers)\n    if (pageFilter) {\n      return filterPageItems(itemsWithNumbers as PageItem[], pageFilter) as PageItemWithNumbers[];\n    }\n    \n    return itemsWithNumbers;\n  }, [items, pageFilter]);\n  \n  // Render helper - automatically handles pages vs groups\n  const renderItems = useCallback((\n    renderPage: (\n      page: StandalonePage & { pageNum: number },\n      parentItem?: PageItem\n    ) => React.ReactNode\n  ): React.ReactNode[] => {\n    const rendered: React.ReactNode[] = [];\n    itemsWithPageNum.forEach(item => {\n      if (isPageGroup(item)) {\n        const groupPages = (item.pages ?? []) as Array<StandalonePage & { pageNum: number }>;\n        groupPages.forEach(page => {\n          rendered.push(renderPage(page, item));\n        });\n      } else {\n        rendered.push(renderPage(item as StandalonePage & { pageNum: number }, item));\n      }\n    });\n    return rendered;\n  }, [itemsWithPageNum]);\n  \n  // Reorder helpers\n  const itemsForReorder = useMemo(\n    () => transformItemsForReorder(itemsWithPageNum as PageItem[]),\n    [itemsWithPageNum]\n  );\n  \n  const handleReorder = useCallback((reorderedItems: ReorderItem[]) => {\n    const restored = restoreItemsFromReorder(reorderedItems, items);\n    \n    // Enforce strictPosition constraints: items with strictPosition: 'start' stay at start,\n    // items with strictPosition: 'end' stay at end\n    const enforcePositions = (itemsToOrder: PageItem[]): PageItem[] => {\n      const startItems: PageItem[] = [];\n      const middleItems: PageItem[] = [];\n      const endItems: PageItem[] = [];\n      \n      itemsToOrder.forEach(item => {\n        const position = (item as any).strictPosition;\n        if (position === 'start') {\n          startItems.push(item);\n        } else if (position === 'end') {\n          endItems.push(item);\n        } else {\n          middleItems.push(item);\n        }\n      });\n      \n      return [...startItems, ...middleItems, ...endItems];\n    };\n    \n    updateItems(enforcePositions(restored));\n  }, [items, updateItems]);\n  \n  const openAddDialog = useCallback(() => {\n    setAddDialogOpen(true);\n  }, []);\n  \n  // Generate defaultRenderThumbnail if pageComponents provided\n  const defaultRenderThumbnail = useMemo(() => {\n    if (pageComponents) {\n      return createDefaultRenderThumbnail({ pageComponents, payload, setup });\n    }\n    return undefined;\n  }, [pageComponents, payload, setup]);\n  \n  return {\n    items,\n    itemsWithPageNum,\n    totalPageCount,\n    availableItemsToAdd,\n    addItem,\n    removeItem,\n    updateItemFields,\n    reorderItems,\n    addDialogOpen,\n    setAddDialogOpen,\n    openAddDialog,\n    renderItems,\n    itemsForReorder,\n    handleReorder,\n    defaultRenderThumbnail,\n  };\n}\n","import { isPageGroup, PageItem, StandalonePage } from './page-group-utils';\nimport {\n  buildIntegrationPath,\n  resolveIntegrationBinding,\n  resolveIntegrationInstanceId,\n} from './integration-utils';\n\ntype PathBuilder = (subPath?: string) => string | null;\n\nexport type IntegrationBinding = {\n  instanceId: string | null;\n  data?: any;\n  path: PathBuilder;\n};\n\nexport type PageDataBinding = {\n  payload: any;\n  pageId: string;\n  pagePayload?: any;\n  parentGroupId?: string;\n  integration: IntegrationBinding;\n  paths: {\n    integration: PathBuilder;\n    page: PathBuilder;\n    group: PathBuilder;\n    document: PathBuilder;\n  };\n  defaults: {\n    imageGalleryPath?: string | null;\n  };\n};\n\ntype BuildPageDataBindingOptions = {\n  payload: any;\n  page: StandalonePage;\n  parentGroup?: PageItem;\n  pagePayload?: any;\n  defaults?: {\n    imageGalleryPath?: string;\n  };\n};\n\nfunction buildPath(base: string | null, subPath?: string) {\n  if (!base) return null;\n  if (!subPath) return base;\n  return `${base}.${subPath}`;\n}\n\nfunction resolveGalleryPath(\n  payload: any,\n  integrationData: any,\n  defaults?: { imageGalleryPath?: string }\n): string | null | undefined {\n  return (\n    integrationData?.meta?.imageGalleryPath ??\n    integrationData?.config?.imageGalleryPath ??\n    integrationData?.imageGalleryPath ??\n    payload?.options?.imageGalleryPath ??\n    payload?.templateSetup?.options?.imageGalleryPath ??\n    defaults?.imageGalleryPath\n  );\n}\n\nexport function buildPageDataBinding({\n  payload,\n  page,\n  parentGroup,\n  pagePayload,\n  defaults,\n}: BuildPageDataBindingOptions): PageDataBinding {\n  const integrationBinding = resolveIntegrationBinding(payload, page, parentGroup);\n  const groupId = parentGroup && isPageGroup(parentGroup) ? parentGroup.id : undefined;\n  const pageBase = `pages.${page.id}`;\n  const groupBase = groupId ? `pages.${groupId}` : null;\n\n  return {\n    payload,\n    pageId: page.id,\n    pagePayload,\n    parentGroupId: groupId,\n    integration: {\n      instanceId: integrationBinding.instanceId,\n      data: integrationBinding.integration,\n      path: (subPath?: string) =>\n        buildIntegrationPath(integrationBinding.instanceId, subPath),\n    },\n    paths: {\n      integration: (subPath?: string) =>\n        buildIntegrationPath(integrationBinding.instanceId, subPath),\n      page: (subPath?: string) => buildPath(pageBase, subPath),\n      group: (subPath?: string) => buildPath(groupBase, subPath),\n      document: (subPath?: string) => subPath ?? null,\n    },\n    defaults: {\n      imageGalleryPath: resolveGalleryPath(\n        payload,\n        integrationBinding.integration,\n        defaults\n      ),\n    },\n  };\n}\n\nexport function buildIntegrationDialogPath(\n  page: StandalonePage,\n  parentGroup?: PageItem,\n  subPath?: string\n) {\n  const instanceId = resolveIntegrationInstanceId(page, parentGroup);\n  return buildIntegrationPath(instanceId, subPath);\n}\n","import {\n  PageItem,\n  PageGroup,\n  StandalonePage,\n  instantiateGroup,\n  instantiatePage,\n  PageComponent,\n  IntegrationRequirement,\n  IntegrationConfig,\n} from './page-group-utils';\nimport { AvailableItem } from './use-page-groups';\n\ntype SimplePageRef = string | (Partial<StandalonePage> & { id: string; componentKey?: string });\n\n// Context passed to dynamic pageComponentKeys function\nexport type PageComponentKeysContext = {\n  payload: any;                  // Current template payload\n  item?: PageGroup;              // Group item being created/evaluated (may be partially constructed)\n  parent?: PageItem;             // Parent context if nested (future use)\n};\n\ntype PageTemplateDefinition = {\n  label?: string;\n  className?: string;\n  componentKey?: string;\n  dataKey?: string;           // Shared payload slot â€” pages with the same dataKey share storage across layout variants\n  component?: PageComponent;\n  repeatable?: boolean;\n  maxInstances?: number | null;\n  integration?: IntegrationRequirement | IntegrationConfig;\n  allowAsSinglePage?: boolean; // If false, page can only be added as part of a group (default: true)\n  strictPosition?: 'start' | 'end'; // If set, page should always stay at the start or end of the document\n};\n\ntype SimpleGroupDefinition = {\n  id: string;                    // Template ID\n  label?: string;\n  thumbnail?: string;            // Custom thumbnail URL shown in AddPageDialog\n  repeatable?: boolean;          // Can be added multiple times\n  maxInstances?: number | null;  // Max instances (null = unlimited)\n  pageComponentKeys?: string[] | ((context: PageComponentKeysContext) => string[]);  // Template keys - can be static array or function\n  integration?: IntegrationRequirement | IntegrationConfig;\n};\n\ntype BuildPageGroupsConfigArgs = {\n  initial: Array<SimplePageRef | SimpleGroupDefinition | string>;\n  groups?: SimpleGroupDefinition[] | Record<string, SimpleGroupDefinition>;\n  pageComponentKeys?: string[];\n  pages?: Record<string, PageTemplateDefinition>;\n  pageComponents?: Record<string, PageComponent>;\n  payload?: any;  // Payload for evaluating dynamic pageComponentKeys\n};\n\ntype BuildPageGroupsConfigResult = {\n  initialItems: PageItem[];\n  availableItems: AvailableItem[];\n  pageComponents: Record<string, PageComponent>;\n};\n\nconst asPage = (\n  page: SimplePageRef, \n  templateId?: string, \n  isInitial: boolean = false,\n  templateLookup?: Record<string, PageTemplateDefinition>\n): StandalonePage => {\n  const pageId = typeof page === 'string' ? page : page.id;\n  const templateConfig = templateLookup?.[pageId];\n  const componentKey = typeof page === 'string'\n    ? (templateConfig?.componentKey ?? pageId)\n    : (page.componentKey ?? templateConfig?.componentKey ?? page.id);\n  const pageTemplateId = templateId ?? pageId;\n  const repeatable = (typeof page === 'string' ? undefined : (page as any).repeatable) ?? templateConfig?.repeatable ?? false;\n  const maxInstances = (typeof page === 'string' ? undefined : (page as any).maxInstances) ?? templateConfig?.maxInstances ?? null;\n  const label = (typeof page === 'string' ? undefined : page.label) ?? templateConfig?.label;\n  const className = (typeof page === 'string' ? undefined : (page as any).className) ?? templateConfig?.className;\n  const component = (typeof page === 'string' ? undefined : (page as any).component) ?? templateConfig?.component;\n  const integration = (typeof page === 'string' ? undefined : (page as any).integration) ?? templateConfig?.integration;\n  const strictPosition = (typeof page === 'string' ? undefined : (page as any).strictPosition) ?? templateConfig?.strictPosition;\n\n  if (isInitial) {\n    // For initial items with explicit IDs, use the ID directly (don't instantiate)\n    return {\n      kind: 'page',\n      id: pageId,\n      componentKey,\n      templateId: pageTemplateId,\n      label,\n      className,\n      repeatable,\n      maxInstances,\n      integration,\n      component,\n      strictPosition,\n      ...(typeof page === 'string' ? {} : page),\n    };\n  }\n\n  // For items added later, instantiate with unique ID\n  return instantiatePage(pageTemplateId, componentKey, {\n    label,\n    className,\n    repeatable,\n    maxInstances,\n    integration,\n    component,\n    strictPosition,\n    ...(typeof page === 'string' ? {} : page),\n  });\n};\n\nconst asGroup = (\n  group: SimpleGroupDefinition,\n  isInitial: boolean = false,\n  payload?: any,\n  pagesConfig?: Record<string, PageTemplateDefinition>\n): PageGroup => {\n  // Create a minimal context for evaluation\n  const context: PageComponentKeysContext = {\n    payload,\n    item: undefined, // Not available during initial construction\n    parent: undefined,\n  };\n\n  const componentKeys = evaluatePageComponentKeys(group.pageComponentKeys, context);\n\n  // Resolve ComponentKeyEntry array: attach dataKey from page config when defined\n  const entries = componentKeys.map(key => {\n    const dataKey = pagesConfig?.[key]?.dataKey;\n    return dataKey ? { key, dataKey } : key;\n  });\n\n  // For initial items, use the template ID directly (don't instantiate)\n  // For items added later, instantiate with unique IDs\n  if (isInitial) {\n    const instanceId = group.id; // Use template ID as instance ID for initial items\n    const result: PageGroup = {\n      kind: 'group',\n      id: instanceId,\n      templateId: group.id,\n      label: group.label,\n      repeatable: group.repeatable ?? false,\n      maxInstances: group.maxInstances ?? null,\n      integration: group.integration,\n      pages: entries.map((entry, idx) => {\n        const key = typeof entry === 'string' ? entry : entry.key;\n        const dataKey = typeof entry === 'string' ? undefined : entry.dataKey;\n        return {\n          id: `${instanceId}__${dataKey ?? key}__${idx}`,\n          componentKey: key,\n          templateId: key,\n          ...(dataKey ? { dataKey } : {}),\n        };\n      }),\n    };\n    return result;\n  }\n\n  return instantiateGroup(group.id, entries, {\n    label: group.label,\n    repeatable: group.repeatable ?? false,\n    maxInstances: group.maxInstances ?? null,\n    integration: group.integration,\n  });\n};\n\nconst normalizeGroups = (groups?: SimpleGroupDefinition[] | Record<string, SimpleGroupDefinition>): SimpleGroupDefinition[] => {\n  if (!groups) return [];\n  if (Array.isArray(groups)) return groups;\n  return Object.entries(groups).map(([id, def]) => ({ ...def, id }));\n};\n\n// Helper to evaluate pageComponentKeys (static array or function)\nconst evaluatePageComponentKeys = (\n  keys: string[] | ((context: PageComponentKeysContext) => string[]) | undefined,\n  context: PageComponentKeysContext\n): string[] => {\n  if (!keys) return [];\n  if (Array.isArray(keys)) return keys;\n  \n  // Evaluate function with error handling\n  try {\n    const result = keys(context);\n    \n    // Validate result is an array\n    if (!Array.isArray(result)) {\n      console.error('[uhuu-components] pageComponentKeys function must return an array, got:', typeof result);\n      return [];\n    }\n    \n    // Filter to ensure all items are strings\n    const filtered = result.filter(key => typeof key === 'string');\n    if (filtered.length !== result.length) {\n      console.warn('[uhuu-components] pageComponentKeys returned non-string values, filtering them out');\n    }\n    \n    return filtered;\n  } catch (err) {\n    console.error('[uhuu-components] Error evaluating pageComponentKeys function:', err);\n    return [];\n  }\n};\n\nexport const buildPageGroupsConfig = (args: BuildPageGroupsConfigArgs): BuildPageGroupsConfigResult => {\n  const {\n    initial,\n    groups,\n    pageComponentKeys = [],\n    pages = {},\n    pageComponents: explicitPageComponents = {},\n    payload,\n  } = args;\n\n  const normalizedGroups = normalizeGroups(groups);\n  const groupMap = new Map<string, SimpleGroupDefinition>();\n  normalizedGroups.forEach((group) => groupMap.set(group.id, group));\n  const inferredPageComponentKeys = pageComponentKeys.length ? pageComponentKeys : Object.keys(pages);\n  const mergedPageComponents: Record<string, PageComponent> = { ...explicitPageComponents };\n  Object.entries(pages).forEach(([key, def]) => {\n    if (def.component) mergedPageComponents[key] = def.component;\n  });\n\n  const initialItems: PageItem[] = initial.map((item) => {\n    if (typeof item === 'string') {\n      const maybeGroup = groupMap.get(item);\n      if (maybeGroup) {\n        return asGroup(maybeGroup, true, payload, pages); // Pass payload + pages for dataKey lookup\n      }\n      return asPage(item, undefined, true, pages); // isInitial = true\n    }\n\n    const maybeGroup = (item as any).pageComponentKeys !== undefined;\n    if (maybeGroup) {\n      return asGroup(item as SimpleGroupDefinition, true, payload, pages); // Pass payload + pages for dataKey lookup\n    }\n\n    return asPage(item as SimplePageRef, undefined, true, pages); // isInitial = true\n  });\n\n  const availableGroupItems: AvailableItem[] = normalizedGroups.map((group) => {\n    // For available items, keep the original definition (function or array)\n    // The function will be evaluated when the item is actually added\n    return {\n      kind: 'group',\n      id: group.id, // Template ID\n      templateId: group.id,\n      label: group.label,\n      thumbnail: group.thumbnail,\n      pageComponentKeys: group.pageComponentKeys, // Keep original (function or array)\n      repeatable: group.repeatable ?? false,\n      maxInstances: group.maxInstances ?? null,\n      integration: group.integration,\n    };\n  });\n\n  // For standalone pages, create template items\n  // Filter out pages that are not allowed as single pages (allowAsSinglePage === false)\n  const availablePageItems: AvailableItem[] = inferredPageComponentKeys\n    .filter(key => {\n      const templateConfig = pages?.[key];\n      // Default to true if not specified\n      return templateConfig?.allowAsSinglePage !== false;\n    })\n    .map(key => {\n      const templateConfig = pages?.[key];\n      return {\n        kind: 'page',\n        id: key, // Template ID\n        templateId: key,\n        componentKey: templateConfig?.componentKey ?? key,\n        label: templateConfig?.label,\n        className: templateConfig?.className,\n        repeatable: templateConfig?.repeatable ?? false,\n        maxInstances: templateConfig?.maxInstances ?? null,\n        integration: templateConfig?.integration,\n        strictPosition: templateConfig?.strictPosition,\n      };\n    });\n\n  const availableItems: AvailableItem[] = [\n    ...availablePageItems,\n    ...availableGroupItems,\n  ];\n\n  return { initialItems, availableItems, pageComponents: mergedPageComponents };\n};\n","import * as React from \"react\";\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\";\nimport { cn } from \"./cn\";\nimport { usePortalRoot } from \"../editor-shell/portal-root\";\n\nconst AlertDialog = AlertDialogPrimitive.Root;\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger;\nconst AlertDialogPortal = AlertDialogPrimitive.Portal;\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n));\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName;\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => {\n  const { portalContainer } = usePortalRoot();\n\n  return (\n    <AlertDialogPortal container={portalContainer || undefined}>\n      <AlertDialogOverlay />\n      <AlertDialogPrimitive.Content\n        ref={ref} data-uhuu-editor\n        className={cn(\n          \"fixed left-[50%] top-[50%] z-50 w-full max-w-md translate-x-[-50%] translate-y-[-50%] rounded-md border border-gray-200 bg-white p-6 shadow-lg outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n          className\n        )}\n        {...props}\n      />\n    </AlertDialogPortal>\n  );\n});\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName;\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div className={cn(\"flex flex-col gap-2 text-left\", className)} {...props} />\n);\nAlertDialogHeader.displayName = \"AlertDialogHeader\";\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-6 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\", className)}\n    {...props}\n  />\n);\nAlertDialogFooter.displayName = \"AlertDialogFooter\";\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-base font-semibold text-gray-900\", className)}\n    {...props}\n  />\n));\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName;\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-gray-600\", className)}\n    {...props}\n  />\n));\nAlertDialogDescription.displayName = AlertDialogPrimitive.Description.displayName;\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-md bg-gray-900 px-4 text-sm font-medium text-white transition-colors hover:bg-gray-800\",\n      className\n    )}\n    {...props}\n  />\n));\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName;\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-md border border-gray-200 bg-white px-4 text-sm font-medium text-gray-900 transition-colors hover:bg-gray-50\",\n      className\n    )}\n    {...props}\n  />\n));\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName;\n\nexport {\n  AlertDialog,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n};\n","import { Printer, Check } from 'lucide-react';\nimport { PageFilterConfig } from './page-group-utils';\nimport { Button } from '../../ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '../../ui/dropdown-menu';\n\nexport interface PrintConfig {\n  label: string;\n  filter: PageFilterConfig | null;\n  pageFormat?: { bleed?: number; [key: string]: any }; // PageFormat overrides to merge\n}\n\nexport interface PrintConfigMap {\n  [key: string]: PrintConfig;\n}\n\nexport interface DevPrintControlsProps {\n  modes?: PrintConfigMap;\n  selectedMode?: string; // Current mode from parent\n  onModeChange?: (mode: string, config: PrintConfig) => void;\n  interactive: boolean;\n  onInteractiveChange: (interactive: boolean) => void;\n}\n\n/**\n * Developer print controls - print mode toggle with optional filter dropdown\n */\nexport function DevPrintControls({\n  modes,\n  selectedMode: selectedModeProp,\n  onModeChange,\n  interactive,\n  onInteractiveChange,\n}: DevPrintControlsProps) {\n  const modeKeys = modes ? Object.keys(modes) : [];\n  const currentMode = selectedModeProp || modeKeys[0] || 'all';\n\n  const handleModeSelect = (mode: string) => {\n    // Enter print mode with selected filter\n    onInteractiveChange(false);\n    \n    if (onModeChange && modes && modes[mode]) {\n      onModeChange(mode, modes[mode]);\n    }\n  };\n\n  const currentModeLabel = modes && modes[currentMode] ? modes[currentMode].label : 'All Pages';\n\n  // No modes defined: Simple toggle button\n  if (modeKeys.length === 0) {\n    return (\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={() => onInteractiveChange(!interactive)}\n        className={`text-xs font-medium text-gray-700 hover:bg-gray-100/80 h-7 px-2.5 ${!interactive ? 'bg-gray-100/80' : ''}`}\n      >\n        <Printer className=\"w-3.5 h-3.5\" />\n        {currentModeLabel || 'Print Mode'}\n      </Button>\n    );\n  }\n\n  // Modes defined: Dropdown to select filter\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className={`text-xs font-medium text-gray-700 hover:bg-gray-100/80 h-7 px-2.5 ${!interactive ? 'bg-gray-100/80' : ''}`}\n        >\n          <Printer className=\"w-3.5 h-3.5\" />\n          {currentModeLabel}\n        </Button>\n      </DropdownMenuTrigger>\n      \n      <DropdownMenuContent align=\"center\" className=\"min-w-[160px]\">\n        {modeKeys.map((key) => (\n          <DropdownMenuItem\n            key={key}\n            onClick={() => handleModeSelect(key)}\n            className=\"flex items-center gap-2\"\n          >\n            {currentMode === key ? (\n              <Check className=\"w-3 h-3 text-gray-400\" />\n            ) : (\n              <span className=\"w-3 h-3\" />\n            )}\n            {modes![key].label}\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","/**\n * Check if the code is running in development mode.\n * Checks if running on localhost or local development domains.\n * \n * @returns {boolean} True if running in development mode, false otherwise\n */\nexport function isDev(): boolean {\n  // Only check runtime environment, not build-time variables\n  if (typeof window !== 'undefined') {\n    const hostname = window.location.hostname;\n    return hostname === 'localhost' || \n           hostname === '127.0.0.1' ||\n           hostname.endsWith('.local') ||\n           window.location.port !== '';  // Any port means dev server\n  }\n  \n  return false;\n}\n","import * as React from 'react';\nimport { useMemo, useState, useContext } from 'react';\nimport { Plus, ClipboardList, X } from 'lucide-react';\nimport { useInteractive, useShouldHideUI } from '../interactive-mode-context';\nimport SectionPageResizer, { Section, TwoPageSection } from '../resizers/section-page-resizer';\nimport { AddPageDialog } from './add-page-dialog';\nimport { PageOrderDialog } from './page-order-dialog';\nimport { PageGroup } from './page-group';\nimport { PageCanvas } from './page-canvas';\nimport { PageOptionsDropdown } from './page-options-dropdown';\nimport {\n  isPageGroup,\n  normalizePageItems,\n  PageItem,\n  StandalonePage,\n  PageEditorState,\n  DEFAULT_PAGE_EDITOR_STATE_KEY,\n  PageComponent,\n  readPageEditorState,\n  PageFilterConfig,\n  getTotalPageCount,\n} from './page-group-utils';\nimport { usePageGroups, AvailableItem } from './use-page-groups';\nimport {\n  TemplateDataProvider,\n  TemplateDataContext,\n  getPagePayload as resolvePagePayload,\n  buildPayloadPageOption,\n  type PayloadOptionDefinition,\n} from './template-data-provider';\nimport { resolveIntegrationForPage } from './integration-utils';\nimport { buildPageDataBinding } from './data-binding';\nimport { buildPageGroupsConfig } from './page-group-presets';\nimport { Button } from '../../ui/button';\nimport { Badge } from '../../ui/badge';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '../../ui/alert-dialog';\nimport { DevPrintControls, type PrintConfigMap } from './dev-print-controls';\nimport { isDev } from '../../utility/is-dev';\n\ntype ReferenceRenderer = (page: StandalonePage & { pageNum: number }) => React.ReactNode;\n\n// Schema-based page option types\nexport type PageOptionSelectValue = {\n  label: string;\n  value: string;\n  hex?: string; // For color-series options\n};\n\ntype PageOptionTarget = string | ((pageOrGroup: PageItem) => boolean);\n\ntype BasePageOption = {\n  id: string;\n  label: string;\n  description?: string;\n  appliesTo?: PageOptionTarget | PageOptionTarget[];\n};\n\nexport type SelectPageOption = BasePageOption & {\n  type: 'select';\n  options: PageOptionSelectValue[];\n  getValue: (pageOrGroup: PageItem) => string | number | boolean;\n  onChange?: (\n    pageOrGroupId: string,\n    value: string,\n    context: { item?: PageItem; updateItem: (patch: Partial<PageItem>) => void }\n  ) => void;\n  applyPatch?: (value: string, item?: PageItem) => Partial<PageItem> | void;\n};\n\nexport type TogglePageOption = BasePageOption & {\n  type: 'toggle';\n  getValue: (pageOrGroup: PageItem) => boolean;\n  onChange?: (\n    pageOrGroupId: string,\n    value: string,\n    context: { item?: PageItem; updateItem: (patch: Partial<PageItem>) => void }\n  ) => void;\n  applyPatch?: (value: string, item?: PageItem) => Partial<PageItem> | void;\n};\n\nexport type SliderPageOption = BasePageOption & {\n  type: 'slider';\n  min: number;\n  max: number;\n  step: number;\n  getValue: (pageOrGroup: PageItem) => number;\n  onChange?: (\n    pageOrGroupId: string,\n    value: string,\n    context: { item?: PageItem; updateItem: (patch: Partial<PageItem>) => void }\n  ) => void;\n  applyPatch?: (value: string, item?: PageItem) => Partial<PageItem> | void;\n};\n\nexport type CounterPageOption = BasePageOption & {\n  type: 'counter';\n  min: number;\n  max: number;\n  step: number;\n  getValue: (pageOrGroup: PageItem) => number;\n  onChange?: (\n    pageOrGroupId: string,\n    value: string,\n    context: { item?: PageItem; updateItem: (patch: Partial<PageItem>) => void }\n  ) => void;\n  applyPatch?: (value: string, item?: PageItem) => Partial<PageItem> | void;\n};\n\nexport type ColorSeriesPageOption = BasePageOption & {\n  type: 'color-series';\n  options: PageOptionSelectValue[]; // Must include hex property\n  getValue: (pageOrGroup: PageItem) => string;\n  onChange?: (\n    pageOrGroupId: string,\n    value: string,\n    context: { item?: PageItem; updateItem: (patch: Partial<PageItem>) => void }\n  ) => void;\n  applyPatch?: (value: string, item?: PageItem) => Partial<PageItem> | void;\n};\n\nexport type PageOption = SelectPageOption | TogglePageOption | SliderPageOption | CounterPageOption | ColorSeriesPageOption;\n\ntype PreviewMode = 'single_page' | 'two_pages';\n\ninterface PageEditorProps {\n  templateConfig: Parameters<typeof buildPageGroupsConfig>[0];\n  payload?: any;\n  onPayloadChange?: (nextPayload: any) => void;\n  pageFormat?: { width: number; height: number; preview?: PreviewMode; bleed?: number; [key: string]: any };\n  pageOptions?: Array<PageOption | PayloadOptionDefinition>;\n  notifyError?: (message: string) => void;\n  referenceRenderer?: ReferenceRenderer;\n  renderOverlay?: (args: { pageNo: number; total: number; pageId: string; parent?: PageItem }) => React.ReactNode;\n  renderPage?: (args: { page: StandalonePage & { pageNum: number }; parent?: PageItem }) => React.ReactNode;\n  menuItems?: React.ReactNode;\n  gridColsClass?: string;\n  reorderTitle?: string;\n  reorderDescription?: string;\n  stateKey?: string;\n  onItemsChange?: (items: PageItem[], state: PageEditorState) => void;\n  onStateChange?: (state: PageEditorState) => void;\n  resolveNewItem?: (draft: PageItem) => Promise<PageItem | null | void> | PageItem | null | void;\n  pageFilter?: PageFilterConfig; // Filter which pages to render\n  printConfigs?: PrintConfigMap; // Unified print configurations (includes filter + pageFormat)\n}\n\ntype PageEditorInnerProps = Omit<PageEditorProps, 'templateConfig'> & {\n  initialItems?: PageItem[];\n  availableItems?: AvailableItem[];\n  pageComponents?: { [pageId: string]: PageComponent };\n};\n\nfunction PageEditorInner({\n  initialItems = [],\n  availableItems = [],\n  pageComponents = {},\n  payload,\n  pageFormat,\n  pageOptions = [],\n  notifyError,\n  referenceRenderer,\n  renderOverlay,\n  renderPage,\n  menuItems,\n  gridColsClass,\n  reorderTitle = 'Reorder Pages and Groups',\n  reorderDescription = 'Drag and drop to reorder. Groups move as a single unit.',\n  stateKey = DEFAULT_PAGE_EDITOR_STATE_KEY,\n  onItemsChange,\n  onStateChange,\n  resolveNewItem,\n  pageFilter,\n  printConfigs,\n}: PageEditorInnerProps) {\n  const setup = pageFormat ?? { width: 210, height: 297 };\n  const { interactive, setInteractive, enableDevTools } = useInteractive();\n  const shouldHideUI = useShouldHideUI();\n  \n  // Dev print mode state\n  const [devFilter, setDevFilter] = useState<PageFilterConfig | null>(null);\n  const [devPageFormat, setDevPageFormat] = useState<any>(null);\n  const [devSelectedMode, setDevSelectedMode] = useState<string | undefined>(undefined);\n  \n  // Use devFilter if set, otherwise use pageFilter prop\n  const effectiveFilter = devFilter ?? pageFilter;\n  \n  // Apply dev pageFormat overrides if set, otherwise use original pageFormat\n  const effectivePageFormat = useMemo(() => {\n    if (devPageFormat) {\n      return { ...setup, ...devPageFormat };\n    }\n    return setup;\n  }, [setup, devPageFormat]);\n  \n  // Get payload from context if available (preferred), otherwise use prop\n  const templateDataContext = useContext(TemplateDataContext);\n  const effectivePayload = templateDataContext?.payload ?? payload;\n  const [orderDialogOpen, setOrderDialogOpen] = useState(false);\n  const preview: PreviewMode = effectivePageFormat?.preview ?? 'single_page';\n  const pageSetup = useMemo(\n    () => (preview === 'two_pages' ? { ...effectivePageFormat, preview: 'single_page' } : effectivePageFormat),\n    [preview, effectivePageFormat]\n  );\n\n  const normalizedItems = useMemo(() => normalizePageItems(initialItems), [initialItems]);\n  const resolvedPageOptions = useMemo(() => {\n    if (!pageOptions?.length) return [];\n\n    return pageOptions\n      .map((option) => {\n        if ('getValue' in option) return option;\n\n        if (!templateDataContext?.setPageOptionValue) {\n          if (isDev() || enableDevTools) {\n            console.warn(\n              'PageEditor: payload-backed pageOptions require TemplateDataProvider or payload/onPayloadChange.'\n            );\n          }\n          return null;\n        }\n\n        return buildPayloadPageOption(\n          option,\n          templateDataContext.payload,\n          templateDataContext.setPageOptionValue\n        );\n      })\n      .filter(Boolean) as PageOption[];\n  }, [pageOptions, templateDataContext]);\n\n  const {\n    items,\n    itemsWithPageNum,\n    totalPageCount,\n    availableItemsToAdd,\n    addItem,\n    removeItem,\n    updateItemFields,\n    addDialogOpen,\n    setAddDialogOpen,\n    openAddDialog,\n    itemsForReorder,\n    handleReorder,\n    defaultRenderThumbnail,\n  } = usePageGroups({\n    initialItems: normalizedItems,\n    availableItems,\n    pageComponents,\n    payload: effectivePayload,\n    setup,\n    stateKey,\n    onItemsChange,\n    onStateChange,\n    resolveNewItem,\n    notifyError,\n    pageFilter: effectiveFilter,\n  });\n\n  const handlePageOptionChange = React.useCallback(\n    (pageOption: PageOption, targetItem: PageItem | undefined, value: string) => {\n      if (!targetItem) return;\n\n      const patch = pageOption.applyPatch?.(value, targetItem);\n      if (patch) {\n        updateItemFields(targetItem.id, patch);\n      }\n\n      pageOption.onChange?.(targetItem.id, value, {\n        item: targetItem,\n        updateItem: (patch) => updateItemFields(targetItem.id, patch),\n      });\n    },\n    [updateItemFields]\n  );\n\n  const defaultOverlay = (info: { pageNo: number; total: number }) => (\n    <div className=\"absolute bottom-[10mm] left-[15mm] right-[15mm] text-[7pt] text-gray-600 flex items-center justify-between pointer-events-none\">\n      <span>Page</span>\n      <span>\n        {info.pageNo} / {info.total}\n      </span>\n    </div>\n  );\n\n  const buildOverlay = (pageNo: number, pageId: string, parent?: PageItem) => {\n    if (renderOverlay) {\n      return renderOverlay({ pageNo, total: totalPageCount, pageId, parent });\n    }\n    return defaultOverlay({ pageNo, total: totalPageCount });\n  };\n\n  const renderPageContent = (page: StandalonePage & { pageNum: number }, parent?: PageItem) => {\n    if (renderPage) {\n      return renderPage({ page, parent });\n    }\n\n    const componentKey = page.componentKey ?? page.id;\n    const reference = referenceRenderer ? referenceRenderer(page) : null;\n    const templateId = page.templateId ?? componentKey;\n    const PageComponent = pageComponents[componentKey];\n    const pagePayload = templateDataContext?.getPagePayload\n      ? templateDataContext.getPagePayload(page)\n      : resolvePagePayload(effectivePayload, { id: page.id, templateId, componentKey });\n    \n    // Resolve integration data using utility function\n    // For group pages, prefer parent group's integration; fallback to page's own integration\n    const integration = resolveIntegrationForPage(\n      effectivePayload,\n      page,\n      parent\n    );\n\n    const dataBinding = buildPageDataBinding({\n      payload: effectivePayload,\n      page,\n      parentGroup: parent,\n      pagePayload,\n    });\n\n    return (\n      <PageCanvas\n        pageId={page.id}\n        templateId={templateId}\n        pageNo={page.pageNum}\n        component={PageComponent}\n        payload={effectivePayload}\n        pagePayload={pagePayload}\n        integration={integration}\n        page={page}\n        parentGroup={parent}\n        componentKey={componentKey}\n        setup={pageSetup}\n        reference={reference}\n        overlay={({ pageNo }) => buildOverlay(pageNo, page.id, parent)}\n        className={page.className}\n        dataBinding={dataBinding}\n      />\n    );\n  };\n\n  // Render controls for standalone pages or group pages\n  const renderPageControls = (page: StandalonePage & { pageNum: number }, parentGroup?: PageItem) => {\n    const isGroupPage = !!parentGroup && isPageGroup(parentGroup);\n    const isFirstPageInGroup = isGroupPage && parentGroup.pages[0]?.id === page.id;\n    \n    // For group pages, only show controls on the first page (group-level controls)\n    if (isGroupPage && !isFirstPageInGroup) {\n      return (\n        <div className=\"pl-0 pr-3 py-1.5 flex justify-between items-center h-10\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"page-number\">\n              {page.pageNum}\n            </span>\n            {page.label && (\n              <span className=\"text-xs text-gray-500\">\n                {page.label}\n              </span>\n            )}\n            <span className=\"text-xs text-gray-400\">Â·</span>\n          </div>\n        </div>\n      );\n    }\n\n    // Group-level controls (for first page in group) or standalone page controls\n    return (\n      <div className=\"pl-0 py-1.5 flex justify-start gap-2 items-center\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"page-number\">\n            {page.pageNum}\n          </span>\n          {page.label && (\n            <span className=\"text-xs text-gray-500\">\n              {page.label}\n            </span>\n          )}\n          {isGroupPage && (\n            <Badge \n              variant=\"outline\" \n              className=\"hidden sm:inline-flex text-xs font-normal text-gray-600 border-gray-200 bg-transparent cursor-pointer hover:bg-gray-50 transition-colors\"\n              onClick={() => {\n                const currentLabel = parentGroup.label || parentGroup.id;\n                const entered = window.prompt('Rename group:', currentLabel);\n                if (entered !== null) {\n                  const trimmed = entered.trim();\n                  updateItemFields(parentGroup.id, { label: trimmed || undefined });\n                }\n              }}\n              title=\"Click to rename\"\n              data-group-id={parentGroup.id}\n            >\n              {parentGroup.label || parentGroup.id}\n            </Badge>\n          )}\n        </div>\n        <div className=\"flex items-center\">\n          <PageOptionsDropdown\n            pageOptions={resolvedPageOptions}\n            targetItem={isGroupPage ? parentGroup : page}\n            onChange={handlePageOptionChange}\n            onRemove={removeItem}\n            showRemove={totalPageCount > 1}\n            title={isGroupPage ? \"Group options\" : \"Page options\"}\n            removeLabel={isGroupPage ? \"Remove Group\" : \"Remove\"}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  type PageWithParent = (StandalonePage & { pageNum: number }) & {\n    parentGroup?: PageItem;\n  };\n\n  const flattenedPagesForTwoPages = useMemo<PageWithParent[]>(() => {\n    if (preview !== 'two_pages') return [];\n\n    const flattened: PageWithParent[] = [];\n    \n    for (const item of itemsWithPageNum) {\n      const pages = isPageGroup(item) \n        ? (item.pages ?? []) as Array<StandalonePage & { pageNum: number }>\n        : [item as StandalonePage & { pageNum: number }];\n\n      for (const page of pages) {\n        if (page?.id) {\n          flattened.push({\n            ...page,\n            kind: 'page' as const,\n            id: page.id,\n            pageNum: page.pageNum ?? 1,\n            parentGroup: isPageGroup(item) ? item : undefined,\n          });\n        }\n      }\n    }\n\n    return flattened.sort((a, b) => (a.pageNum ?? 0) - (b.pageNum ?? 0));\n  }, [preview, itemsWithPageNum]);\n\n  type PagePair = {\n    left?: PageWithParent;\n    right?: PageWithParent;\n    layout: \"spread\" | \"left\" | \"right\";\n  };\n\n  /**\n   * Transform origin logic for two-page spreads:\n   * - Even pages (2,4,6...) appear on LEFT side â†’ scale from RIGHT edge (gutter)\n   * - Odd pages (1,3,5...) appear on RIGHT side â†’ scale from LEFT edge (gutter)\n   * This ensures pages meet precisely at center when zoomed\n   */\n  const pagePairs = useMemo<PagePair[]>(() => {\n    if (preview !== 'two_pages') return [];\n\n    const pages = flattenedPagesForTwoPages;\n    if (!pages.length) return [];\n    \n    // Page 1 is always alone on the right (cover)\n    const pairs: PagePair[] = [{ left: undefined, right: pages[0], layout: \"right\" }];\n    \n    // Subsequent pages are paired: 2-3, 4-5, 6-7, etc.\n    for (let i = 1; i < pages.length; i += 2) {\n      const leftPage = pages[i];\n      const rightPage = pages[i + 1];\n      \n      if (rightPage) {\n        pairs.push({ left: leftPage, right: rightPage, layout: \"spread\" });\n      } else {\n        // Single page at end: even pages go left, odd pages go right\n        const isEven = leftPage.pageNum % 2 === 0;\n        pairs.push({\n          left: isEven ? leftPage : undefined,\n          right: isEven ? undefined : leftPage,\n          layout: isEven ? \"left\" : \"right\",\n        });\n      }\n    }\n    \n    return pairs;\n  }, [preview, flattenedPagesForTwoPages]);\n\n  const defaultMenu = (\n    <div className=\"flex items-center gap-1\">\n      <Badge variant=\"secondary\" className=\"font-normal text-xs bg-gray-100/80 text-gray-700 border-0\">\n        {totalPageCount} {totalPageCount === 1 ? 'Page' : 'Pages'}\n      </Badge>\n      { enableDevTools && printConfigs && (\n        <DevPrintControls\n          modes={printConfigs}\n          selectedMode={devSelectedMode}\n          onModeChange={(mode, config) => {\n            setDevSelectedMode(mode);\n            setDevFilter(config.filter ?? null);\n            setDevPageFormat(config.pageFormat ?? null);\n          }}\n          interactive={interactive}\n          onInteractiveChange={(newInteractive) => {\n            setInteractive(newInteractive);\n            // Reset pageFormat overrides when going back to edit mode\n            if (newInteractive) {\n              setDevPageFormat(null);\n            }\n          }}\n        />        \n      )}      \n      {interactive && (\n        <>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={openAddDialog}\n            title=\"Add page or group\"\n            className=\"text-xs font-medium text-gray-700 hover:bg-gray-100/80 h-7 px-2.5\"\n          >\n            <Plus className=\"w-3.5 h-3.5\" />\n            Add\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setOrderDialogOpen(true)}\n            title=\"Reorder pages and groups using drag and drop\"\n            className=\"text-xs font-medium text-gray-700 hover:bg-gray-100/80 h-7 px-2.5\"\n          >\n            <ClipboardList className=\"w-3.5 h-3.5\" />\n            Reorder\n          </Button>\n        </>\n      )}\n    </div>\n  );\n\n  return (\n    <>\n      {/* Back button when in print mode - always rendered, hidden in print output */}\n      {enableDevTools && !interactive && (\n        <Button\n          onClick={() => setInteractive(true)}\n          data-uhuu-editor\n          size=\"sm\"\n          className=\"screen-only fixed top-4 right-4 z-50 flex items-center gap-1.5 !text-xs rounded-full\"\n          title=\"Back to Edit Mode\"\n        >\n          <X className=\"w-4 h-4\" />\n          Back to Editor\n        </Button>\n      )}\n      \n      <SectionPageResizer\n        defaultZoom={80}\n        minZoom={25}\n        maxZoom={200}\n        menuItems={menuItems ?? defaultMenu}\n        onAddPage={openAddDialog}\n        preview={preview}\n      >\n        {preview === 'two_pages' ? (\n          pagePairs.map((pair, index) => (\n              <TwoPageSection key={`pair-${index}`} layout={pair.layout}>\n                {pair.left && (\n                  <Section\n                    key={pair.left.id}\n                    title={`Sheet ${pair.left.pageNum}`}\n                    controls={renderPageControls(pair.left, pair.left.parentGroup)}\n                    origin={pair.left.pageNum % 2 === 0 ? 'right' : 'left'}\n                  >\n                    {renderPageContent(pair.left, pair.left.parentGroup)}\n                  </Section>\n                )}\n                {pair.right && (\n                  <Section\n                    key={pair.right.id}\n                    title={`Sheet ${pair.right.pageNum}`}\n                    controls={renderPageControls(pair.right, pair.right.parentGroup)}\n                    origin={pair.right.pageNum % 2 === 0 ? 'right' : 'left'}\n                  >\n                    {renderPageContent(pair.right, pair.right.parentGroup)}\n                  </Section>\n                )}\n              </TwoPageSection>\n            ))\n        ) : (\n          itemsWithPageNum.map((item) => {\n            if (isPageGroup(item)) {\n              const pagesWithNumbers = (item.pages ?? []) as Array<StandalonePage & { pageNum: number }>;\n              return (\n                <PageGroup\n                  key={item.id}\n                  group={item}\n                  pagesWithPageNum={pagesWithNumbers}\n                  onRemove={removeItem}\n                  onLabelChange={(groupId, label) => {\n                    updateItemFields(groupId, { label: label || undefined });\n                  }}\n                  totalItems={items.length}\n                  renderPage={(page) => renderPageContent(page, item)}\n            pageOptions={resolvedPageOptions}\n                  onPageOptionChange={(pageOption, target, value) => handlePageOptionChange(pageOption, target, value)}\n                />\n              );\n            }\n\n            const page = item as StandalonePage & { pageNum: number };\n            return (\n              <Section\n                key={page.id}\n                title={`Sheet ${page.pageNum}`}\n                controls={renderPageControls(page)}\n              >\n                {renderPageContent(page)}\n              </Section>\n            );\n          })\n        )}\n      </SectionPageResizer>\n\n      {interactive && !shouldHideUI && (\n        <>\n          <AddPageDialog\n            open={addDialogOpen}\n            onOpenChange={setAddDialogOpen}\n            availableItems={availableItemsToAdd}\n            onSelectItem={addItem}\n            pageComponents={pageComponents}\n            payload={effectivePayload}\n            setup={setup}\n            gridColsClass={gridColsClass}\n            data-uhuu-editor\n          />\n\n          <PageOrderDialog\n            open={orderDialogOpen}\n            onOpenChange={setOrderDialogOpen}\n            pages={itemsForReorder}\n            onReorder={(newOrder) => {\n              handleReorder(newOrder);\n              setOrderDialogOpen(false);\n            }}\n            pageComponents={pageComponents}\n            payload={effectivePayload}\n            setup={setup}\n            renderThumbnail={defaultRenderThumbnail}\n            title={reorderTitle}\n            description={reorderDescription}\n            gridColsClass={gridColsClass}\n            data-uhuu-editor\n          />\n        </>\n      )}\n    </>\n  );\n}\n\nfunction PageEditorView(props: PageEditorProps) {\n  const { templateConfig, ...rest } = props;\n  // Check if TemplateDataProvider already exists in the tree\n  const existingContext = useContext(TemplateDataContext);\n  \n  // If context exists, or if no payload/onPayloadChange is provided, render directly\n  // Otherwise, wrap with TemplateDataProvider for automatic payload management\n  if (existingContext || (!props.payload && !props.onPayloadChange)) {\n    return <PageEditorInner {...rest} />;\n  }\n  \n  // Wrap with TemplateDataProvider to enable automatic payload updates\n  // Pass stateKey so it can preserve page editor state correctly\n  return (\n    <TemplateDataProvider \n      payload={props.payload} \n      onPayloadChange={props.onPayloadChange}\n      stateKey={props.stateKey}\n    >\n      <PageEditorInner {...rest} />\n    </TemplateDataProvider>\n  );\n}\n\nexport function PageEditor(props: PageEditorProps) {\n  const templateDataContext = useContext(TemplateDataContext);\n  const effectivePayload = templateDataContext?.payload ?? props.payload;\n  \n  // Evaluate config with current payload - this re-runs when payload changes\n  const resolvedConfig = React.useMemo(\n    () => buildPageGroupsConfig({ ...props.templateConfig, payload: effectivePayload }),\n    [props.templateConfig, effectivePayload]\n  );\n  \n  const [noticeState, setNoticeState] = React.useState<{ open: boolean; message: string }>({\n    open: false,\n    message: '',\n  });\n\n  const notifyError = React.useCallback((message: string) => {\n    setNoticeState({ open: true, message });\n  }, []);\n\n  // Read persisted state\n  const restoredState = React.useMemo(\n    () => readPageEditorState(effectivePayload),\n    [effectivePayload]\n  );\n  \n  // Smart state restoration: re-evaluate dynamic groups and preserve user additions\n  const restoredItems = React.useMemo(() => {\n    if (!restoredState?.items) {\n      return resolvedConfig.initialItems;\n    }\n\n    // Build a lookup of group definitions (with their original pageComponentKeys functions)\n    const rawGroups = props.templateConfig.groups ?? {};\n    const groupDefs: any[] = Array.isArray(rawGroups)\n      ? rawGroups\n      : Object.entries(rawGroups).map(([id, g]: [string, any]) => ({ id, ...g }));\n    const groupDefMap = new Map<string, any>(groupDefs.map((g: any) => [g.id, g]));\n\n    // Re-evaluate dynamic pageComponentKeys for every group in persisted state.\n    // This keeps user-added groups alive while updating their pages to match\n    // the current payload (e.g. sectionLayout change).\n    const pagesConfig: Record<string, any> = props.templateConfig.pages ?? {};\n    const rehydrated = restoredState.items.map((item: PageItem) => {\n      if (item.kind !== 'group') return item;\n      const templateId = (item as any).templateId ?? item.id;\n      const groupDef = groupDefMap.get(templateId);\n      // Re-apply strictPosition from group definition if missing on the persisted item\n      const baseItem: PageItem = (groupDef?.strictPosition !== undefined && !(item as any).strictPosition)\n        ? { ...item, strictPosition: groupDef.strictPosition } as PageItem\n        : item;\n      if (!groupDef || typeof groupDef.pageComponentKeys !== 'function') return baseItem;\n      try {\n        const newKeys: string[] = groupDef.pageComponentKeys({ payload: effectivePayload, item: undefined, parent: undefined });\n\n        // Handle invalid return values\n        if (!Array.isArray(newKeys)) {\n          console.error(`[PageEditor] pageComponentKeys for group ${baseItem.id} must return an array, got:`, typeof newKeys);\n          return baseItem;\n        }\n\n        // Handle empty arrays - update to zero pages (intentional hide)\n        if (newKeys.length === 0) {\n          return {\n            ...baseItem,\n            pages: [],\n          };\n        }\n\n        return {\n          ...baseItem,\n          pages: newKeys.map((key: string, idx: number) => {\n            const dataKey = pagesConfig[key]?.dataKey;\n            return {\n              id: `${baseItem.id}__${dataKey ?? key}__${idx}`,\n              componentKey: key,\n              templateId: key,\n              ...(dataKey ? { dataKey } : {}),\n            };\n          }),\n        };\n      } catch (err) {\n        console.error(`[PageEditor] Error evaluating pageComponentKeys for group ${baseItem.id}:`, err);\n        return baseItem;\n      }\n    });\n\n    // Safety check: if the initial-item page counts still differ after rehydration\n    // (e.g. a static initial group was added/removed from config), use fresh initial\n    // items but preserve any user-added groups at the end.\n    const initialItemIds = new Set(resolvedConfig.initialItems.map((i: PageItem) => i.id));\n    const rehydratedInitialCount = getTotalPageCount(rehydrated.filter((i: PageItem) => initialItemIds.has(i.id)));\n    const freshInitialCount = getTotalPageCount(resolvedConfig.initialItems);\n\n    if (rehydratedInitialCount !== freshInitialCount) {\n      // Only preserve truly user-added groups (where id !== templateId).\n      // Initial groups have id === templateId, so they should be re-created from fresh config.\n      const addedItems = rehydrated.filter((i: PageItem) => {\n        if (i.kind !== 'group') return !initialItemIds.has(i.id);\n        const templateId = (i as any).templateId ?? i.id;\n        // If id matches templateId, it's an initial group (not user-added)\n        return i.id !== templateId && !initialItemIds.has(i.id);\n      });\n      return addedItems.length > 0\n        ? [...resolvedConfig.initialItems, ...addedItems]\n        : resolvedConfig.initialItems;\n    }\n\n    return rehydrated;\n  }, [restoredState?.items, resolvedConfig.initialItems, effectivePayload, props.templateConfig.groups]);\n\n  return (\n    <>\n      <PageEditorView\n        {...props}\n        payload={effectivePayload}\n        initialItems={restoredItems}\n        availableItems={resolvedConfig.availableItems}\n        pageComponents={resolvedConfig.pageComponents}\n        notifyError={notifyError}\n      />\n\n      <AlertDialog\n        open={noticeState.open}\n        onOpenChange={(open) => {\n          if (!open) {\n            setNoticeState({ open: false, message: '' });\n          }\n        }}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Cannot remove item</AlertDialogTitle>\n            <AlertDialogDescription>\n              {noticeState.message}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogAction onClick={() => setNoticeState({ open: false, message: '' })}>\n              OK\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n\nexport default PageEditor;\n","import * as React from 'react';\nimport type { PageDataBinding } from './data-binding';\nimport { getDialogProps } from '../../editable/dialog-props';\n\n/**\n * Dialog configuration options\n */\nexport type DialogOptions = {\n  type?: 'image' | 'text' | 'assistant' | 'markdown' | 'spreadsheet' | 'map';\n  imagePath?: string;\n  imageGalleryPath?: string;\n  ratio?: number;\n  rows?: number;\n  value?: any;\n  payload?: any;\n  [key: string]: any;\n};\n\n/**\n * Dialog configuration returned by dialog builders\n */\nexport type DialogConfig = {\n  path: string;\n  subPath?: string | null;\n  imageGalleryPath?: string;\n  type?: string;\n  imagePath?: string;\n  ratio?: number;\n  rows?: number;\n  value?: any;\n  payload?: any;\n  [key: string]: any;\n};\n\n/**\n * Config-based resolver: map of keys to path strings or functions\n * Path strings support optional chaining (e.g., 'integration.listing ?? integration.pba_listing')\n */\nexport type IntegrationResolverConfig = {\n  [key: string]: string | ((integration: any) => any);\n};\n\n/**\n * Function-based resolver: complex extraction logic\n */\nexport type IntegrationResolverFunction = (\n  integration: any,\n  payload?: any\n) => any;\n\n/**\n * Union type for resolver\n */\nexport type IntegrationResolver = IntegrationResolverConfig | IntegrationResolverFunction;\n\n/**\n * Gallery path resolver: string path or function\n */\nexport type GalleryPathResolver = string | ((integration: any) => string | null);\n\n/**\n * Integration adapter configuration\n */\nexport type IntegrationAdapterConfig = {\n  dataBinding: PageDataBinding;\n  integration: any;\n  resolver: IntegrationResolver;\n  galleryPath?: GalleryPathResolver;\n  defaults?: Record<string, any>;\n};\n\n/**\n * Integration adapter API returned by useIntegrationAdapter\n */\nexport type IntegrationAdapter = {\n  // Resolved data (e.g., { listing, property, media })\n  data: any;\n  \n  // Dialog builder that automatically uses dataBinding\n  dialog: (subPath: string, options?: DialogOptions, value?: any) => DialogConfig | null;\n  \n  // Dialog props helper (combines dialog + getDialogProps)\n  dialogProps: (subPath: string, options?: DialogOptions, value?: any) => Record<string, any>;\n  \n  // Gallery path (resolved from config or integration structure)\n  galleryPath: string | null;\n  \n  // Integration instance info\n  instanceId: string | null;\n  integration: any;\n};\n\n/**\n * Evaluate a path string with optional chaining support\n * Supports patterns like: 'integration.listing ?? integration.pba_listing'\n */\nfunction evaluatePathString(path: string, integration: any): any {\n  if (!path || !integration) return undefined;\n  \n  // Handle nullish coalescing operator (??)\n  if (path.includes('??')) {\n    const parts = path.split('??').map(p => p.trim());\n    for (const part of parts) {\n      const value = getNestedValue(integration, part);\n      if (value !== undefined && value !== null) {\n        return value;\n      }\n    }\n    return undefined;\n  }\n  \n  return getNestedValue(integration, path);\n}\n\n/**\n * Get nested value from object using dot notation\n */\nfunction getNestedValue(obj: any, path: string): any {\n  if (!path) return obj;\n  const keys = path.split('.');\n  let current = obj;\n  for (const key of keys) {\n    if (current == null) return undefined;\n    current = current[key];\n  }\n  return current;\n}\n\n/**\n * Resolve integration data using config-based resolver\n */\nfunction resolveWithConfig(\n  config: IntegrationResolverConfig,\n  integration: any,\n  payload?: any\n): any {\n  const result: any = {};\n  \n  for (const [key, resolver] of Object.entries(config)) {\n    if (typeof resolver === 'function') {\n      result[key] = resolver(integration);\n    } else if (typeof resolver === 'string') {\n      // Remove 'integration.' prefix if present (it's implicit)\n      const path = resolver.startsWith('integration.') \n        ? resolver.slice('integration.'.length)\n        : resolver;\n      result[key] = evaluatePathString(path, integration);\n    }\n  }\n  \n  return result;\n}\n\n/**\n * Resolve integration data using function-based resolver\n */\nfunction resolveWithFunction(\n  resolver: IntegrationResolverFunction,\n  integration: any,\n  payload?: any\n): any {\n  return resolver(integration, payload);\n}\n\n/**\n * Resolve integration data using the configured resolver\n */\nfunction resolveIntegrationData(\n  resolver: IntegrationResolver,\n  integration: any,\n  payload?: any\n): any {\n  if (typeof resolver === 'function') {\n    return resolveWithFunction(resolver, integration, payload);\n  } else {\n    return resolveWithConfig(resolver, integration, payload);\n  }\n}\n\n/**\n * Resolve gallery path from various sources\n */\nfunction resolveGalleryPath(\n  dataBinding: PageDataBinding,\n  integration: any,\n  configGalleryPath?: GalleryPathResolver\n): string | null {\n  // Priority 1: dataBinding.defaults.imageGalleryPath (from integration meta/config)\n  if (dataBinding?.defaults?.imageGalleryPath) {\n    return dataBinding.defaults.imageGalleryPath;\n  }\n  \n  // Priority 2: Config-provided gallery path resolver\n  if (configGalleryPath) {\n    if (typeof configGalleryPath === 'function') {\n      const resolved = configGalleryPath(integration);\n      if (resolved) return resolved;\n    } else if (typeof configGalleryPath === 'string') {\n      return configGalleryPath;\n    }\n  }\n  \n  // Priority 3: Try to infer from integration structure\n  if (integration?.media?.images) return 'media.images';\n  if (integration?.listing?.media?.images) return 'listing.media.images';\n  if (integration?.pba_listing?.media?.images) return 'pba_listing.media.images';\n  if (integration?.property?.media?.images) return 'property.media.images';\n  \n  return null;\n}\n\n/**\n * Build integration dialog path using dataBinding\n */\nfunction buildDialogPath(\n  dataBinding: PageDataBinding,\n  subPath: string,\n  isAssistant: boolean\n): string | null {\n  if (!dataBinding?.integration?.path) return null;\n  \n  if (isAssistant) {\n    // For assistant dialogs, include subPath in the main path\n    return dataBinding.integration.path(subPath);\n  } else {\n    // For other dialogs, get base path and subPath is handled separately\n    return dataBinding.integration.path();\n  }\n}\n\n/**\n * Build dialog configuration\n */\nfunction buildDialogConfig(\n  dataBinding: PageDataBinding,\n  subPath: string,\n  options: DialogOptions = {},\n  value?: any,\n  galleryPath: string | null = null\n): DialogConfig | null {\n  const integrationPath = dataBinding?.integration?.path?.();\n  if (!integrationPath) return null;\n  \n  const isAssistant = options.type === 'assistant';\n  const isImage = options.type === 'image' || options.imagePath;\n  \n  // Build the full path\n  const fullPath = isAssistant\n    ? dataBinding.integration.path(subPath) ?? [integrationPath, subPath].filter(Boolean).join('.')\n    : [integrationPath, subPath].filter(Boolean).join('.');\n  \n  // For image dialogs, resolve gallery path\n  if (isImage) {\n    const resolvedGalleryPath = options.imageGalleryPath \n      ?? (galleryPath ? `${integrationPath}.${galleryPath}` : null)\n      ?? dataBinding.defaults.imageGalleryPath;\n    \n    return {\n      path: fullPath,\n      imagePath: options.imagePath || 'url',\n      imageGalleryPath: resolvedGalleryPath,\n      type: options.type || 'image',\n      ratio: options.ratio,\n      value,\n      payload: options.payload ?? dataBinding.payload,\n      ...options,\n    };\n  }\n  \n  // For assistant dialogs, path includes subPath\n  if (isAssistant) {\n    return {\n      path: fullPath,\n      type: 'assistant',\n      rows: options.rows,\n      value,\n      payload: options.payload ?? dataBinding.payload,\n      ...options,\n    };\n  }\n  \n  // For other dialogs\n  return {\n    path: integrationPath,\n    subPath,\n    type: options.type || 'text',\n    rows: options.rows,\n    value,\n    payload: options.payload ?? dataBinding.payload,\n    ...options,\n  };\n}\n\n/**\n * Hook to create an integration adapter for easy data resolution and dialog building\n * \n * @example\n * ```tsx\n * const adapter = useIntegrationAdapter({\n *   dataBinding,\n *   integration,\n *   resolver: {\n *     listing: 'listing ?? pba_listing',\n *     property: 'property',\n *     media: 'media',\n *   },\n *   galleryPath: (integration) => {\n *     if (integration?.media?.images) return 'media.images';\n *     return 'listing.media.images';\n *   },\n * });\n * \n * // Use resolved data\n * const { listing, property, media } = adapter.data;\n * \n * // Use dialog props\n * <div {...adapter.dialogProps('overrides.heroImage', { type: 'image', imagePath: 'url' }, heroImage)}>\n * ```\n */\nexport function useIntegrationAdapter(\n  config: IntegrationAdapterConfig\n): IntegrationAdapter {\n  const { dataBinding, integration, resolver, galleryPath: configGalleryPath, defaults } = config;\n  \n  // Resolve integration data\n  const resolvedData = React.useMemo(() => {\n    return resolveIntegrationData(resolver, integration, dataBinding?.payload);\n  }, [resolver, integration, dataBinding?.payload]);\n  \n  // Resolve gallery path\n  const galleryPath = React.useMemo(() => {\n    return resolveGalleryPath(dataBinding, integration, configGalleryPath);\n  }, [dataBinding, integration, configGalleryPath]);\n  \n  // Dialog builder\n  const dialog = React.useCallback(\n    (subPath: string, options: DialogOptions = {}, value?: any): DialogConfig | null => {\n      return buildDialogConfig(\n        dataBinding,\n        subPath,\n        options,\n        value,\n        galleryPath\n      );\n    },\n    [dataBinding, galleryPath]\n  );\n  \n  // Dialog props builder (combines dialog + getDialogProps)\n  const dialogProps = React.useCallback(\n    (subPath: string, options: DialogOptions = {}, value?: any): Record<string, any> => {\n      const dialogConfig = dialog(subPath, options, value);\n      if (!dialogConfig) return {};\n      \n      // Use the getDialogProps utility from editable\n      // getDialogProps expects { dialog } and optional config\n      const props = getDialogProps({ dialog: dialogConfig }, { page: { paginationType: 'static' } });\n      \n      // Ensure stopPropagation is called on click\n      if (props.onClick) {\n        const originalOnClick = props.onClick;\n        props.onClick = (e: any) => {\n          e.stopPropagation();\n          originalOnClick(e);\n        };\n      }\n      \n      return props;\n    },\n    [dialog]\n  );\n  \n  return React.useMemo(\n    () => ({\n      data: resolvedData,\n      dialog,\n      dialogProps,\n      galleryPath,\n      instanceId: dataBinding?.integration?.instanceId ?? null,\n      integration,\n    }),\n    [resolvedData, dialog, dialogProps, galleryPath, dataBinding, integration]\n  );\n}\n\n","import { useState, forwardRef, useRef, useImperativeHandle, useCallback } from 'react';\nimport { Previewer } from 'pagedjs';\nimport debounce from 'lodash/debounce';\n\nconst PagedComponent = forwardRef(({ children }, ref) => {\n  const [rendering, setRendering] = useState(false);\n  const containerRef = useRef(null);\n  const pageFlowRef = useRef(null);\n\n  if (typeof document === 'undefined') {\n    return null;\n  }\n\n  // Expose layout method to parent via ref\n  useImperativeHandle(ref, () => ({\n    layout: layoutPage,\n  }));\n\n  // Memoize the layoutPage function with debounce\n  const layoutPage = useCallback(\n    debounce(() => {\n      // Ensure container and flow elements are available\n      if (!containerRef.current || !pageFlowRef.current) {\n        console.warn(\"Container or page flow reference is missing.\");\n        return;\n      }\n\n      setRendering(true);\n\n      const { clientHeight: height, clientWidth: width } = containerRef.current;\n\n      // Clear the container before rendering new content\n      containerRef.current.innerHTML = '';\n\n      // Set fixed width and height to avoid layout issues during rendering\n      if (height) containerRef.current.style.minHeight = `${height}px`;\n      if (width && window !== window.parent) containerRef.current.style.minWidth = `${width}px`;\n\n      // Remove previously inserted paged.js styles\n      document.querySelectorAll(\"style[data-pagedjs-inserted-styles]\").forEach((style) => style.remove());\n\n      let pageFileName = \"page.css\"\n      const paged = new Previewer();\n\n      // Wrap in a try-catch to handle errors during preview generation\n      try {\n        paged.preview(pageFlowRef.current.innerHTML, [pageFileName], containerRef.current).then(() => {\n          setRendering(false);\n\n          // revert back container minWidth, minHeight after rendering.\n          containerRef.current.style.minWidth = 'auto';\n          containerRef.current.style.minHeight = 'auto';\n\n          // Attach event listeners for elements with \"data-uhuu\" attribute\n          document.querySelectorAll(\"[data-uhuu]\").forEach((item) => {\n            const clickListener = function () {\n              const value = JSON.parse(this.getAttribute(\"data-uhuu\"));\n              $uhuu.editDialog(value);\n            };\n            // Ensure unique listener attachment\n            item.removeEventListener('click', clickListener);\n            item.addEventListener('click', clickListener);\n          });\n\n          // Apply custom classes based on page-break-after elements\n          document.querySelectorAll(\".page-break-after[data-paged-css]\").forEach((el) => {\n            const pagedSheet = el.closest('div.pagedjs_sheet');\n            const pagedCSS = el.getAttribute('data-paged-css');\n            if (pagedSheet && pagedCSS) {\n              pagedCSS.split(' ').filter(Boolean).forEach((cssClass) => pagedSheet.classList.add(cssClass));\n            }\n          });\n        });\n      } catch (error) {\n        console.error(\"Error during Paged.js preview rendering:\", error);\n        setRendering(false);\n      }\n    }, 500),\n    []\n  );\n\n  return (\n    <div className={rendering ? 'rendering uhuu-page' : 'rendered uhuu-page'}>\n      {/* Container for Paged.js preview */}\n      <div className=\"pagedjs_preview_container\" ref={containerRef}></div>\n\n      {/* Hidden flow container for the content */}\n      <div style={{display:\"none\"}} ref={pageFlowRef}>\n        {children}\n      </div>\n    </div>\n  );\n});\n\nexport default PagedComponent;","// src/index.js\nimport './uhuu/styles/uhuu-editor-theme.css';\nimport PaginationDynamic from './uhuu/pagination-dynamic/pagination-dynamic';\nimport SheetDynamic from './uhuu/pagination-dynamic/sheet-dynamic';\n\n// Group Dynamic components\nexport const Dynamic = {\n  Pagination: PaginationDynamic,\n  Sheet: SheetDynamic\n};\n\nimport PaginationStatic from './uhuu/pagination-static/pagination-static';\nimport SheetStatic from './uhuu/pagination-static/sheet-static';\n\n// Group Static components\nexport const Static = {\n  Pagination: PaginationStatic,\n  Sheet: SheetStatic\n};\n\nexport { default as ImageBlock } from './uhuu/image/image-block';\nexport { default as Editable } from './uhuu/editable/editable';\n\n// EditorShell components - grouped export only\nimport { TemplateDataProvider } from './uhuu/editor-shell/document/template-data-provider';\nimport { PageEditor } from './uhuu/editor-shell/document/page-editor';\nimport { InteractiveModeProvider, useInteractive } from './uhuu/editor-shell/interactive-mode-context';\nimport { useIntegrationAdapter } from './uhuu/editor-shell/document/integration-adapter';\n\nexport const EditorShell = {\n  TemplateDataProvider,\n  PageEditor,\n  InteractiveModeProvider,\n  useInteractive,\n  useIntegrationAdapter,\n};\n\n// backwards compatibility\nexport { default as PagedPreview } from './PagedPreview';\n"],"names":["isObject","value","type","isObject_1","freeGlobal","global","_freeGlobal","require$$0","freeSelf","root","_root","now","now_1","reWhitespace","trimmedEndIndex","string","index","_trimmedEndIndex","reTrimStart","baseTrim","_baseTrim","Symbol","_Symbol","objectProto","hasOwnProperty","nativeObjectToString","symToStringTag","getRawTag","isOwn","tag","unmasked","result","_getRawTag","objectToString","_objectToString","require$$1","require$$2","nullTag","undefinedTag","baseGetTag","_baseGetTag","isObjectLike","isObjectLike_1","symbolTag","isSymbol","isSymbol_1","NAN","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","toNumber","other","isBinary","toNumber_1","FUNC_ERROR_TEXT","nativeMax","nativeMin","debounce","func","wait","options","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","time","args","thisArg","leadingEdge","timerExpired","remainingWait","timeSinceLastCall","timeSinceLastInvoke","timeWaiting","shouldInvoke","trailingEdge","cancel","flush","debounced","isInvoking","debounce_1","DocumentUtils$1","container","height","width","style","item","clickListener","el","pagedSheet","pagedCSS","cssClass","styles","fileName","blob","body","PageSizeUtils","format","orientation","size","mm","dpi","dimensions","paginationType","bleed","showBleed","compatibility","printCssRaw","printCssUrl","preview","ConfigContext","createContext","ConfigProvider","config","children","Pagination","className","setup","rendering","setRendering","useState","containerRef","useRef","contentRef","documentUtilsRef","DocumentUtils","hasWarnedRef","pageRuleRegex","match","sizeAndBleedStyles","existingStyles","newPageRule","layoutPage","paged","Previewer","styleUrls","error","useEffect","jsxs","jsx","Sheet","Compatibility","link","CompatibilityUtils","styleLink","combinedClassName","forwardRef","pageNo","overlay","dataPageKey","ref","useContext","showBleedArea","getDialogProps","props","dialog","e","ImageBleed","BLEED","PAGE_CONTENT_WIDTH","PAGE_CONTENT_HEIGHT","src","backgroundColor","imageW","imageH","imageL","imageR","imageT","imageB","coverClass","setCoverClass","unitFormat","calculateImageHeight","imageWidth","imageHeight","formatStyleValue","_","ratio","imageLoaded","imageClass","PortalRootContext","React","usePortalRoot","PortalRootProvider","portalContainer","setPortalContainer","InteractiveModeContext","useInteractive","useShouldHideUI","interactive","InteractiveModeProvider","defaultInteractive","enableDevTools","effectiveDefaultInteractive","setInteractive","cn","inputs","twMerge","clsx","buttonVariants","cva","Button","variant","DropdownMenu","DropdownMenuPrimitive","DropdownMenuTrigger","DropdownMenuSubTrigger","inset","DropdownMenuSubContent","DropdownMenuContent","sideOffset","DropdownMenuItem","DropdownMenuCheckboxItem","checked","DropdownMenuRadioItem","DropdownMenuLabel","DropdownMenuSeparator","handleOptionSelect","event","option","renderOverlay","overlaySvg","overlayClassName","trimmed","normalizedSvg","attrs","nextAttrs","renderOptionsButton","showOptions","MoreHorizontal","useShouldShowOptions","shouldHideUI","ImageBleedWithOverlay","dialogProps","bleedProps","baseDialogProps","merged","key","baseHandler","extraHandler","Fragment","ImageSpread","side","val","calculateImageWidth","createStyle","imageLeft","imageTop","imageBottom","rightPageOffset","useExplicitHeight","leftStyle","rightStyle","ImageWithOptions","alt","imageClassName","imageStyle","placeholder","imageProps","renderImage","mergedDialogProps","renderImageContent","imagePropsClassName","imagePropsStyle","finalSrc","finalAlt","mergedImageProps","hasDataUhuu","child","childrenWithProps","ImageBlock","computedOverlaySvg","computedOptions","computedDirectDialog","useMemo","annotation","annotationValue","autoOverlaySvg","autoOptions","dialogConfig","path","satelliteParams","annotations","annotationConfig","annotateDialogConfig","finalOptions","directDialog","mode","needsImageWithOptions","_mode","left","right","top","bottom","pageWidth","pageHeight","baseProps","spreadComponent","Editable","DEFAULT_PAGE_EDITOR_STATE_KEY","isPageGroup","flattenPages","items","pageNum","page","updatePageNumbers","updatedPages","getTotalPageCount","transformItemsForReorder","strictPosition","firstPage","firstPageComponentKey","pageComponentKey","restoreItemsFromReorder","reorderedItems","originalItems","originalItemsMap","restored","reorderedItem","original","normalizePageItems","_ignored","rest","buildPageEditorState","normalized","readPageEditorState","payload","maybeState","normalizedItems","mergePageEditorStateIntoPayload","state","generateUID","instantiatePage","templateId","componentKey","overrides","instantiateGroup","componentKeys","instanceId","entry","idx","dataKey","resolvePageIndex","totalPages","isPageInRanges","ranges","range","start","end","getRangesForMode","coverPageCount","filterPageItems","filterConfig","filtered","filteredPages","getIntegrationData","resolveIntegrationInstanceId","parentGroup","resolveIntegrationBinding","resolveIntegrationForPage","buildIntegrationPath","fieldPath","base","parseIntegrationPath","integrationPrefix","afterPrefix","dotIndex","setNestedValue","obj","keys","current","i","lastKey","updateIntegrationByPath","parsed","currentIntegration","updatedIntegration","getPagePayload","target","targetId","fallbackId","candidateKeys","TemplateDataContext","getReservedKeys","stateKey","mergeExternalPayload","currentPayload","externalPayload","reservedKeys","TemplateDataProvider","onPayloadChange","setCurrentPayload","lastExternalPayloadRef","isInternalUpdateRef","lastInternalPayloadRef","lastInternalTimestampRef","isInitialMountRef","serializePayload","payloadWithoutReservedKeys","currentWithoutReserved","lastInternalWithoutReserved","currentSerialized","lastInternalSerialized","prev","notifyHost","next","setPayload","resolved","finalPayload","setPageOptionValue","pageOrGroupId","setIntegrationPayload","prevIntegrations","setIntegrationPayloadValue","prevIntegration","removeIntegrationPayload","removed","remainingIntegrations","updateIntegrationByDialogPath","mergePageEditorState","effectiveKey","resolvePagePayload","toDefault","def","parseValue","raw","buildPayloadPageOption","field","stored","ZoomContext","TwoPageSection","layout","scaleValue","pairRef","updatePairWidth","sections","totalNaturalWidth","sum","section","scaledWidth","resizeObserver","Section","title","controls","origin","hideUI","contentHeight","setContentHeight","contentWidth","setContentWidth","updateDimensions","element","originalTransform","naturalHeight","naturalWidth","scaledHeight","alignmentMap","contentAlignClass","transformOrigin","SectionPageResizer","defaultZoom","minZoom","maxZoom","onAddPage","menuItems","hideUIProp","zoom","setZoom","fitMode","setFitMode","autoFitInitialized","setAutoFitInitialized","lastContainerWidth","setLastContainerWidth","isInitializing","setIsInitializing","calculateFitZoom","firstSection","availableWidth","availableHeight","scaleX","scaleY","handleFitMode","newZoom","zoomIn","zoomOut","handleInitialization","currentContainerWidth","sectionWidth","handleResize","ChevronDown","UnfoldHorizontal","UnfoldVertical","Maximize","ZoomOut","clampedValue","ZoomIn","Plus","SheetPrimitive","SheetPortal","SheetOverlay","SheetContent","XIcon","SheetHeader","SheetFooter","SheetTitle","SheetDescription","createDefaultRenderThumbnail","pageComponents","thumbnailWidth","thumbnailHeight","pageWidthMm","pageHeightMm","pageAspectRatio","finalThumbnailWidth","finalThumbnailHeight","pageWidthPx","pageHeightPx","isDragging","isLocked","firstPageId","firstPagePayload","FirstPageComponent","integration","Lock","pageId","pagePayload","PageComponent","AddPageDialog","open","onOpenChange","availableItems","onSelectItem","gridColsClass","searchQuery","setSearchQuery","filteredItems","q","handleSelect","defaultRenderThumbnail","evaluatePageComponentKeys","context","err","toReorderItem","group","pageItem","Search","isGroup","id","label","pageCount","hasDefaultThumbnail","SortableItem","renderItem","renderDragIndicator","keyExtractor","disabled","attributes","listeners","setNodeRef","transform","transition","useSortable","CSS","DragOverlayItem","DragDropGrid","initialItems","onChange","renderToolbar","renderEmptyState","showDebugInfo","renderDragOverlay","isItemDisabled","canDropAt","setItems","activeId","setActiveId","sensors","useSensors","useSensor","PointerSensor","KeyboardSensor","sortableKeyboardCoordinates","handleDragStart","draggedItem","handleDragEnd","active","over","oldIndex","newIndex","newItems","arrayMove","activeItem","activeIndex","DndContext","closestCenter","SortableContext","rectSortingStrategy","DragOverlay","badgeVariants","Badge","DefaultPageThumbnail","GripVertical","PageOrderDialog","pages","onReorder","renderThumbnail","description","localPages","setLocalPages","hasChanges","setHasChanges","handleLocalReorder","newOrder","handleSave","handleCancel","renderPageThumbnail","ArrowUpDown","targetIndex","draggedPosition","startEndIndex","endStartIndex","position","newOpen","Select","Switch","SwitchPrimitive","Slider","SliderPrimitive","Label","LabelPrimitive","PageOptionsRenderer","pageOptions","targetItem","matchesTarget","applicableOptions","renderOption","currentValue","opt","boolValue","numValue","values","newValue","Minus","stringValue","color","isSelected","Check","PageOptionsDropdown","onRemove","showRemove","removeLabel","triggerClassName","Trash2","PageGroup","pagesWithPageNum","totalItems","renderPage","onPageOptionChange","onLabelChange","handleLabelClick","currentLabel","entered","indexInGroup","isFirstPage","PageCanvas","reference","dataBinding","pageKey","usePageGroups","onItemsChange","onStateChange","resolveNewItem","notifyError","pageFilter","addDialogOpen","setAddDialogOpen","prevInitialItemsRef","templateDataContext","updateItems","useCallback","instanceCountsByTemplate","counts","pageTemplateId","availableItemsToAdd","count","isRepeatable","maxInstances","groupItem","totalPageCount","addItem","resolveIntegrationMode","draft","available","groupConfig","debugIntegration","integrationData","integrationMode","shouldAbort","requestIntegration","finalItem","itemToInsert","itemPosition","startItems","middleItems","endItems","removeItem","itemId","showError","message","p","updateItemFields","patch","reorderItems","itemsWithPageNum","itemsWithNumbers","renderItems","rendered","itemsForReorder","handleReorder","itemsToOrder","openAddDialog","buildPath","subPath","resolveGalleryPath","defaults","buildPageDataBinding","integrationBinding","groupId","pageBase","groupBase","asPage","isInitial","templateLookup","templateConfig","repeatable","component","asGroup","pagesConfig","entries","normalizeGroups","groups","buildPageGroupsConfig","initial","pageComponentKeys","explicitPageComponents","normalizedGroups","groupMap","inferredPageComponentKeys","mergedPageComponents","maybeGroup","availableGroupItems","AlertDialog","AlertDialogPrimitive","AlertDialogPortal","AlertDialogOverlay","AlertDialogContent","AlertDialogHeader","AlertDialogFooter","AlertDialogTitle","AlertDialogDescription","AlertDialogAction","AlertDialogCancel","DevPrintControls","modes","selectedModeProp","onModeChange","onInteractiveChange","modeKeys","currentMode","handleModeSelect","currentModeLabel","Printer","isDev","hostname","PageEditorInner","pageFormat","referenceRenderer","reorderTitle","reorderDescription","printConfigs","devFilter","setDevFilter","devPageFormat","setDevPageFormat","devSelectedMode","setDevSelectedMode","effectiveFilter","effectivePageFormat","effectivePayload","orderDialogOpen","setOrderDialogOpen","pageSetup","resolvedPageOptions","handlePageOptionChange","pageOption","defaultOverlay","info","buildOverlay","parent","renderPageContent","renderPageControls","isGroupPage","isFirstPageInGroup","flattenedPagesForTwoPages","flattened","a","b","pagePairs","pairs","leftPage","rightPage","isEven","defaultMenu","newInteractive","ClipboardList","X","pair","pagesWithNumbers","PageEditorView","PageEditor","resolvedConfig","noticeState","setNoticeState","restoredState","restoredItems","rawGroups","groupDefs","g","groupDefMap","rehydrated","groupDef","baseItem","newKeys","initialItemIds","rehydratedInitialCount","freshInitialCount","addedItems","evaluatePathString","parts","part","getNestedValue","resolveWithConfig","resolver","resolveWithFunction","resolveIntegrationData","configGalleryPath","buildDialogConfig","galleryPath","integrationPath","isAssistant","isImage","fullPath","resolvedGalleryPath","useIntegrationAdapter","resolvedData","originalOnClick","PagedComponent","pageFlowRef","useImperativeHandle","pageFileName","Dynamic","PaginationDynamic","SheetDynamic","Static","PaginationStatic","SheetStatic","EditorShell"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13]}